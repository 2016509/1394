<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>ТЗ на телеграм бота_Main</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="16f42927-0b72-80e8-9dca-cea862fc8a1a" class="page sans"><header><h1 class="page-title">ТЗ на телеграм бота_Main</h1><p class="page-description"></p></header><div class="page-body"><p id="16f42927-0b72-81b9-b6cf-cce09cfedf66" class="">Бот обрабатывает запросы по модельным номерам (<strong>Find Model</strong>) и запчастям (<strong>Find Parts</strong>): сохраняет текст или изображения в базу, запускает внешние скрипты для обработки, затем отображает результат. Реализована валидация, работа с инлайн-кнопками, управление стоками, комментариями и ценами через взаимодействие с таблицами базы данных</p><p id="16f42927-0b72-81cb-bc1f-e54ee631ef60" class="">
</p><ul id="16f42927-0b72-8125-9496-ce808c325b46" class="toggle"><li><details open=""><summary><strong>Функционал (он же чек-лист для тестирования)</strong></summary><table id="16f42927-0b72-81d8-a2a3-fbd063313c04" class="simple-table"><tbody><tr id="16f42927-0b72-81b4-b3a2-c4a7828f4f69"><td id="M@WG" class=""><strong>Номер</strong></td><td id="`yJM" class="" style="width:201.99998474121094px"><strong>Экран</strong></td><td id="AQ\u" class=""><strong>Действия в БД</strong></td></tr><tr id="16f42927-0b72-81d1-9ae6-cba8ccfce3e4"><td id="M@WG" class="">0</td><td id="`yJM" class="" style="width:201.99998474121094px">Первый экран, регистрация нового пользователя</td><td id="AQ\u" class="">Создать новую запись в таблице **users**.</td></tr><tr id="16f42927-0b72-813c-823c-d4cc1349d3fc"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81b8-8933-ed25e2703d85"><td id="M@WG" class="">1</td><td id="`yJM" class="" style="width:201.99998474121094px"><mark class="highlight-yellow_background"><strong>Find Model</strong></mark></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8161-919d-e92d2377457c"><td id="M@WG" class="">1.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Input validation (models)</td><td id="AQ\u" class="">Проверить запрос пользвателя - валидный/невалидный/смешанный</td></tr><tr id="16f42927-0b72-818d-af5d-d8193191f844"><td id="M@WG" class="">1.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Варианты поискового запроса юзера.</td><td id="AQ\u" class="">Действия при валидном запросе:</td></tr><tr id="16f42927-0b72-8122-881b-eb1d2836e1d8"><td id="M@WG" class="">1.2.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Поисковой запрос (картинка)</td><td id="AQ\u" class="">Сохранить изображение на диск и записать данные в таблицы jobs и job_description_and_notes.</td></tr><tr id="16f42927-0b72-81ee-82dc-f27a05f91c18"><td id="M@WG" class="">1.2.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Поисковой запрос (текст)</td><td id="AQ\u" class="">Запись в jobs и job_description_and_notes</td></tr><tr id="16f42927-0b72-81bf-b333-e0a9b7f171d0"><td id="M@WG" class="">1.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Формирование выдачи</td><td id="AQ\u" class="">Определить тип выдачи по значению поля **response** в таблице **responses**.</td></tr><tr id="16f42927-0b72-815d-b267-dfb85eaf58fc"><td id="M@WG" class="">1.3.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Not Found</td><td id="AQ\u" class="">Отправить сообщение пользователю и ждать повторного запроса.</td></tr><tr id="16f42927-0b72-814e-a9fd-feb65e0a8e1e"><td id="M@WG" class="">1.3.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Select Similar</td><td id="AQ\u" class="">Сформировать инлайн-кнопки на основе данных из таблицы **model_numbers**.</td></tr><tr id="16f42927-0b72-816f-a710-ca05623c94c1"><td id="M@WG" class="">1.3.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Стандартная выдача</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-819e-ba66-cdbe22915047"><td id="M@WG" class="">1.3.3.0</td><td id="`yJM" class="" style="width:201.99998474121094px">Формирование сообщения</td><td id="AQ\u" class="">Вывести обрезанное значение из поля **response_text** таблицы **responses**.</td></tr><tr id="16f42927-0b72-8115-89c1-e25b25859426"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Инлайн кнопки</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-812d-890a-c2061740fafd"><td id="M@WG" class="">1.3.3.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Ссылки на внешние сайты</td><td id="AQ\u" class="">Сформировать инлайн-кнопки, используя данные из таблицы **job_docs** по текущему **job_id**, дополненные данными из таблицы **models**. Отобразить первые 4 по значению confidense</td></tr><tr id="16f42927-0b72-81f9-a5d0-de2402f7b560"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка &quot;Show more ↓↓↓&quot;:</td><td id="AQ\u" class="">Отобразить те инлайн-кнопки (из 1.3.3.1), которые не были показаны изначально.</td></tr><tr id="16f42927-0b72-812c-bfd0-d6f660a98a2c"><td id="M@WG" class="">1.3.3.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Списки деталей с картинками:</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81ee-8679-ced474c696dc"><td id="M@WG" class="">1.4.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Action with parts. Простой список деталей</td><td id="AQ\u" class="">Вывести список на основе таблицы **job_stocks**, следуя &quot;Правилам построения списка деталей&quot;.</td></tr><tr id="16f42927-0b72-81d6-b894-c3d2877af8d2"><td id="M@WG" class="">1.5</td><td id="`yJM" class="" style="width:201.99998474121094px">Универсальные Правила построения  “Списка деталей”</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-818b-bacc-de30736185f7"><td id="M@WG" class="">1.3.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка &quot;Select similar&quot;</td><td id="AQ\u" class="">повтор 1.3.2</td></tr><tr id="16f42927-0b72-81bc-9dd6-dcbc709fa14b"><td id="M@WG" class="">1.3.3.4</td><td id="`yJM" class="" style="width:201.99998474121094px">Ссылки на PDF документы</td><td id="AQ\u" class="">Вывести ссылки из поля response таблицы responses в виде инлайн-кнопок. Вероятность отображения каждой кнопки определяется значениями из таблицы users. Должны отображаться кнопки - **Diagram (PDF)**/**Service Manual (PDF)**/**TechSheet (PDF)**(если они есть в response)</td></tr><tr id="16f42927-0b72-81a2-8814-c08143e7ade0"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Deep Search</td><td id="AQ\u" class="">Аналогично 1.3.3.4</td></tr><tr id="16f42927-0b72-81ed-9331-c6ec080fef97"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8148-9777-e197b74c8cc6"><td id="M@WG" class="">2</td><td id="`yJM" class="" style="width:201.99998474121094px"><mark class="highlight-yellow_background"><strong>Ветка “Find part”</strong></mark></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-817d-8629-f4b356c08f57"><td id="M@WG" class="">2.0</td><td id="`yJM" class="" style="width:201.99998474121094px">Начальный экран Find parts</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8161-be12-fa28637b6c68"><td id="M@WG" class="">2.0</td><td id="`yJM" class="" style="width:201.99998474121094px">Начальный экран Find parts. Инлайн кнопки</td><td id="AQ\u" class="">Отобразить стоки из таблицы stock_creds в виде инлайн-кнопок, добавив количество запчастей из поля record_count.</td></tr><tr id="16f42927-0b72-8169-9651-e097c57975f1"><td id="M@WG" class="">2.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Проверка запроса</td><td id="AQ\u" class="">Проверить ввод. Если подходит по критериям, записать в БД, если нет — сообщить об ошибке.</td></tr><tr id="16f42927-0b72-8121-b5f5-f074b4402e07"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81f4-9af4-d024957a1c63"><td id="M@WG" class="">2.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Варианты поискового запроса юзера.</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81d2-bc6e-eca354d5cc0a"><td id="M@WG" class="">2.2.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Поисковой запрос (картинка)</td><td id="AQ\u" class="">Сохранить картинку на диск и выполнить запись в таблицу **Parts_barcode**.</td></tr><tr id="16f42927-0b72-8113-aa7b-d6b273591edd"><td id="M@WG" class="">2.2.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Поисковой запрос (текст)</td><td id="AQ\u" class="">Выполнить запись в таблицу Parts_barcode. Переход на 2.3 страница детали</td></tr><tr id="16f42927-0b72-81a9-adf1-d111456a1dd4"><td id="M@WG" class="">2.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Формирование выдачи - Страница детали</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8198-8b66-ea70bc2ec96d"><td id="M@WG" class="">2.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Сообщени 1</td><td id="AQ\u" class="">Вывести информацию о детали из таблицы **parts_and_replaces**: изображение и название.</td></tr><tr id="16f42927-0b72-810f-9b85-f9e7dc8c7e09"><td id="M@WG" class="">2.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Сообщение 2</td><td id="AQ\u" class="">Вывести информацию о детали из таблицы **user_stocks**</td></tr><tr id="16f42927-0b72-81b8-909c-fa28cc7654a3"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8171-a6c9-c30bce42290d"><td id="M@WG" class="">2.3.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка Prices</td><td id="AQ\u" class="">аналогично п.5</td></tr><tr id="16f42927-0b72-8160-8e98-e19a708f641f"><td id="M@WG" class="">2.3.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Repair Instructions</td><td id="AQ\u" class="">Вывести информацию из таблицы Repair Instructions по текущему партномеру</td></tr><tr id="16f42927-0b72-8115-ae12-da0306916766"><td id="M@WG" class="">2.3.2.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Пошаговая инструкция</td><td id="AQ\u" class="">Вывести информацию из таблицы instruction_steps в определенном формате</td></tr><tr id="16f42927-0b72-8188-87bb-e2c5fc308f1d"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-811d-bda6-ec4e352ef0af"><td id="M@WG" class="">2.3.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка Add part. Экран Выбор стока для добавления детали</td><td id="AQ\u" class="">аналогично 2.0.1</td></tr><tr id="16f42927-0b72-8199-aa12-ef198efb7d34"><td id="M@WG" class="">2.3.3.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка Add part. Подтверждение</td><td id="AQ\u" class="">Записать в таблицу user_stocks выбранного стока значения: part_name, parts_and_replaces_id, и статус 4.</td></tr><tr id="16f42927-0b72-81b5-8bb0-c6cfb68c77a0"><td id="M@WG" class="">2.3.4</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка Write-off. Выбор стока</td><td id="AQ\u" class=""><strong>Отобразить в виде инлайн-кнопок результаты поиска по таблице user_stocks текущего партномера (этот поиск был выполнен на шаге 2.3 для формирования сообщения 2).</strong></td></tr><tr id="16f42927-0b72-819b-a40d-da36ddc95066"><td id="M@WG" class="">2.3.4.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка Write-off. Подтверждение списания</td><td id="AQ\u" class="">После выбора стока - удалить соотв запись</td></tr><tr id="16f42927-0b72-818a-80a9-e3f3e86ce4f0"><td id="M@WG" class="">2.3.5</td><td id="`yJM" class="" style="width:201.99998474121094px">Add comment. Выбор стока</td><td id="AQ\u" class=""><strong>аналогично 2.3.4</strong></td></tr><tr id="16f42927-0b72-8145-9b14-c31a126f424c"><td id="M@WG" class="">2.3.5.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Add comment: Ввод комментария</td><td id="AQ\u" class="">Записать коммент юзера в соотв поле таблицы ser_stocks</td></tr><tr id="16f42927-0b72-8114-a1d1-caf84165140f"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81df-9ec4-f041a8107bc7"><td id="M@WG" class="">2.3.6</td><td id="`yJM" class="" style="width:201.99998474121094px">Кнопка Share</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8188-9ded-d77ea812d112"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8121-8d5d-f93ff5130b11"><td id="M@WG" class=""><strong>3.</strong></td><td id="`yJM" class="" style="width:201.99998474121094px"><mark class="highlight-yellow_background"><strong>Ветка “Manage stock”</strong></mark></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8155-aa2d-ca5cc79759cb"><td id="M@WG" class="">3.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Add new stock</td><td id="AQ\u" class="">Создать новую запись в stock_creds</td></tr><tr id="16f42927-0b72-8106-b72f-f3d63ca74ebd"><td id="M@WG" class="">3.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Страница Управления стоком</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-819c-ae4e-f19c83584cbf"><td id="M@WG" class="">3.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Сообщение</td><td id="AQ\u" class="">Вывести калькуляцию по статусам таблицы user_stocks для конкретного stock_id</td></tr><tr id="16f42927-0b72-815e-bdc6-c5303b486acd"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class="">Бот должен опрашивать таблицу и обновлять сообщение, пока есть записи со статусом &quot;processing&quot;. Как только такие записи отсутствуют, опрос прекращается.</td></tr><tr id="16f42927-0b72-818d-87d3-eddea1c200e7"><td id="M@WG" class="">3.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Upload Stock file</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81c4-b005-cc4f018dfdc1"><td id="M@WG" class="">3.3.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Google Sheet: Ввод ссылки</td><td id="AQ\u" class="">Выполнить запись в БД</td></tr><tr id="16f42927-0b72-8157-9a20-f5686381993d"><td id="M@WG" class="">3.3.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Excel file (local): Загрузка файла</td><td id="AQ\u" class="">Сохранить файл на диск и выполнить запись в БД.</td></tr><tr id="16f42927-0b72-817a-b76a-f0b2422c7438"><td id="M@WG" class="">3.3.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Dropbox file (local): Ввод ссылки</td><td id="AQ\u" class="">Выполнить запись в БД</td></tr><tr id="16f42927-0b72-81f6-baa3-fc3b58d8ecc9"><td id="M@WG" class="">3.4</td><td id="`yJM" class="" style="width:201.99998474121094px">Download Stock file</td><td id="AQ\u" class="">Сформировать Excel-файл на основе данных таблицы **user_stocks** для текущего **stock_id**, сохранить его и отправить пользователю через Telegram.</td></tr><tr id="16f42927-0b72-81bd-8cbc-cc20889fa170"><td id="M@WG" class="">3.7</td><td id="`yJM" class="" style="width:201.99998474121094px">Show stock list</td><td id="AQ\u" class="">Вывести список на основе таблицы user_stocks, следуя &quot;Правилам построения списка деталей&quot;.</td></tr><tr id="16f42927-0b72-81fd-8868-d0d7c18af869"><td id="M@WG" class="">3.8</td><td id="`yJM" class="" style="width:201.99998474121094px">Delete Stock</td><td id="AQ\u" class="">Удалить записи, связанные с данным стоком, из таблиц **stock_creds** и **user_stocks**.</td></tr><tr id="16f42927-0b72-81ef-bbb0-f975de2d130e"><td id="M@WG" class="">3.9 и 3.10</td><td id="`yJM" class="" style="width:201.99998474121094px">Add part(s) и Write-off</td><td id="AQ\u" class="">повтор 2.3.3 и 2.3.4 соответственно</td></tr><tr id="16f42927-0b72-81e2-a246-cbdfe2ea0dcf"><td id="M@WG" class="">3.11</td><td id="`yJM" class="" style="width:201.99998474121094px">Stock Recount</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81a6-86dd-dbca13b66d31"><td id="M@WG" class="">4.</td><td id="`yJM" class="" style="width:201.99998474121094px"><mark class="highlight-yellow_background"><strong>Функция “Stock Recount”</strong></mark></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81e2-aeb5-d1e27f12df3f"><td id="M@WG" class="">4.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Stock Recount. Choose Stock</td><td id="AQ\u" class="">Аналогично 2.0.1</td></tr><tr id="16f42927-0b72-81c6-8b02-e612000854cf"><td id="M@WG" class="">4.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Upload Photos</td><td id="AQ\u" class="">Сохранить файлы на диск и создать соответствующие записи в таблице **Stock_Recount**.</td></tr><tr id="16f42927-0b72-815f-b17e-d165f4e67165"><td id="M@WG" class="">4.3</td><td id="`yJM" class="" style="width:201.99998474121094px">List Processing</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-8182-b32c-e290baac8d14"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Сообщение</td><td id="AQ\u" class="">Вывести калькуляцию по статусам в таблице **Stock_Recount**  (аналогично 3.2.3)</td></tr><tr id="16f42927-0b72-8123-8343-c032b412da24"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class="">Обновлять страницу аналогично пункту 3.2.3, пока в таблице остаются записи со статусом &quot;processing&quot;.</td></tr><tr id="16f42927-0b72-813c-b7d8-eaaf5a297cb8"><td id="M@WG" class="">4.4</td><td id="`yJM" class="" style="width:201.99998474121094px">Show List</td><td id="AQ\u" class="">Вывести список на основе таблицы **Stock_Recount**, следуя &quot;Правилам построения списка деталей&quot;.</td></tr><tr id="16f42927-0b72-81e5-8c1c-df2bb9dcc4f0"><td id="M@WG" class="">4.4.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Клик по нижнему блоку в списке Edit</td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81d7-aa3d-f3a5c2375ed0"><td id="M@WG" class="">4.4.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Edit partnumber. Сообщение</td><td id="AQ\u" class="">Вывести информацию из таблицы Stock_Recount и таблицы parts_and_replaces.</td></tr><tr id="16f42927-0b72-812c-b6be-ee28837ff696"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Edit partnumber. Действие</td><td id="AQ\u" class="">Записать ввод пользователя в БД.</td></tr><tr id="16f42927-0b72-8100-bc74-da346d35b755"><td id="M@WG" class="">4.5</td><td id="`yJM" class="" style="width:201.99998474121094px">Replace Stock File</td><td id="AQ\u" class="">Удалить старые данные и записать новые в таблицу user_stocks.</td></tr><tr id="16f42927-0b72-818d-bda9-d0774c52c884"><td id="M@WG" class="">4.5</td><td id="`yJM" class="" style="width:201.99998474121094px">Add Parts to Stock</td><td id="AQ\u" class="">Записать новые данные в таблицу **user_stocks** без удаления старых.</td></tr><tr id="16f42927-0b72-81cc-8309-cd0cad9f445d"><td id="M@WG" class="">4.6</td><td id="`yJM" class="" style="width:201.99998474121094px">Clear List</td><td id="AQ\u" class="">Очистить таблицу Stock_Recount.</td></tr><tr id="16f42927-0b72-816b-976c-f31282d8c348"><td id="M@WG" class="">5.</td><td id="`yJM" class="" style="width:201.99998474121094px"><mark class="highlight-yellow_background"><strong>Функция “Prices”</strong></mark></td><td id="AQ\u" class="">Создать записи в таблице **pricebot_tasks** на основе данных из таблицы **user_shops** и запроса пользователя.</td></tr><tr id="16f42927-0b72-8102-9097-f8174feb1078"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Функция “Prices”. Выдача</td><td id="AQ\u" class="">Вывести данные из таблицы **pricebot_tasks** в указанном формате.</td></tr><tr id="16f42927-0b72-8120-a141-cd9c54845579"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px"></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-815a-a64d-febc6fc27a53"><td id="M@WG" class="">0. </td><td id="`yJM" class="" style="width:201.99998474121094px"><mark class="highlight-yellow_background"><strong>Меню бота</strong></mark></td><td id="AQ\u" class=""></td></tr><tr id="16f42927-0b72-81c4-8fb1-d12b0bd7907a"><td id="M@WG" class="">0.1</td><td id="`yJM" class="" style="width:201.99998474121094px">Diagrams&amp;manuals</td><td id="AQ\u" class="">Переход на 1.2</td></tr><tr id="16f42927-0b72-816c-ae79-f42c55b84ee7"><td id="M@WG" class="">0.2</td><td id="`yJM" class="" style="width:201.99998474121094px">Your stocks</td><td id="AQ\u" class="">Переход на 2.1</td></tr><tr id="16f42927-0b72-8161-9857-d1f18e29c5ad"><td id="M@WG" class="">0.3</td><td id="`yJM" class="" style="width:201.99998474121094px">Stock Recount</td><td id="AQ\u" class="">Переход на 4.1</td></tr><tr id="16f42927-0b72-816e-b2a6-efe2c13873bc"><td id="M@WG" class="">0.4</td><td id="`yJM" class="" style="width:201.99998474121094px">Prices</td><td id="AQ\u" class="">Переход на 5</td></tr><tr id="16f42927-0b72-8130-a6cf-c159896f2fb8"><td id="M@WG" class="">0.5</td><td id="`yJM" class="" style="width:201.99998474121094px">Shops</td><td id="AQ\u" class="">Вывести все магазины пользователя из таблицы **user_shops** в виде инлайн-кнопок. Клик по кнопке изменяет статус соответствующего магазина в таблице **user_shops**.</td></tr><tr id="16f42927-0b72-8152-9399-ddf9306101c2"><td id="M@WG" class="">0.5.1.</td><td id="`yJM" class="" style="width:201.99998474121094px">Manage Credentials</td><td id="AQ\u" class="">Записать ввод пользователя в таблицу stock_creds</td></tr><tr id="16f42927-0b72-812f-8d10-f752176b84e5"><td id="M@WG" class="">0.6</td><td id="`yJM" class="" style="width:201.99998474121094px">Parts finder</td><td id="AQ\u" class="">Переход на 2.2</td></tr><tr id="16f42927-0b72-8125-8b43-e83242a6899c"><td id="M@WG" class="">0.7</td><td id="`yJM" class="" style="width:201.99998474121094px">Replace finder</td><td id="AQ\u" class="">Переход на 2.3 + сообщение о реплейсах</td></tr><tr id="16f42927-0b72-815f-bbac-e9e9ea36d105"><td id="M@WG" class=""></td><td id="`yJM" class="" style="width:201.99998474121094px">Replace finder (сообщение)</td><td id="AQ\u" class="">Вывести JSON-массив из поля **Replaces** таблицы **parts_and_replaces** в виде списка.</td></tr><tr id="16f42927-0b72-81bb-827a-fcbe6ae4b025"><td id="M@WG" class="">0.8</td><td id="`yJM" class="" style="width:201.99998474121094px">Parts barcode reader</td><td id="AQ\u" class="">Переход на 2.2</td></tr><tr id="16f42927-0b72-81c2-9a89-e52af5177be8"><td id="M@WG" class="">0.9</td><td id="`yJM" class="" style="width:201.99998474121094px">Model sticker scanner</td><td id="AQ\u" class="">Переход на 1.2</td></tr><tr id="16f42927-0b72-81c7-b5e8-ca3d91e4a729"><td id="M@WG" class="">0.10</td><td id="`yJM" class="" style="width:201.99998474121094px">Add part</td><td id="AQ\u" class="">Переход на 2.2</td></tr><tr id="16f42927-0b72-8114-8336-f51b266d1709"><td id="M@WG" class="">0.11</td><td id="`yJM" class="" style="width:201.99998474121094px">Write-off part</td><td id="AQ\u" class="">Переход на 2.2</td></tr><tr id="16f42927-0b72-8126-bca9-d0cca87f0f88"><td id="M@WG" class="">0.12</td><td id="`yJM" class="" style="width:201.99998474121094px">Help &amp; Support</td><td id="AQ\u" class="">Переход в чат поддержки</td></tr></tbody></table></details></li></ul><ul id="16f42927-0b72-81a8-8ec9-f34aeecd3423" class="toggle"><li><details open=""><summary><strong>Схемы</strong>:</summary><p id="16f42927-0b72-814a-b13a-d8afa0782fba" class=""><a href="https://www.figma.com/board/ihoCc530sAp0bxVgbmyaa9/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0-%D0%91%D0%BE%D1%82%D0%B0-(Copy)?t=2p2HDJ8Ppb0Ic6Im-1">&quot;Схема пользовательских шагов Telegram-бота - Логическая схема”</a></p><p id="16f42927-0b72-81bb-b236-f372b8262462" class=""><a href="https://www.figma.com/design/FmAWWn4XRe7WiramYoTf72/%D0%9B%D0%BE%D0%B3%D0%B8%D0%BA%D0%B0-%D0%B2-%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D0%B0%D1%85-(Copy)?node-id=0-1&amp;t=iLR5jcmrJ4CeF8CC-1">“Схема пользовательских шагов Telegram-бота - Скриншоты шагов”</a></p></details></li></ul><ul id="16f42927-0b72-81d7-ba4d-f8c2e5e228f6" class="toggle"><li><details open=""><summary><strong>API</strong>:</summary><p id="16f42927-0b72-80bc-a716-f1af6820bb3a" class=""><a href="https://disk.yandex.ru/i/Jk8H-xAat6jNrA">Описание</a> API</p><p id="16f42927-0b72-8138-8563-e119550741e4" class=""><a href="http://95.216.25.39:5050/swagger/index.html">http://95.216.25.39:5050/swagger/index.html</a></p><p id="16f42927-0b72-80b1-8dd0-f41af72591fb" class="">В случае необходимости расширения текущего функционала апи просьба описать какие входные параметры передаются , из какой таблицы нужны данные и какие именно данные необходимо получить.…</p></details></li></ul><p id="16f42927-0b72-8141-95ef-e9b86ce64135" class="">
</p><p id="16f42927-0b72-81bc-a4dd-fbcbf3db1a04" class=""><strong><a href="https://disk.yandex.ru/i/y29MFUptE8UWMQ">Обзорное видео</a></strong><strong>:</strong></p><figure id="16f42927-0b72-81c3-a610-ef6b08abb83e"><div class="source"><a href="https://drive.google.com/file/d/18Qxraw8DHkINAu_bO_IFV8htRyvvNIiQ/view?usp=sharing">https://drive.google.com/file/d/18Qxraw8DHkINAu_bO_IFV8htRyvvNIiQ/view?usp=sharing</a></div></figure><p id="16f42927-0b72-81b9-ac17-d88ef9eceb02" class="">
</p><p id="16f42927-0b72-81f5-8675-e00f767a9837" class="">
</p><h1 id="16f42927-0b72-8178-a238-e6253dbf116f" class=""></h1><h1 id="16f42927-0b72-8117-bbac-f28ba9865e72" class="">0. Первый экран, регистрация нового пользователя </h1><ul id="16f42927-0b72-81ea-bb97-c8ae0a5a769f" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание</mark></mark></summary><ul id="16f42927-0b72-8144-8168-d753931d9b47" class="block-color-red toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-815b-aef3-cbcce08e86cf" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image.png"><img style="width:651.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-81ae-9aa7-f7dcab9812d9" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Таблицы</mark></mark></summary><p id="16f42927-0b72-8113-b3ae-d1404af8eed7" class=""><strong><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Структура</a></strong><strong> таблицы </strong><code><strong>users</strong></code></p></details></li></ul><ul id="16f42927-0b72-8168-93aa-f99a1789e451" class="toggle"><li><details open=""><summary><strong>Регистрация нового пользователя</strong></summary><ol type="1" id="16f42927-0b72-8136-b312-c0a34f2b7991" class="numbered-list" start="1"><li><strong>Создать запись в таблице </strong><code><strong>users</strong></code><strong>:</strong><ul id="16f42927-0b72-8158-b3f1-f97151bb73d4" class="bulleted-list"><li style="list-style-type:disc">Поля:<ul id="16f42927-0b72-81b9-8bb6-dfe471716ff4" class="bulleted-list"><li style="list-style-type:circle"><code>telegram_id</code> — ID пользователя.</li></ul><ul id="16f42927-0b72-81b8-92fb-e14dd239a9ff" class="bulleted-list"><li style="list-style-type:circle"><code>prefers_telegram</code> = 1.</li></ul><ul id="16f42927-0b72-817b-9f04-c7e309b566ef" class="bulleted-list"><li style="list-style-type:circle">Остальные поля — по умолчанию.</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-81fa-a2db-dc5d530a51ed" class="numbered-list" start="2"><li><strong>Проверить на дубли:</strong><ul id="16f42927-0b72-8140-9349-e5e7e4985bba" class="bulleted-list"><li style="list-style-type:disc">Если <code>telegram_id</code> уже есть, запись не создаётся.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8171-967c-f762a44c4610" class="numbered-list" start="3"><li><strong>Логирование:</strong><ul id="16f42927-0b72-8161-a87c-e222aba7b183" class="bulleted-list"><li style="list-style-type:disc">Запись в лог успешной регистрации с <code>telegram_id</code> и временем.</li></ul></li></ol></details></li></ul><p id="16f42927-0b72-81e1-b2d5-c0c69db44019" class="">
</p><p id="16f42927-0b72-816f-a333-c912926d9e13" class="">Приветственное сообщение. На клавиатуре 2 кнопки / 2 режима работы бота:</p><ol type="1" id="16f42927-0b72-81a1-8b1b-fd5b90226685" class="numbered-list" start="1"><li>«Find Model» - поиск по модельным номера</li></ol><ol type="1" id="16f42927-0b72-812e-a134-e4dfc3eaa66f" class="numbered-list" start="2"><li>«Find Parts» - поиск по запчастям/партномерам</li></ol><p id="16f42927-0b72-8103-bed2-cc112eb0d8b5" class="">В дальнейшем на клавиатуре будет только одна кнопка «противоположная» выбранному режиму.</p><p id="16f42927-0b72-81d4-bb88-ff9774cd7735" class="">Например:</p><ul id="16f42927-0b72-81e0-8106-e1b08d67f37c" class="bulleted-list"><li style="list-style-type:disc">При выборе <strong>Find Model</strong>, на клавиатуре остается только кнопка <strong>Find Parts</strong>.</li></ul><ul id="16f42927-0b72-81ac-9e9a-d60f23a800dc" class="bulleted-list"><li style="list-style-type:disc">При выборе <strong>Find Parts</strong>, остается только кнопка <strong>Find Model</strong>.</li></ul></details></li></ul><h1 id="16f42927-0b72-8123-8c38-c29141fd0cdf" class="">1. Ветка <strong>«Find Model» </strong></h1><ul id="16f42927-0b72-8106-b252-e762ace383f8" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание режима Find Model </mark></mark></summary><p id="16f42927-0b72-81d6-9f73-f717a00084f1" class=""><strong>Один из 2х основных режимов работы</strong> <strong>- поиск в БД по модельному номеру.</strong>  Пользователь вводит модельный номер  / текст, содержащий модельный номер / или отправляет изображение с модельным номером. Эта информация сохраняется в базе данных. Бот ожидает обработки и, после появления результата в таблице Response и других связанных таблицах, отправляет пользователю готовую выдачу.</p><ul id="16f42927-0b72-813e-859e-c1e879faecae" class="toggle"><li><details open=""><summary><strong>1.1 Input validation (models)</strong></summary><p id="16f42927-0b72-81d7-93c8-e6b79ec733f6" class="">Для всей ветки <strong>«Find Model»</strong>  Пользователь может ввести текст (до 4000 символов) или отправить картинку. Некорректный ввод обрабатывается сообщением &quot;Unrecognized request. Please try again.&quot; и бот остается на текущей странице с тем же инлайн-меню.</p><p id="16f42927-0b72-81e8-88bd-d308f122dbf9" class="">Если пользователь отправляет две или более картинки, система должна обработать это как невалидный сценарий и вернуть сообщение:</p><p id="16f42927-0b72-814a-8068-cf10d5a2d54b" class=""><strong>&quot;Please send only one image. Your request is invalid.&quot;</strong></p><p id="16f42927-0b72-817a-afb6-f7dbacd3eb54" class="">На ветке 1 можно использовать смешанные запросы, но только в формате: валидное изображение + валидный текст. В этом случае обе составляющие будут связаны с одним job_id.</p><p id="16f42927-0b72-8100-8ec6-c42b4850b4d6" class="">Если же ввод включает валидные и невалидные данные одновременно (например, изображение + невалидный текст или валидный текст + невалидный файл), запрос рассматривается как невалидный, и система возвращает ошибку.</p><p id="16f42927-0b72-8135-ba89-ef04003ad683" class="">Бот должен одинаково обрабатывать отправку картинки как в виде файла, так и в виде изображения.</p><ul id="16f42927-0b72-81fc-9e5c-db0f92180539" class="bulleted-list"><li style="list-style-type:disc">Фото поддерживаемых форматов (PNG, JPEG, JPG).</li></ul><ul id="16f42927-0b72-8109-852f-d0b85fcd27bd" class="bulleted-list"><li style="list-style-type:disc">Фото неподдерживаемых форматов (TIFF, BMP, GIF, WEBP). </li></ul></details></li></ul><p id="16f42927-0b72-814d-a147-e8683b6b43ae" class="">
</p><p id="16f42927-0b72-81ae-b76a-eee820dcd448" class=""><strong>1.2 Варианты поискового запроса юзера.</strong></p><p id="16f42927-0b72-810e-96fb-c49183949756" class="">При отправке <strong>валидного</strong> запроса в бот, независимо от его типа (текст или изображение), создается новая работа. Все данные сохраняются в базе данных, и их обработкой занимаются <strong>сторонние скрипты</strong>. Бот выполняет записывает в БД запрос и ожидает ответа.<div class="indented"><ul id="16f42927-0b72-81c9-b148-fb68974fbc11" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Общие действия (для 1.2.1 и 1.2.2) - создание новой работы в таблице </mark></mark><mark class="highlight-blue"><mark class="highlight-yellow_background"><strong>jobs</strong></mark></mark><mark class="highlight-blue"><mark class="highlight-yellow_background">:</mark></mark></summary><p id="16f42927-0b72-81be-9417-eaaeaf7da6cc" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><ol type="1" id="16f42927-0b72-81a5-88d5-d372213922e2" class="numbered-list" start="1"><li>Создаёт новую запись в таблице <code>jobs</code> с уникальным <code>job_id</code>.<ul id="16f42927-0b72-816f-ae4d-eac792b9173c" class="bulleted-list"><li style="list-style-type:disc"><code><strong>id</strong></code>: автоинкремент.</li></ul><ul id="16f42927-0b72-81d3-a3f7-c38238bd5be7" class="bulleted-list"><li style="list-style-type:disc"><code><strong>user_id</strong></code>: идентификатор текущего пользователя, отправившего фотографию.</li></ul><ul id="16f42927-0b72-8196-b2fc-efff8ffc6fb9" class="bulleted-list"><li style="list-style-type:disc"><code><strong>job_number</strong></code>: следующий уникальный номер работы (вычисляется автоматически на основе предыдущих записей).</li></ul><ul id="16f42927-0b72-81a8-9e2b-f6fa3752b247" class="bulleted-list"><li style="list-style-type:disc"><code><strong>job_link</strong></code>: пусто.</li></ul><ul id="16f42927-0b72-818a-aea8-ec64266bfab2" class="bulleted-list"><li style="list-style-type:disc"><code><strong>token</strong></code>: уникальный токен, генерируемый триггером в БД.</li></ul><ul id="16f42927-0b72-81e4-a67d-c37a0fb79523" class="bulleted-list"><li style="list-style-type:disc"><code><strong>update_request_status</strong></code>: пусто.</li></ul></li></ol><ol type="1" id="16f42927-0b72-81bd-9210-e487503104b4" class="numbered-list" start="2"><li>Создается запись в таблице <mark class="highlight-red"><mark class="highlight-brown_background">job_description_and_notes</mark></mark>, связанная с этим<mark class="highlight-red"><mark class="highlight-gray_background"> job_id.</mark></mark><p id="16f42927-0b72-81e4-a013-e0a0d3077a71" class="">Все поля пустые - будут заполняться на шаге 2 или 3 ( 1.2.1 или 1.2.2):</p></li></ol><ol type="1" id="16f42927-0b72-814d-bce7-e1ee05402836" class="numbered-list" start="3"><li>На шаге 1.2.1 или 1.2.2 - в зависимости от запроса юзера заполняются поля таблицы <mark class="highlight-red"><mark class="highlight-brown_background">job_description_and_notes</mark></mark> и бот переходит в режим ожидания ответа.</li></ol><ol type="1" id="16f42927-0b72-815b-9ae2-df58973be227" class="numbered-list" start="4"><li>Бот с интервалом в 5 секунд проверяет таблицу Response, ожидая появления результата с текущим job_id.</li></ol><ol type="1" id="16f42927-0b72-810f-862a-f095800ef581" class="numbered-list" start="5"><li>В процессе обработки на экране пользователя отображается сообщение &quot;Searching&quot;. После получения ответа бот формирует и отправляет результат.</li></ol></details></li></ul><p id="16f42927-0b72-8169-b0ad-d26662160d66" class="">
</p><p id="16f42927-0b72-811f-ab14-ce5df9341503" class=""><strong>1.2.1 Поисковой запрос (картинка). </strong></p><p id="16f42927-0b72-8135-9c62-f821f2da55a9" class="">Бот сохраняет изображение на диск и создает задачу в таблице с уникальным job_id. Обработкой изображения и записью результатов в таблицу занимается внешняя система. Бот ожидает эти результаты и отправляет их пользователю.</p><ul id="16f42927-0b72-8137-869e-f793460b1a1c" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-8134-8bce-f45f0fa8ef01" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8154-8c23-c5c5bfbe0662" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%201.png"><img style="width:599.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%201.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81b5-900d-ef4f3d0e019e" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><ol type="1" id="16f42927-0b72-8111-a47d-f0196dbaa648" class="numbered-list" start="1"><li>Пользователь отправляет картинку в бота.</li></ol><ol type="1" id="16f42927-0b72-8114-a4d9-fb6b8d94c90b" class="numbered-list" start="2"><li>Бот выполняет <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Общие действия по созданию новой работы</a></li></ol><ol type="1" id="16f42927-0b72-8154-8b63-e26c86ba8ff4" class="numbered-list" start="3"><li>В таблице <code>job_description_and_notes</code> по текущему  <code>job_id</code> меняет:<ul id="16f42927-0b72-8116-9108-c4422407a491" class="bulleted-list"><li style="list-style-type:disc"><strong>pic_counter</strong>: 1.</li></ul><ul id="16f42927-0b72-8169-afdf-c2cbde30f813" class="bulleted-list"><li style="list-style-type:disc">Обновляет статус в <code>job_description_and_notes</code> на <code>3</code>, указывая, что папка готова для сканирования.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8176-b1a7-e417797b7641" class="numbered-list" start="4"><li>Создаёт уникальную папку по пути <code>[путь к папке users]/[user_id]/jobs_pic/[job_id]</code>. Сохраняет фотографию в созданную папку с уникальным <code>file_id</code>.</li></ol></details></li></ul></div></p><p id="16f42927-0b72-8152-bf5b-db24e04f91bb" class=""><div class="indented"><p id="16f42927-0b72-8124-8b82-f8a38f274e79" class=""><strong>1.2.2 Поисковой запрос (текст или Модельный номер)<br/><br/></strong>Бот сохраняет текст в таблицу базы данных, создавая задачу с уникальным job_id. Обработкой этого текста занимается внешняя система. Бот ожидает эти результаты и отправляет их пользователю.</p><ul id="16f42927-0b72-8151-b779-de1c0eeef52b" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-8114-90fe-c6fd764dd8f6" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81d3-a06d-dd7c372f88f5" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%202.png"><img style="width:1198px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%202.png"/></a></figure></details></li></ul><ol type="1" id="16f42927-0b72-813f-b2d5-ce346e8555ab" class="numbered-list" start="1"><li>Пользователь отправляет в бот текст.</li></ol><ol type="1" id="16f42927-0b72-8136-8c8a-cbf394aba1d2" class="numbered-list" start="2"><li><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Проверка валидности введенного запроса</a></li></ol><ol type="1" id="16f42927-0b72-8140-bbb9-e36519661267" class="numbered-list" start="3"><li>Бот выполняет <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Общие действия по созданию новой работы</a></li></ol><ol type="1" id="16f42927-0b72-818d-995b-cf91f0d6b0aa" class="numbered-list" start="4"><li>В таблице <code>job_description_and_notes</code> по текущему  <code>job_id</code> меняет:<ul id="16f42927-0b72-8166-993a-d8d198e56c5a" class="bulleted-list"><li style="list-style-type:disc">job_description=запрос пользователя</li></ul><ul id="16f42927-0b72-8113-bd37-d6d6f903d991" class="bulleted-list"><li style="list-style-type:disc">Обновляет статус в <code>job_description_and_notes</code> на<mark class="highlight-red"><mark class="highlight-gray_background"> 0 </mark></mark>, указывая, что запись готова для последующей обработки.</li></ul></li></ol><p id="16f42927-0b72-814c-bb40-e00cf97474c4" class="">Примечание: Каждый валидный поисковый запрос (текстовый или изображение) создает новую работу в системе, которая обрабатывается отдельно.</p></details></li></ul></div></p><p id="16f42927-0b72-8104-a4e1-f5b08f1116e5" class=""><strong>1.3 Формирование выдачи. </strong></p><p id="16f42927-0b72-81ce-966d-d52156b8dbfe" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-812b-99de-e4fd5ae8698b" class="">После отправки запроса (п. 1.2.1 или 1.2.2) бот переходит в режим ожидания, каждую секунду проверяя новые записи в таблице <code>Response</code> по соответствующему <code>job_id</code>. </p><p id="16f42927-0b72-810f-bfb9-c6f390011a98" class="">Если после 200 проверок с интервалом в 1 секунду ответа не поступает, бот уведомляет о таймауте.</p><p id="16f42927-0b72-81de-b32c-d628f7c30e6d" class="">При появлении данных  в таблице <code>Response</code>  он формирует результат. </p><p id="16f42927-0b72-81c2-b922-dc5ff7171a1f" class="">Бот анализирует поле response_text и, в зависимости от условий, формирует один из трех вариантов выдачи:<div class="indented"><p id="16f42927-0b72-8164-abed-c612ebd8336e" class=""><strong>1.3.1. Not found </strong></p><p id="16f42927-0b72-81a9-a81e-ca8aa000473d" class="">Ничего не найдено. Пользователю предлагается повторить запрос.</p><ul id="16f42927-0b72-81a2-ab9c-d234dafa6072" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-8168-930e-e213a4c65576" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8187-ba73-df805627e929" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%203.png"><img style="width:1014px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%203.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8131-88a1-ed713c37da85" class=""><strong>Условия:</strong></p><p id="16f42927-0b72-8143-bf9e-d93204154ef3" class="">Если в поле <code>response_text</code> содержится фраза <strong>&quot;not found. Enter model number&quot;</strong>, это означает, что результат поиска отсутствует.</p><hr id="16f42927-0b72-8124-93ba-c9ebab1ed70d"/><p id="16f42927-0b72-819e-a66c-e56b72a493c5" class=""><strong>Пример </strong><code><strong>response_text</strong></code><strong> V1:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8184-b40e-c5dc939cc7eb" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Job 3143: https://11nk.link/750099
Model number not found. Enter model number:
</code></pre><p id="16f42927-0b72-8137-9e69-df4faacd439f" class=""><strong>Пример </strong><code><strong>response_text</strong></code><strong> V2:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8124-bb71-dc7831699656" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Job 3143: https://11nk.link/750099
Model number kbfn502ess02, kbfn502ess0, kbfn502ess, kbfn502es not found. Enter model number:
</code></pre><hr id="16f42927-0b72-8141-9364-d75b4ba366c5"/><p id="16f42927-0b72-815d-87c7-e8f5d88f64e2" class=""><strong>Смысл:</strong></p><p id="16f42927-0b72-8188-b39d-c559c91b7638" class="">Выдача сигнализирует о том, что <strong>никаких данных не найдено</strong>, включая похожие результаты. Пользователю предлагается повторить поиск <strong>здесь же</strong>.</p><hr id="16f42927-0b72-8121-81ef-e40aa0ac3e60"/><p id="16f42927-0b72-81fb-9394-db29181b7c2c" class=""><strong>Формирование сообщения:</strong></p><p id="16f42927-0b72-818d-8667-f74f366db6a1" class="">В обоих случаях (V1 и V2) из <code>response_text</code> исключается <strong>первая строка</strong>, остальная часть текста выводится без изменений.</p><ul id="16f42927-0b72-81eb-8b2c-cb9ee609317c" class="bulleted-list"><li style="list-style-type:disc"><strong>Результат для V1:</strong><p id="16f42927-0b72-8152-98c8-d0a38b400e74" class=""><code>&quot;Model not found. Enter model number:&quot;</code></p></li></ul><ul id="16f42927-0b72-81c6-9681-e86fca74979d" class="bulleted-list"><li style="list-style-type:disc"><strong>Результат для V2:</strong><p id="16f42927-0b72-812b-8ca2-f9784cdd0547" class=""><code>&quot;Model number kbfn502ess02, kbfn502ess0, kbfn502ess, kbfn502es not found. Enter model number:&quot;</code></p></li></ul></details></li></ul><p id="16f42927-0b72-81d2-9ba2-db311745e578" class=""><strong>1.3.2. Select similar</strong></p><p id="16f42927-0b72-815f-ad9d-d189c10364e7" class="">Точное совпадение не найдено, но найдены похожие модели. Бот формирует инлайн-кнопки из БД. Следующий шаг — пользователь выбирает модель, и бот выполняет новый поиск.</p><ul id="16f42927-0b72-81b0-a902-e206e8cc78a7" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-81c2-9da6-ca59f07444f8" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8115-bbfe-ef1b91e48925" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%204.png"><img style="width:1006px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%204.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81ed-ae99-c0f29085c60b" class=""><strong>Условия:</strong></p><ul id="16f42927-0b72-810d-939d-ecfe425f3db1" class="bulleted-list"><li style="list-style-type:disc">В поле <code>response_text</code> содержится фраза <strong>&quot;Select similar&quot;</strong>.</li></ul><hr id="16f42927-0b72-8184-b160-d48c51c57ae3"/><p id="16f42927-0b72-81ff-babe-f303f447c82e" class=""><strong>Пример </strong><code><strong>response_text</strong></code><strong> V1:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8126-ac01-ff7960b2e634" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Model # not found. Select similar: https://11nk.link/19baa2
</code></pre><p id="16f42927-0b72-813f-b3eb-c9fe9fff15bb" class=""><strong>Пример </strong><code><strong>response_text</strong></code><strong> V2:</strong></p><p id="16f42927-0b72-81a0-8e2b-f6df510c918b" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81cd-8c03-d469afff3bd6" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Model # kbfn502ess02, kbfn502ess0, kbfn502ess, kbfn502es not found. Select similar: https://11nk.link/19baa2
</code></pre><hr id="16f42927-0b72-81a9-8ba7-e3ae6e6766ae"/><p id="16f42927-0b72-81fe-a5bc-e8abdb004071" class=""><strong>Смысл:</strong></p><p id="16f42927-0b72-81d4-857d-dfdfae16286a" class="">Это означает, что <strong>не найдено ничего, что можно точно идентифицировать</strong>, но обнаружены <strong>неточные вариации модели</strong> (есть записи в таблице <code>model_numbers</code> со статусом <code>0</code>, но нет со статусом <code>1</code>).</p><hr id="16f42927-0b72-816b-8bf7-d50407432daf"/><p id="16f42927-0b72-8152-b148-eb3c6bae052c" class=""><strong>Логика формирования инлайн-кнопок:</strong></p><ol type="1" id="16f42927-0b72-8162-8176-e64c5f9f6b4b" class="numbered-list" start="1"><li><strong>Используем таблицу </strong><code><strong>model_numbers</strong></code><strong>:</strong><ul id="16f42927-0b72-8159-bcc6-dd3b35e6d22c" class="bulleted-list"><li style="list-style-type:disc">По текущему <code>job_id</code> выбираем все модельные номера со статусом <code><strong>0</strong></code> (поле <code>model_number</code>).</li></ul></li></ol><ol type="1" id="16f42927-0b72-815e-95e1-cda078efaf73" class="numbered-list" start="2"><li><strong>Формат кнопки:</strong><ul id="16f42927-0b72-8119-ba74-e596158f4477" class="bulleted-list"><li style="list-style-type:disc">Название модели — из поля <code>model_number</code>.</li></ul><ul id="16f42927-0b72-811d-9b07-f440aa713d0d" class="bulleted-list"><li style="list-style-type:disc">В скобках указывается бренд (поле <code>brand</code>, таблица <code>model_numbers</code>).<ul id="16f42927-0b72-81c6-954a-cc9ee3560427" class="bulleted-list"><li style="list-style-type:circle">Если бренд отсутствует, скобки не выводятся.</li></ul></li></ul><ul id="16f42927-0b72-8129-acb0-f144c96d5afb" class="bulleted-list"><li style="list-style-type:disc">После модели указывается количество найденных документов (поле <code>Doc_Counter</code>, таблица <code>model_numbers</code>).</li></ul><p id="16f42927-0b72-8174-aed6-f458806bc3bb" class=""><strong>Пример кнопки:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-816a-a9ad-e41e5287e56e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">kbfn502ess (BrandName) — 12
</code></pre></li></ol><ol type="1" id="16f42927-0b72-8184-b64d-e652a6694743" class="numbered-list" start="3"><li><strong>Сортировка кнопок:</strong><ul id="16f42927-0b72-8151-982c-edf8d9b74e94" class="bulleted-list"><li style="list-style-type:disc">Кнопки сортируются по убыванию значения <code>Doc_Counter</code> (чем больше документов, тем выше кнопка в списке).</li></ul></li></ol><hr id="16f42927-0b72-8190-8327-fada413a5282"/><p id="16f42927-0b72-8129-b6bd-c7963d00605b" class=""><strong>Формирование сообщения:</strong></p><p id="16f42927-0b72-8114-bc23-ff03de00a359" class="">В обоих случаях (V1 и V2) из <code>response_text</code> исключается <strong>первая строка</strong>, остальная часть текста выводится без изменений.</p><ul id="16f42927-0b72-815d-8e84-fadf85128001" class="bulleted-list"><li style="list-style-type:disc"><strong>Результат для V1:</strong><p id="16f42927-0b72-8166-8c6f-f338fb640065" class=""><code>&quot;Model # not found. Select similar&quot;</code></p></li></ul><ul id="16f42927-0b72-81d0-b7d1-d596668226cb" class="bulleted-list"><li style="list-style-type:disc"><strong>Результат для V2:</strong><p id="16f42927-0b72-815b-9626-c25d5789c3c3" class=""><code>&quot;Model # kbfn502ess02, kbfn502ess0, kbfn502ess, kbfn502es not found. Select similar&quot;</code></p></li></ul><hr id="16f42927-0b72-81a4-a650-f7a164d7f16f"/><p id="16f42927-0b72-81b4-bb39-e2648f8e0cd2" class=""><strong>Действие при нажатии на инлайн-кнопку с модельным номером:</strong></p><ul id="16f42927-0b72-8125-aa09-d1a54108da0c" class="bulleted-list"><li style="list-style-type:disc">При выборе инлайн-кнопки с новым модельным номером пользователь автоматически переходит на <strong>шаг 1.2.2</strong>.</li></ul><ul id="16f42927-0b72-8158-9cd8-ca974bb96d0b" class="bulleted-list"><li style="list-style-type:disc">По этому модельному номеру мгновенно выполняется поиск, и результаты выдачи сразу отображаются пользователю.</li></ul><ul id="16f42927-0b72-8108-bd5d-ffc95e524e81" class="bulleted-list"><li style="list-style-type:disc">Пользователю <strong>не нужно вручную вводить или подтверждать</strong> модельный номер.</li></ul></details></li></ul></div></p><p id="16f42927-0b72-815c-b05c-e96e7f8e702a" class=""><div class="indented"><p id="16f42927-0b72-8186-b347-c88f973b7dfe" class=""><strong>1.3.3 Стандартная выдача</strong></p><p id="16f42927-0b72-81d2-99fb-f377353c6d68" class="">Когда модель найдена в базе данных, бот формирует сообщение для пользователя на основе данных из таблицы Response и связанных таблиц.</p><ul id="16f42927-0b72-81d8-aa95-e7df43d5cc67" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-81b0-a3ce-f4ca1bf81927" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">скрин  </mark></mark><mark class="highlight-blue"><mark class="highlight-yellow_background"><strong>Выдача по модельному номеру</strong></mark></mark></summary><figure id="16f42927-0b72-8115-a8eb-dc1273c9b351" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%205.png"><img style="width:599.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%205.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81f4-adb0-ec708d0169ef" class=""><strong>Условие:</strong></p><p id="16f42927-0b72-816c-b90a-d8bfdebd2243" class="">В поле <code>response_text</code> содержится вхождение <strong>&quot;Model #:&quot;</strong>.</p><hr id="16f42927-0b72-81fc-a5b0-d856ae43f96a"/><p id="16f42927-0b72-8147-bf88-e0b513e30a8f" class=""><strong>Пример </strong><code><strong>response_text</strong></code><strong>:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8186-8a45-e4109150285b" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Job 955: https://11nk.link/bdce56
Model #: WDTA50SAHZ0
Diagram: https://11nk.link/6cde69
Service manual: https://11nk.link/1be0fb
Techsheet: https://11nk.link/320261

Truck_stock:
3385556 / Hose-Drain
8269144A(8269144) / Drain Hose
8194001(W10158291) / Door Balance Link Kit
596669(371505) / 596669 Search Results
</code></pre><hr id="16f42927-0b72-810b-9c16-d25e725462cf"/><p id="16f42927-0b72-81eb-838f-cb65265387fc" class=""><strong>Смысл:</strong></p><p id="16f42927-0b72-8138-9b9e-f30a10bccea6" class="">Основной запрос юзера был обработан успешно, и по указанному <strong>Model #</strong> найдены данные в базе. Сейчас бот будет собирать информацию из БД в выдачу и формировать инлайн кнопки именно под эту модель.</p><hr id="16f42927-0b72-811d-b0cf-ebc02b814362"/><ul id="16f42927-0b72-81f9-82ee-d2c50f75bbd3" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>1.3.3.0 </strong></mark><strong>Формирование сообщения</strong></summary><p id="16f42927-0b72-81f5-b593-cbba9790392b" class="">Бот берет текст из поля response_text таблицы Response, обрезает первый абзац по определенному правилу и отправляет пользователю</p><p id="16f42927-0b72-8149-a1bb-e61a1ec24072" class=""><strong>Первый абзац:</strong></p><ul id="16f42927-0b72-81f7-81b1-ed438bcd8b85" class="bulleted-list"><li style="list-style-type:disc">Оставляем <strong>только строку &quot;Model #: ...&quot;</strong>.</li></ul><ul id="16f42927-0b72-81ab-bdbd-f1561dd534d9" class="bulleted-list"><li style="list-style-type:disc">Пункты <strong>Diagram, Service manual, Techsheet</strong> не выводим.</li></ul><p id="16f42927-0b72-811f-bfeb-c590343426a7" class=""><strong>Второй абзац:</strong></p><ul id="16f42927-0b72-812f-abaf-dd211c540107" class="bulleted-list"><li style="list-style-type:disc">Данные из раздела <strong>Truck_stock</strong> выводим без изменений.</li></ul><hr id="16f42927-0b72-8177-8ce0-f38d7b4115c4"/><p id="16f42927-0b72-8143-9350-ff142a9e8d82" class=""><strong>Пример итогового сообщения:</strong></p><p id="16f42927-0b72-8106-9d3f-ec2904db531a" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-810e-8357-cd0cc4905109" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Model #: WDTA50SAHZ0

Truck_stock:
3385556 / Hose-Drain
8269144A(8269144) / Drain Hose
8194001(W10158291) / Door Balance Link Kit
596669(371505) / 596669 Search Results
</code></pre></details></li></ul><p id="16f42927-0b72-81d2-b7e0-f77b521cacd2" class=""><strong>Инлайн-кнопки:</strong></p><p id="16f42927-0b72-8140-a109-c0e01e58f74d" class="">Формирование кнопок — это важная и достаточно замороченная процедура, требующая внимательной работы с данными из нескольких таблиц.<div class="indented"><ul id="16f42927-0b72-8136-92a3-fb129c6c5a2c" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>1.3.3.1 Ссылки на внешние сайты</strong></mark></summary><p id="16f42927-0b72-812f-bf49-d9effcecafb1" class="">Извлекаются из базы данных и ведут на страницы этой модели.</p><ul id="16f42927-0b72-81be-827b-fde21029f464" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание </mark></mark></summary><ul id="16f42927-0b72-819d-af2c-e10ee332d6d8" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8143-8e5e-f7c277a5c524"><div class="source"><a href="https://www.notion.soundefined"></a></div></figure></details></li></ul><ul id="16f42927-0b72-81ad-b615-e5746faa1cc0" class="bulleted-list"><li style="list-style-type:disc"><strong>Исходная таблица:</strong> используем данные из таблицы <code>job_docs</code>.</li></ul><ul id="16f42927-0b72-81e3-bd8a-f0adb8967b97" class="bulleted-list"><li style="list-style-type:disc">По <code>model_id</code> из таблицы <code>job_docs</code> переходим в таблицу <code>models</code> и ищем записи, которые относятся к <strong>категории 6 </strong>(ссылки на сайты).</li></ul><hr id="16f42927-0b72-8129-8d3a-e5a27080a3b6"/><p id="16f42927-0b72-81cb-a3d6-c6431c9d7a5b" class=""><strong>Формирование кнопок:</strong></p><ul id="16f42927-0b72-81b5-9894-ca4a35d6fd69" class="bulleted-list"><li style="list-style-type:disc"><strong>Название кнопки</strong> = <strong>Название сайта</strong> (берётся из таблицы <code>Sources</code>).</li></ul><ul id="16f42927-0b72-818f-9782-fff3d063aaea" class="bulleted-list"><li style="list-style-type:disc"><strong>Ссылка</strong>, открываемая при нажатии кнопки, берётся из поля <code>web_link</code> таблицы <code>models</code>.</li></ul><hr id="16f42927-0b72-812c-9031-d1c1836ae160"/><p id="16f42927-0b72-814f-ad8f-ea715a9cb926" class=""><strong>Максимум показываются 4 кнопки (с минимальным поле Confidense, таблицы Sources. при одинаковых - берем любой) </strong></p><hr id="16f42927-0b72-81e2-a333-ea98cced9754"/><ul id="16f42927-0b72-819b-9f45-d883fc356c27" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>Кнопка &quot;Show more ↓↓↓&quot;:</strong></mark></summary><ul id="16f42927-0b72-81e1-aaf2-e00f0e5fd6d5" class="bulleted-list"><li style="list-style-type:disc">Показывает дополнительные кнопки с сайтами категории <strong>6</strong>, если они есть.</li></ul><ul id="16f42927-0b72-81fa-a5d2-d464d09afd8b" class="bulleted-list"><li style="list-style-type:disc">Если все сайты уже отображены, кнопка <strong>не выводится</strong>.</li></ul></details></li></ul></details></li></ul></details></li></ul><ul id="16f42927-0b72-81ff-a854-f4a6e81c6658" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>1.3.3.2 Списки деталей с картинками:</strong></mark><mark class="highlight-teal_background"> </mark></summary><p id="16f42927-0b72-8139-b332-e3be6a222678" class="">Формируются на основе данных из базы</p><p id="16f42927-0b72-81f1-93e2-f23f5cabd4f4" class=""><strong>1.4.1 Action with parts. Простой список деталей</strong></p><p id="16f42927-0b72-8191-8e03-ea26dff60869" class="">Бот отображает список деталей, связанных с текущей работой (<code>job_id</code>), на основе данных из таблицы <code>job_stocks</code>.</p><ul id="16f42927-0b72-8167-a981-d5b07e704f5e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-810f-8efa-dbbe48b692ae" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8119-9ad3-d979cdc8251a" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%206.png"><img style="width:519.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%206.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-815d-8ef5-f7fbc233ae8d" class="bulleted-list"><li style="list-style-type:disc">Вводные данные: список деталей из <code>job_stocks</code> для указанного <code>job_id</code>.</li></ul><ul id="16f42927-0b72-8168-b970-dec0bd9c8d27" class="bulleted-list"><li style="list-style-type:disc">Список включает информацию о стоках, где находятся детали, из таблицы <code>user_stocks</code>.</li></ul><ul id="16f42927-0b72-8129-9990-ca6ab8783117" class="bulleted-list"><li style="list-style-type:disc">Список запчастей формируется и отображается пользователю. Согласно <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">“Правилам отображения списка запчастей”</a></li></ul><p id="16f42927-0b72-810e-838d-d8135173dafc" class=""><strong>Примечание:</strong></p><p id="16f42927-0b72-811f-a9c8-c8ab9a47fd48" class="">Данные о стоках обязательны и отображаются для каждой детали. </p><p id="16f42927-0b72-8117-ab3d-fabc636bbe83" class="">
</p></details></li></ul><p id="16f42927-0b72-8114-b004-f7b421ed877d" class=""><strong>1.4.2 Common parts. Отсортированный список деталей. </strong></p><p id="16f42927-0b72-8141-9b41-c39b614593db" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background">Пока не делать, структура бд может поменяться. Ставим заглушку</mark></mark></p><p id="16f42927-0b72-81e3-8024-c19793a92dcb" class=""><mark class="highlight-teal_background"><strong> </strong></mark></p></details></li></ul><p id="16f42927-0b72-811e-92d8-d19f3f452809" class=""><mark class="highlight-teal_background"><strong>1.3.3.3 Кнопка &quot;Select similar&quot;</strong></mark></p><p id="16f42927-0b72-81f0-b3c7-e7f9b87f3dad" class="">Предлагает похожие модели (повторяет логику из <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">п.1.3.2</a>)</p><ul id="16f42927-0b72-8145-a201-e2eebb5481ae" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>1.3.3.4 Ссылки на PDF документы</strong></mark></summary><p id="16f42927-0b72-81a8-888f-eec2968570c2" class="">Ссылки (не сами PDF файлы) извлекаются из поля response_text. Они отображаются с определенной вероятностью, заданной в таблице users. Т.е. инлайн-кнопки с ссылками на пдф документы юзер получит не всегда, а с определенной математической вероятностью. С помощью кнопки Deep Search - расчет вероятности будет повторен, и возможно будут выведены кнопки, которые не были выведены ранее.</p><ul id="16f42927-0b72-81f6-bbcd-e07c284c2c87" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-814f-973c-ed4988adcbfd" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8103-8b97-ca3a2ffc53d5" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%207.png"><img style="width:1036px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%207.png"/></a></figure></details></li></ul><h3 id="16f42927-0b72-81fa-8ba6-d2b859a55b23" class="">Функционал:</h3><ol type="1" id="16f42927-0b72-8127-83e4-e0ed8b26ac2d" class="numbered-list" start="1"><li><strong>Ссылки на документы (PDF):</strong><ul id="16f42927-0b72-8124-9c06-c3ee63a6c9ea" class="bulleted-list"><li style="list-style-type:disc"><strong>Diagram (PDF)</strong>, <strong>Service manual (PDF)</strong>, <strong>Techsheet (PDF)</strong>:<ul id="16f42927-0b72-81e9-bf64-f3f0e11707ac" class="bulleted-list"><li style="list-style-type:circle">Эти кнопки отображаются только в случае, если соответствующие ссылки присутствуют в <code>response_text</code>.</li></ul><ul id="16f42927-0b72-815a-8206-e680e08fada0" class="bulleted-list"><li style="list-style-type:circle">Каждая кнопка ведет на указанную ссылку.</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-8130-a24c-eeebd50416be" class="numbered-list" start="2"><li><strong>Вероятность отображения кнопок:</strong><ul id="16f42927-0b72-8177-81b0-e1d56c07623c" class="bulleted-list"><li style="list-style-type:disc">Вероятность показа каждой кнопки зависит от значений полей в таблице <code>users</code>:<ul id="16f42927-0b72-8177-914b-f7315c402f86" class="bulleted-list"><li style="list-style-type:circle"><code>diagram_probability</code> — вероятность показа кнопки для диаграммы.</li></ul><ul id="16f42927-0b72-8120-93c7-c5391951d4fb" class="bulleted-list"><li style="list-style-type:circle"><code>manual_probability</code> — вероятность показа кнопок для сервисных мануалов и техшитов.</li></ul></li></ul><ul id="16f42927-0b72-819a-a10d-db2a93b0224d" class="bulleted-list"><li style="list-style-type:disc">Значения вероятности варьируются от <code>0</code> до <code>100</code>.</li></ul><ul id="16f42927-0b72-8146-952e-d38abcc8f175" class="bulleted-list"><li style="list-style-type:disc">Пример: если <code>diagram_probability = 50</code>, кнопка диаграммы будет показана только в 50% случаев, даже если ссылка на документ присутствует.</li></ul></li></ol><hr id="16f42927-0b72-813d-825b-c889d76635a8"/><h3 id="16f42927-0b72-81c9-9030-e881ded23642" class="">Логика работы:</h3><ol type="1" id="16f42927-0b72-81d1-b86e-fab91ab7a4d7" class="numbered-list" start="1"><li><strong>Извлечение данных:</strong><ul id="16f42927-0b72-810e-bc7c-d1ae8afc586d" class="bulleted-list"><li style="list-style-type:disc">Проверяем наличие ссылок в <code>response_text</code>.</li></ul><ul id="16f42927-0b72-81d7-8949-c4071e3a37c4" class="bulleted-list"><li style="list-style-type:disc">Если ссылки есть, выполняем расчет вероятности на основе значений из таблицы <code>users</code>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-813e-a7b1-dfcd06a7fc60" class="numbered-list" start="2"><li><strong>Добавление кнопок:</strong><ul id="16f42927-0b72-81a2-9e02-c134df07796f" class="bulleted-list"><li style="list-style-type:disc">Формируем инлайн-кнопки:<ul id="16f42927-0b72-81f0-93d0-e3e579513253" class="bulleted-list"><li style="list-style-type:circle">Текст кнопки: Название документа (например, &quot;Diagram (PDF)&quot;).</li></ul><ul id="16f42927-0b72-81d7-be0a-f2bf372acd3b" class="bulleted-list"><li style="list-style-type:circle">Ссылка: Указанная в <code>response_text</code>.</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-8181-8284-f00632605f27" class="numbered-list" start="3"><li><strong>При нажатии кнопки &quot;</strong><strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Deep search</a></strong><strong>&quot;:</strong><ul id="16f42927-0b72-81c7-b073-cea00ca01f95" class="bulleted-list"><li style="list-style-type:disc">Выполняем повторный расчет вероятности для всех документов.</li></ul><ul id="16f42927-0b72-8194-a48d-fb4e7b471330" class="bulleted-list"><li style="list-style-type:disc">Новые кнопки добавляются к уже существующим.</li></ul></li></ol><hr id="16f42927-0b72-8103-8e6a-f2dc9c64a5f4"/><h3 id="16f42927-0b72-81e1-b823-ed7ff5e7c0db" class="">Пример инлайн-кнопок:</h3><ul id="16f42927-0b72-81c5-b4cb-fe588fa4cfa2" class="bulleted-list"><li style="list-style-type:disc">Diagram (PDF) → [<a href="https://11nk.link/0637d">https://11nk.link/0637d</a>]</li></ul><ul id="16f42927-0b72-811e-bd1c-f092ba8359ab" class="bulleted-list"><li style="list-style-type:disc">Service manual (PDF) → [<a href="https://11nk.link/0637d">https://11nk.link/0637d</a>]</li></ul><ul id="16f42927-0b72-811a-982c-f0e67ca428dd" class="bulleted-list"><li style="list-style-type:disc">Techsheet (PDF) → [<a href="https://11nk.link/0637d">https://11nk.link/0637d</a>]</li></ul><ul id="16f42927-0b72-81fa-9476-ef82a1c048c2" class="bulleted-list"><li style="list-style-type:disc">Deep search → Триггер на повторный расчет вероятности и добавление новых кнопок.</li></ul><p id="16f42927-0b72-813d-9e59-dfb2ab0d19d3" class="">
</p></details></li></ul><ul id="16f42927-0b72-817e-b3c8-f40a4af690b1" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>1.3.3.5 </strong></mark><strong>Кнопка &quot;Deep search&quot;:</strong></summary><ul id="16f42927-0b72-8162-8cc7-ca0781b0e021" class="bulleted-list"><li style="list-style-type:disc">Повторяет расчет вероятности для всех документов.</li></ul><ul id="16f42927-0b72-81e3-aeb0-d21f2f093bdd" class="bulleted-list"><li style="list-style-type:disc">Если вероятность срабатывает, соответствующие кнопки добавляются.</li></ul><ul id="16f42927-0b72-8137-bcb9-ef52bf78bf09" class="bulleted-list"><li style="list-style-type:disc">Уже показанные кнопки остаются, новые добавляются без удаления старых.</li></ul><ul id="16f42927-0b72-8183-baf1-ce19720163d1" class="bulleted-list"><li style="list-style-type:disc"><strong>Как работает:</strong><ul id="16f42927-0b72-8178-8805-efab100e5ecb" class="bulleted-list"><li style="list-style-type:circle">При нажатии бот заново рассчитывает вероятность показа документов (PDF) для уже известных данных и выводит те, которые ранее не были показаны</li></ul><ul id="16f42927-0b72-814b-8fb2-daf6dbad8cbf" class="bulleted-list"><li style="list-style-type:circle">Показывается сообщение «Web-searching…&quot;, затем ожидание случайного времени (20–40 секунд).</li></ul><ul id="16f42927-0b72-8126-83b3-d1043cb59b9e" class="bulleted-list"><li style="list-style-type:circle">Если вероятность показала, что нужно отобразить кнопку - то Создаются соответствующие инлайн-кнопки, а сообщение &quot;Web-searching…&quot; заменяется на одно из следующих:<ul id="16f42927-0b72-812f-bf8c-d37e1037c761" class="bulleted-list"><li style="list-style-type:square">&quot;Diagram found.&quot;</li></ul><ul id="16f42927-0b72-8120-b127-f31ec3fa4bfd" class="bulleted-list"><li style="list-style-type:square">&quot;Service manual found.&quot;</li></ul><ul id="16f42927-0b72-81a2-8b70-fe261a5593bd" class="bulleted-list"><li style="list-style-type:square">&quot;Tech sheet found.&quot;</li></ul></li></ul><ul id="16f42927-0b72-815f-b098-f0a25b30453d" class="bulleted-list"><li style="list-style-type:circle">Ранее выведенные кнопки остаются, т.е. это не перезапуск всего набора кнопок, а дополнение к уже существующим</li></ul><p id="16f42927-0b72-81d2-8d19-fda5e6049e4b" class="">Кнопка &quot;Deep search&quot; может использоваться повторно до тех пор, пока все материалы не будут показаны.</p></li></ul></details></li></ul></details></li></ul></div></p></details></li></ul></div></p></details></li></ul><h1 id="16f42927-0b72-8131-9111-fb4c68b9fe43" class=""><strong>2. Ветка “Find part” </strong></h1><ul id="16f42927-0b72-818b-bd4f-fb7d81b88ad8" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание режима Find part </mark></mark></summary><p id="16f42927-0b72-8132-8aca-e480a9aa3526" class=""><strong>Второй</strong> <strong>из двух основных режимов работы — поиск в БД по номеру детали (парт номеру).</strong> Пользователь вводит партномер вручную или отправляет изображение с баркодом. Бот выполняет поиск по запросу в базе данных и сразу формирует готовую &quot;Страницу Детали&quot; с результатами.</p><p id="16f42927-0b72-8116-88c8-c9971aeabf4d" class=""><strong>Инлайн кнопки</strong> на первой странице для режима <strong>“Find part”</strong> относятся к управлению стоком пользователя. Они являются отправной точкой для перехода к функционалу управления стоком, который подробно рассмотрен в пункте 3 ТЗ.</p><ul id="16f42927-0b72-81fb-90a5-f697bca42ee6" class="toggle"><li><details open=""><summary><strong>2.0 Начальный экран Find parts</strong></summary><ul id="16f42927-0b72-8124-9c03-d1875904b240" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81e7-889e-c237ad284788" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%208.png"><img style="width:435.9875183105469px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%208.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8169-a4d7-d4ac2a8bd44f" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-8105-b31e-feac58217606" class="">На <strong>инлайн-кнопках </strong>выводим список всех стоков текущего пользователя, где каждый сток отображается с именем из таблицы <strong>stock_creds</strong> (поле <strong>stock_name</strong>) и числом запчастей (поле <strong>record_count</strong>). Если число запчастей равно 0 или <strong>Null</strong>, число в скобках не отображается.</p><p id="16f42927-0b72-81da-91be-e2adbafbc5fd" class="">Формат:</p><ul id="16f42927-0b72-81e9-9ec0-f233f7a444ff" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;stock_name&gt; (&lt;record_count&gt;)</code></li></ul><p id="16f42927-0b72-81a3-9bf3-ef2107c7d13f" class="">Кнопки:</p><ol type="1" id="16f42927-0b72-816d-9556-e542ff2ba16e" class="numbered-list" start="1"><li>Список стоков. Например:<ul id="16f42927-0b72-8175-9298-ef6aabdccdcc" class="bulleted-list"><li style="list-style-type:disc"><code>Main Stock (15)</code></li></ul><ul id="16f42927-0b72-81eb-935e-d8091d0394ab" class="bulleted-list"><li style="list-style-type:disc"><code>Spare Parts</code></li></ul></li></ol><ol type="1" id="16f42927-0b72-81b7-a9b7-c5530cb54c0e" class="numbered-list" start="2"><li>Кнопка <strong>Add New Stock</strong>, которая ведет к процедуре добавления нового стока, описанной в пункте 3.1 ТЗ.</li></ol><p id="16f42927-0b72-81ce-bf57-e4bed411e3db" class=""><strong>2.1 Проверка запроса</strong></p><ul id="16f42927-0b72-8143-befe-ff7d4df9224c" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание</mark></mark></summary><ul id="16f42927-0b72-81be-9cd5-d6fb1b1978cd" class="bulleted-list"><li style="list-style-type:disc">Если длина текста превышает 20 символов, содержит пробелы или абзацы, бот выводит сообщение об ошибке: <strong>“Unrecognized request. Please try again.”</strong> Пользователь остается на текущем экране с инлайн-кнопками.</li></ul><ul id="16f42927-0b72-8148-bb39-cbd583651224" class="bulleted-list"><li style="list-style-type:disc">Если текст соответствует требованиям (не более 20 символов, без пробелов и абзацев), он проходит проверку и отправляется для обработки.</li></ul><ul id="16f42927-0b72-81b3-b805-f4466369c691" class="bulleted-list"><li style="list-style-type:disc">Бот принимает только текст или одно(!) изображение. При отправке любого другого формата пользователь получает сообщение: <strong>“Unrecognized request. Please try again.”</strong></li></ul><ul id="16f42927-0b72-8151-8843-e2d8f5cc0ac1" class="bulleted-list"><li style="list-style-type:disc">На ветке 2 смешанные запросы (например, картинка + текст или текст + файл) недопустимы. В таком случае возвращается сообщение: &quot;Unrecognized request. Please try again.”</li></ul><ul id="16f42927-0b72-817d-a515-fe5f3e03f711" class="bulleted-list"><li style="list-style-type:disc">Бот должен одинаково обрабатывать отправку картинки как в виде файла, так и в виде изображения.</li></ul><ul id="16f42927-0b72-8180-9cce-d846a1406f7e" class="bulleted-list"><li style="list-style-type:disc">Все валидные запросы записываются в таблицу <code><strong>Parts_barcode</strong></code>, после чего пользователь перенаправляется на страницу детали 2.3.</li></ul><ul id="16f42927-0b72-81a6-91a6-c74f6b4522a8" class="bulleted-list"><li style="list-style-type:disc">Все невалидные запросы не сохраняются в БД, а пользователь получает сообщение об ошибке.</li></ul><ul id="16f42927-0b72-81f1-8733-d093663a6914" class="bulleted-list"><li style="list-style-type:disc">Фото поддерживаемых форматов (PNG, JPEG, JPG).</li></ul><ul id="16f42927-0b72-814b-96ba-f3664fa6a27b" class="bulleted-list"><li style="list-style-type:disc">Фото неподдерживаемых форматов (TIFF, BMP, GIF, WEBP). </li></ul></details></li></ul></details></li></ul><h2 id="16f42927-0b72-818b-bcfe-d87cd942bc76" class=""><strong>2.2 Варианты поискового запроса юзера.</strong></h2><p id="16f42927-0b72-815e-9516-e464ce0b0bbc" class="">Пользователь может выполнить поиск по фотографии с баркодом или текстовому запросу (партномер). Бот обрабатывает запрос, проверяет базу данных и пользовательские стоки, выводя результат или переходя на страницу карточки детали.</p><p id="16f42927-0b72-815f-ac76-cacbeb6c4e3c" class="">Поисковый запрос на экранах веток <strong>“2. Find Parts”</strong> и <strong>“3. Manage Stocks”</strong> выполняется одинаково, кроме экранов, где пользователь вводит данные по запросу бота.</p><p id="16f42927-0b72-8198-8e19-e42f35986d1a" class=""><div class="indented"><h2 id="16f42927-0b72-81ea-ba45-d52b83788f97" class=""><strong>2.2.1 Поисковой запрос (картинка)</strong></h2><ul id="16f42927-0b72-81c0-a88e-de69bc46d643" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание </mark></mark></summary><p id="16f42927-0b72-8138-aa65-c75861632e89" class="">Бот принимает загруженную пользователем фотографию, сохраняет ее в таблицу <code><strong>Parts_barcode</strong></code> и каждые 2 секунды проверяет статус обработки. Если баркод не распознан, пользователь получает сообщение об ошибке; если деталь найдена в базе, бот переводит пользователя на страницу <strong>2.3 Карточка детали</strong>. В остальных случаях бот продолжает проверку до завершения обработки.</p><h3 id="16f42927-0b72-8188-bb0b-dee39c075589" class=""><strong>1. Действия пользователя:</strong></h3><ul id="16f42927-0b72-81b5-81f0-daf503a57086" class="bulleted-list"><li style="list-style-type:disc">Пользователь загружает одну фотографию.</li></ul><hr id="16f42927-0b72-81ac-b0e8-fc1c674baff6"/><h3 id="16f42927-0b72-81da-917b-d2757c9c90a0" class=""><strong>2. Действия бота после отправки фотографии:</strong></h3><ol type="1" id="16f42927-0b72-8109-95dd-e417834212a0" class="numbered-list" start="1"><li>Отправляем пользователю сообщение “⏳ Processing your request.”</li></ol><ol type="1" id="16f42927-0b72-8165-b457-fab5050934e0" class="numbered-list" start="2"><li><strong>Сохранение файла:</strong><ul id="16f42927-0b72-8100-be06-ea0b50d181e7" class="bulleted-list"><li style="list-style-type:disc">Фотография сохраняется на сервере в папку:<code>users/{user_id}/Parts_barcode</code>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-81b2-adf1-f70c73914f24" class="numbered-list" start="3"><li><strong>Запись в таблицу </strong><code><strong>Parts_barcode</strong></code><strong>:</strong><ul id="16f42927-0b72-81ec-a55e-fbf9e066a16f" class="bulleted-list"><li style="list-style-type:disc">Для каждой загруженной фотографии создается новая запись в таблице <code><strong>Parts_barcode</strong></code> со следующими данными:<ul id="16f42927-0b72-8165-b155-d6e1a21ab089" class="bulleted-list"><li style="list-style-type:circle"><code><strong>id</strong></code> — уникальный идентификатор записи (автоинкремент).</li></ul><ul id="16f42927-0b72-81ae-a279-db4d877abb0f" class="bulleted-list"><li style="list-style-type:circle"><code><strong>user_id</strong></code> — идентификатор пользователя, загрузившего фото.</li></ul><ul id="16f42927-0b72-81f7-9e28-cd71b9bedef0" class="bulleted-list"><li style="list-style-type:circle"><code><strong>stock_id</strong></code> — идентификатор текущего стока. Оставляется пустым.</li></ul><ul id="16f42927-0b72-81f0-9fec-f31a46f65381" class="bulleted-list"><li style="list-style-type:circle"><code><strong>photo_path</strong></code> — путь к сохраненному изображению (относительный путь в директории).</li></ul><ul id="16f42927-0b72-81d6-9a4f-c2c1cf46ada9" class="bulleted-list"><li style="list-style-type:circle"><code><strong>recognized_part_number</strong></code> — пустое значение (ожидает распознавания).</li></ul><ul id="16f42927-0b72-8173-a819-c534ea0553a7" class="bulleted-list"><li style="list-style-type:circle"><code><strong>parts_and_replaces_id</strong></code> — пустое значение (ожидает обработки).</li></ul><ul id="16f42927-0b72-81b5-84a0-e07decdba7c6" class="bulleted-list"><li style="list-style-type:circle"><code><strong>status</strong></code> — устанавливается как <strong>0 (Новая запись)</strong>.</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-81b9-926c-ca3ae1e04fea" class="numbered-list" start="4"><li><strong>Проверка статусов:</strong><ul id="16f42927-0b72-81c5-9edd-c532d6d63350" class="bulleted-list"><li style="list-style-type:disc">Бот каждые 2 секунды проверяет статус записи в таблице <code><strong>Parts_barcode</strong></code>.в течении 2х минут. Если статус не стал одним из <strong>4, 6, 7</strong> за 2 минуты - пишем сообщение: &quot;An error occurred while processing your request. Please try again later or contact support if the issue persists.” и оставляем запись в таблице ошибок.</li></ul></li></ol><ul id="16f42927-0b72-8117-b1f6-ffbd429905b7" class="toggle"><li><details open=""><summary><strong>Описание статусов:</strong></summary><p id="16f42927-0b72-812d-97c2-cb5fde8398f6" class="">0 - <strong>New</strong> <em>(Новая запись - спец_запрос)</em></p><p id="16f42927-0b72-8174-9e98-d7ed175bcba4" class="">1 - <strong>New</strong> <em>(Новая запись)</em></p><p id="16f42927-0b72-8154-a82e-fa0d44def779" class="">2 - <strong>Partnumber_Validated</strong> <em>(Прошла баркод корректно)</em></p><p id="16f42927-0b72-81b7-8bdb-ef6649856af8" class="">3 - <strong>Barcode Not Recognized</strong> <em>(Прошла баркод некорректно)</em></p><p id="16f42927-0b72-81c8-9a22-dcc0281dd610" class="">4 - <strong>Database Match</strong> <em>(Найдено в базе данных)</em></p><p id="16f42927-0b72-813d-a24c-f187f9287e4d" class="">5 - <strong>Not Found in Database</strong> <em>(Не найдено в базе данных)</em></p><p id="16f42927-0b72-81ac-9e1a-c5342bf1209e" class="">6 - <strong>Online Match</strong> <em>(Найдено в интернете)</em></p><p id="16f42927-0b72-81e3-8488-d6d9d61ecbf9" class="">7 - <strong>Not Found Online</strong> <em>(Не найдено в интернете)</em></p></details></li></ul><hr id="16f42927-0b72-815f-94bd-e6fd65ed979b"/><h3 id="16f42927-0b72-8103-825a-e9a57ad96ced" class=""><strong>3. Логика обработки статусов:</strong></h3><ol type="1" id="16f42927-0b72-8113-b026-e4195d203061" class="numbered-list" start="1"><li><strong>Статус 3:</strong><ul id="16f42927-0b72-812d-81ad-e965e6d691b8" class="bulleted-list"><li style="list-style-type:disc">Если статус записи = <strong>3 (Barcode Not Recognized)</strong>:<ul id="16f42927-0b72-8116-b95f-e8f787ba4aa1" class="bulleted-list"><li style="list-style-type:circle">Бот отправляет сообщение пользователю:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-819b-9dc3-cae410457227" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Barcode was not recognized correctly.
Please try uploading a different photo.
</code></pre></li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-81fa-9fc8-c5e6ff1ca7f5" class="numbered-list" start="2"><li><strong>Статусы 0, 1, 2, 5:</strong><ul id="16f42927-0b72-819f-ac72-d305ab23e3a5" class="bulleted-list"><li style="list-style-type:disc">Эти статусы указывают на то, что обработка еще не завершена.</li></ul><ul id="16f42927-0b72-8125-aad9-f4b1058625a3" class="bulleted-list"><li style="list-style-type:disc">Бот пропускает эти записи и продолжает проверку.</li></ul></li></ol><ol type="1" id="16f42927-0b72-81ab-892a-e9c32d1c1193" class="numbered-list" start="3"><li><strong>Статусы 4, 6, 7:</strong><ul id="16f42927-0b72-8116-97ab-f84e3e95000d" class="bulleted-list"><li style="list-style-type:disc">Эти статусы означают, что для записи найдена связь с таблицей <code><strong>Parts_and_Replaces</strong></code>.</li></ul><ul id="16f42927-0b72-81f3-996a-d380891246f8" class="bulleted-list"><li style="list-style-type:disc">Бот формирует карточку детали и переводит пользователя на страницу <strong>2.3 — Карточка детали</strong>.</li></ul></li></ol><hr id="16f42927-0b72-81da-a083-cfa58d055250"/><h3 id="16f42927-0b72-81e4-a521-e175fbf673d1" class=""><strong>Итог:</strong></h3><p id="16f42927-0b72-8108-95be-d3851e1590ca" class="">Бот сохраняет загруженную фотографию, записывает информацию в таблицу <code><strong>Parts_barcode</strong></code>, проверяет статусы каждые 2 секунды и в зависимости от статуса:</p><ul id="16f42927-0b72-8197-9e3a-dcb0c19d936b" class="bulleted-list"><li style="list-style-type:disc">Сообщает об ошибке распознавания и предлагает загрузить другую фотографию.</li></ul><ul id="16f42927-0b72-81dd-9dbb-e38543890b18" class="bulleted-list"><li style="list-style-type:disc">Ждет завершения обработки 2 минуты. После этого завершает работу.</li></ul><ul id="16f42927-0b72-81b9-8033-dfe511e3c886" class="bulleted-list"><li style="list-style-type:disc">Переходит на страницу с карточкой детали, если деталь распознана и найдена в базе данных.</li></ul></details></li></ul><p id="16f42927-0b72-8144-ab52-f0f3068df97c" class=""><strong> </strong></p><h2 id="16f42927-0b72-813e-9cd3-e7455bf7bdbc" class=""><strong>2.2.2 Поисковой запрос (текст)</strong></h2><ul id="16f42927-0b72-8124-a219-ca86d5f072cc" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание</mark></mark></summary><p id="16f42927-0b72-8185-a35f-c8d095321b22" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-816e-81fa-c6d4a6a1062a" class="">Бот принимает текстовый запрос (партномер), ищет информацию о детали в таблице <code><strong>parts_and_replaces</strong></code> <mark class="highlight-yellow_background">и проверяет наличие в пользовательских стоках через</mark> <code><strong>user_stocks</strong></code>. Если деталь найдена в таблице <code><strong>parts_and_replaces</strong></code>, пользователь переходит на <strong>2.3 Карточка детали</strong>; если нет, запрос записывается в таблицу <code><strong>Parts_barcode</strong></code>, и бот продолжает опрашивать таблицу, пока не появится статус, позволяющий перейти на <strong>2.3</strong>. Информация о наличии детали в стоках отображается в сообщении, но не влияет на переходы.</p><h3 id="16f42927-0b72-813d-87ac-c9a45c743c3d" class=""><strong>1. Действия пользователя:</strong></h3><ul id="16f42927-0b72-81b1-a3f3-c752302680f7" class="bulleted-list"><li style="list-style-type:disc">Пользователь отправляет текстовый запрос с партномером.</li></ul><hr id="16f42927-0b72-8181-99fc-f6e5b63e5958"/><h3 id="16f42927-0b72-8163-9b1a-cdae30f5a77f" class=""><strong>2. Действия бота:</strong></h3><ol type="1" id="16f42927-0b72-81d4-8d24-e8a5f3fb1ac4" class="numbered-list" start="1"><li><strong>Поиск информации о детали в базе данных:</strong><ul id="16f42927-0b72-8116-85e5-c5c5db62176f" class="bulleted-list"><li style="list-style-type:disc">Бот ищет партномер в поле <code>Replaces</code> таблицы <code><strong>parts_and_replaces</strong></code>.</li></ul><ul id="16f42927-0b72-8185-89b2-e5befa5cdeaf" class="bulleted-list"><li style="list-style-type:disc">Если запись найдена, подтягиваются:<ul id="16f42927-0b72-81c3-9113-eb29912cd119" class="bulleted-list"><li style="list-style-type:circle"><strong>Картинка</strong> из поля <code>pic</code>.</li></ul><ul id="16f42927-0b72-81ae-bcf0-d6b588aba68e" class="bulleted-list"><li style="list-style-type:circle"><strong>Название детали</strong> из поля <code>part_name</code>.</li></ul><ul id="16f42927-0b72-81c5-89f2-c8e0cfa56912" class="bulleted-list"><li style="list-style-type:circle"><strong>Ссылка на изображение</strong> из поля <code>pic_link</code> (если доступно).</li></ul></li></ul></li></ol><p id="16f42927-0b72-81a1-bc6e-c43fa43a6544" class="">
</p><hr id="16f42927-0b72-8194-a895-f70f11685700"/><h3 id="16f42927-0b72-812d-85e9-ca22ea7e2fc7" class=""><strong>3. Результат поиска:</strong></h3><ol type="1" id="16f42927-0b72-81a1-8071-e93a78e0f5ed" class="numbered-list" start="1"><li><strong>Если деталь найдена :</strong><ul id="16f42927-0b72-81b6-923f-c20e8a1bf4b6" class="bulleted-list"><li style="list-style-type:disc">Бот переходит на страницу <strong>2.3 Карточка детали</strong> по данному партномеру.</li></ul><ul id="16f42927-0b72-817a-aab0-f86cfb3aa90c" class="bulleted-list"><li style="list-style-type:disc">Бот создает новую запись и записывает запрос в таблицу <code><strong>Parts_barcode</strong></code> в поле <code><strong>recognized_part_number</strong></code> со статусом 4. Это действие нужно чтобы логгировать запросы юзера.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8150-8e5c-ec4cd47e6539" class="numbered-list" start="2"><li><strong>Если деталь не найдена:</strong><ul id="16f42927-0b72-81e6-bbea-ef1268c531a8" class="bulleted-list"><li style="list-style-type:disc">Бот создает новую запись и записывает запрос в таблицу <code><strong>Parts_barcode</strong></code> в поле <code><strong>recognized_part_number</strong></code> со статусом 0<strong> (</strong>Online_Request<strong>)</strong>.</li></ul><ul id="16f42927-0b72-81b1-93d7-e97ecd7efdbc" class="bulleted-list"><li style="list-style-type:disc">Далее бот находится в ожидании когда другой скрипт соберет информацию по этому запросу и не изменит статус. Отрабатывается аналогично сценарию из <strong>пункта 2.2.1 (раздела </strong><strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">3. Логика обработки статусов</a></strong><strong>) </strong>начиная со статуса 2</li></ul></li></ol><hr id="16f42927-0b72-8111-80cd-e609836d5499"/><h3 id="16f42927-0b72-8143-90e8-c76576246b06" class=""><strong>4. Итог:</strong></h3><ul id="16f42927-0b72-817d-9e1f-d726b423c9d2" class="bulleted-list"><li style="list-style-type:disc">Если информация о детали найдена, бот переходит на <strong>2.3 Карточка детали</strong>.</li></ul><ul id="16f42927-0b72-81de-ab41-fe2375afe857" class="bulleted-list"><li style="list-style-type:disc">Если деталь не найдена, бот записывает партномер в таблицу <code><strong>Parts_barcode</strong></code> и, как и в предыдущем пункте, продолжает опрашивать таблицу, пока не появится нужный статус, позволяющий перейти на страницу <strong>2.3 Страница детали</strong>.</li></ul><p id="16f42927-0b72-8146-89bf-f8613aadce31" class="">
</p></details></li></ul><p id="16f42927-0b72-81b4-84e7-d24d6469a3c3" class="">
</p><h2 id="16f42927-0b72-81b8-a19a-d8c7fbc5499e" class=""><strong>2.3 Формирование выдачи - Страница детали</strong></h2><ul id="16f42927-0b72-8108-af21-f030f0db1148" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background"><strong>Описание:</strong></mark></mark></summary><ul id="16f42927-0b72-81ed-9814-d81a1d56a108" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8157-800c-cc502fadfbfc" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%209.png"><img style="width:599.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%209.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8141-99ef-e43fafc886f6" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-81c3-8cd7-d5b78d219368" class="">Эта страница отображается в двух случаях:</p><ol type="1" id="16f42927-0b72-8139-b6ba-c775a2ae08ce" class="numbered-list" start="1"><li>Пользователь ввел запрос на ветке <strong>Find parts</strong>. <span style="border-bottom:0.05em solid">Независимо от того, какой запрос ввел пользователь и была ли деталь найдена в базе данных, если запрос прошел валидацию (2.1), пользователь всегда попадет на страницу детали, где сможет создать и добавить новую деталь в свой сток, даже если она не найдена.</span></li></ol><ol type="1" id="16f42927-0b72-81c7-83f0-f3c83062f79e" class="numbered-list" start="2"><li>Пользователь выбрал деталь из списка деталей.</li></ol><p id="16f42927-0b72-81bb-9dc9-eb135e5878cc" class="">На странице отображается информация о детали и доступны действия, связанные с этой деталью.</p><ul id="16f42927-0b72-8180-8749-e4d1639c3268" class="toggle"><li><details open=""><summary><strong>Сообщения</strong></summary><p id="16f42927-0b72-8100-9ea5-e2102c446aeb" class="">После <strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Поиска</a></strong> на предыдущем шаге мы должны были получить связь этой детали с таблицей <code>parts_and_replaces</code> - оттуда мы получим название детали и картинку.</p><p id="16f42927-0b72-813e-a055-e339182ed74e" class="">формируются <strong>два сообщения</strong>:</p><ul id="16f42927-0b72-817c-bfd0-c6354513550e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-819a-b699-e99ee63bcdd2" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2010.png"><img style="width:1182px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2010.png"/></a></figure></details></li></ul><h3 id="16f42927-0b72-81d5-914a-fde76ad69c67" class=""><strong>Сообщение 1 — Общая информация о детали из БД:</strong></h3><p id="16f42927-0b72-8109-b43f-dd00532896dd" class="">Бот из данных из таблицы <code>parts_and_replaces</code> собирает Сообщение 1:<div class="indented"><ul id="16f42927-0b72-8180-a299-c5ff4e9fc67e" class="bulleted-list"><li style="list-style-type:disc"><strong>Картинка:</strong> Подгружается локально из поля <code>pic</code> таблицы <code>parts_and_replaces</code>. Если картинки нет то выводим users/pic/no_image.png</li></ul><ul id="16f42927-0b72-8111-8db6-cdddb05d581b" class="bulleted-list"><li style="list-style-type:disc"><strong>Текст:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81e8-9653-cf983fd3d456" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Part {part_name} / {part_number}
Pic: {pic_link}
</code></pre><ul id="16f42927-0b72-8150-86e9-f9c1a917abb5" class="bulleted-list"><li style="list-style-type:circle"><code><strong>part_name</strong></code> берется из таблицы <code>parts_and_replaces</code>. Если партнэйм пустое (или <code>parts_and_replaces_id</code> пустое ) - пишем “N/A”  </li></ul><ul id="16f42927-0b72-8183-8030-e6831baa5ab0" class="bulleted-list"><li style="list-style-type:circle"><code><strong>part_number</strong></code> — это запрос пользователя.</li></ul></li></ul><ul id="16f42927-0b72-8197-a44d-dec06e3e0498" class="bulleted-list"><li style="list-style-type:disc"><strong>Ссылка:</strong> Если поле <code>pic_link</code> в таблице <code>parts_and_replaces</code>заполнено, отображается ссылка. Если нет — строка не выводится.</li></ul></div></p><h3 id="16f42927-0b72-81c4-99b9-ee763d3a0914" class=""><strong>Сообщение 2 (деталь в стоках):</strong></h3><p id="16f42927-0b72-8194-a215-f192b89f6e4e" class=""><strong>Бот выполняет поиск детали в стоках пользователя:</strong></p><p id="16f42927-0b72-8077-a0b6-ebacc0569cbc" class=""><strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Правила поиска по спискам деталей</a></strong></p><ul id="16f42927-0b72-81b8-b17e-c911b911f499" class="bulleted-list"><li style="list-style-type:disc">Бот ищет <strong>партномер</strong> в таблице <code><strong>user_stocks</strong></code>, включая связанные поля <code>Replaces</code> из таблицы <code><strong>parts_and_replaces</strong></code>.<ul id="16f42927-0b72-8149-933f-e466ceefb9dd" class="bulleted-list"><li style="list-style-type:circle"><strong>Партномер</strong> — это либо первоначальный запрос пользователя в поле поиска бота (если он найден сразу в <code><strong>parts_and_replaces</strong></code>), либо значение из поля <code><strong>recognized_part_number</strong></code> таблицы <code><strong>Parts_barcode</strong></code>, если первоначальный запрос не был найден и обработка выполнялась через <code><strong>Parts_barcode</strong></code>.</li></ul></li></ul><ul id="16f42927-0b72-819a-9662-cc4f9c2e4723" class="bulleted-list"><li style="list-style-type:disc">В результате формируется список стоков, в которых найдена деталь.</li></ul><ul id="16f42927-0b72-8141-969e-f21d5309c83e" class="bulleted-list"><li style="list-style-type:disc"><strong>Если деталь найдена в стоках:</strong><p id="16f42927-0b72-81dc-ae9d-e4cb61ea9012" class="">Бот отправляет отдельное сообщение:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8139-9e4d-eac6d365ce10" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">✅ Parts found in:
{stock_name 1, где найдена деталь} / {comment}
{stock_name 2, где найдена деталь} / {comment}

{stock_name} - stock_name из таблицы stock_creds, связь с таблицей user_stocks через stock_id
{comment} - из таблицы user_stocks (если пусто, слэш не выводим)</code></pre></li></ul><ul id="16f42927-0b72-81f9-9295-f4aa4996a947" class="bulleted-list"><li style="list-style-type:disc"><strong>Если деталь не найдена в стоках:</strong><p id="16f42927-0b72-8101-9a3a-fcdea06536a4" class="">Сообщение:</p><p id="16f42927-0b72-8147-89e6-dbb6b39bb91c" class=""><em>You do not have part “DD81-01502A” or replaces in your stock</em></p></li></ul><hr id="16f42927-0b72-81fd-964c-d43efc144ce8"/><p id="16f42927-0b72-818d-b105-fb40dbb17b7e" class=""><strong>Итог:</strong></p><ul id="16f42927-0b72-81eb-ab76-e05d3d1f7d38" class="bulleted-list"><li style="list-style-type:disc">Если пользователь ввел корректный запрос (п. 2.1) или информация из баркода успешно прошла проверку, Страница Детали будет сформирована в любом случае, даже если деталь не найдена ни в базе данных, ни в других источниках. Пользователю будут доступны те же инлайн-кнопки, позволяющие добавить эту деталь в сток.</li></ul></details></li></ul><ul id="16f42927-0b72-81ff-8a43-e63d24d6238f" class="toggle"><li><details open=""><summary><strong>Инлайн кнопки</strong></summary><ul id="16f42927-0b72-8136-a0ab-fd5a3bedb86f" class="bulleted-list"><li style="list-style-type:disc">Все инлайн-кнопки на странице детали одинаковы, вне зависимости от наличия данных для детали или формирования страницы с данными &quot;N/A&quot;.</li></ul><ul id="16f42927-0b72-81b6-abe8-ef5c2ee8d717" class="bulleted-list"><li style="list-style-type:disc">Исключение — кнопка <strong>Repair instructions</strong>: она отображает количество инструкций для данной детали в скобках прямо на кнопке. Если деталь не найдена в таблице <code>repair_instructions</code> - кнопку выводим, но в скобках (0)</li></ul><p id="16f42927-0b72-818d-855a-f5fa816eec59" class=""><strong>2.3.1 Кнопка Prices </strong></p><p id="16f42927-0b72-814a-ac72-fe98d3bc40d7" class="">Кнопка Prices формирует сообщение с ценами на выбранную деталь. Пользователь остается на той же странице с текущими инлайн-кнопками, а сообщение с ценами отображается над ними.</p><p id="16f42927-0b72-81a7-b73f-cf3972cb9a93" class="">Бот создает задачи для поиска цен в таблице <code>pricebot_tasks</code>, используя активные магазины пользователя из таблицы <code>user_shops</code>. Каждые 3 секунды бот проверяет статус задач: если появляются новые данные, он добавляет их в сообщение с ценами. Поиск автоматически завершается через 25 секунд, даже если не все данные собраны. В конце бот выводит итоговое сообщение &quot;Search completed&quot; с доступными результатами.</p><p id="16f42927-0b72-81c3-a5f0-fba46c7e1a49" class="">Вся логика подробно разобрана в <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">“5. Функция “Prices””</a></p><ul id="16f42927-0b72-81c8-ad38-c9c61db7d209" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81b6-a7ad-c71739a006ed" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2011.png"><img style="width:543.9874877929688px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2011.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8135-919b-d9c64c265380" class=""><strong>2.3.2 Repair instructions. Выбор инструкции</strong></p><p id="16f42927-0b72-8171-963f-d9955010ff1a" class="">Бот загружает все инструкции из таблицы <code>repair_instructions</code>, отображая для каждой название, источник, краткое описание, картинку и количество шагов. Инструкции отправляются пользователю в виде отдельных сообщений. Для перехода к пошаговой инструкции пользователь нажимает на ссылку &quot;Steps&quot;, после чего данные шагов загружаются из таблицы <code>instruction_steps</code>.</p><ul id="16f42927-0b72-81fe-9b55-e74c510b86e1" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание</mark></mark></summary><ul id="16f42927-0b72-819e-9ae5-d0b7ccccc897" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark><strong>:</strong></summary><figure id="16f42927-0b72-8177-9ea6-ca492f963e39" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2012.png"><img style="width:571.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2012.png"/></a></figure></details></li></ul><h3 id="16f42927-0b72-8128-8515-fa74ba102e98" class=""><strong>Описание функционала</strong></h3><p id="16f42927-0b72-817b-9678-d40e5d7897dc" class="">При нажатии кнопки <strong>Repair instructions</strong> бот сразу отображает все инструкции, связанные с выбранной деталью, в виде отдельных сообщений. Пользователь может:</p><ol type="1" id="16f42927-0b72-81da-bb6b-f4ade0af1317" class="numbered-list" start="1"><li>Ознакомиться с основной информацией каждой инструкции.</li></ol><ol type="1" id="16f42927-0b72-8199-941c-e65697d0e1f6" class="numbered-list" start="2"><li>Нажать на ссылку <strong>&quot;11 Steps&quot;</strong>, чтобы перейти к пошаговой инструкции.</li></ol><hr id="16f42927-0b72-810c-ab3b-ddb41d9ddd83"/><h3 id="16f42927-0b72-81f3-96e1-e522f0b8fb62" class=""><strong>Функционал</strong></h3><ol type="1" id="16f42927-0b72-8123-a612-c423ce3f240d" class="numbered-list" start="1"><li><strong>Отображение инструкций:</strong><ul id="16f42927-0b72-81ef-a3c0-ef33432f2785" class="bulleted-list"><li style="list-style-type:disc">Бот загружает все записи из таблицы <code>repair_instructions</code>, связанные с текущей деталью.</li></ul><ul id="16f42927-0b72-81f0-98f4-e7cb35945125" class="bulleted-list"><li style="list-style-type:disc">Для каждой инструкции формируется отдельное сообщение, содержащее:<ul id="16f42927-0b72-8123-a8a3-fa7f74e97139" class="bulleted-list"><li style="list-style-type:circle">Название инструкции (<code>title</code>).</li></ul><ul id="16f42927-0b72-8192-8bcd-d105fb5f05dd" class="bulleted-list"><li style="list-style-type:circle">Источник (<code>source</code>).</li></ul><ul id="16f42927-0b72-8198-a4c1-d08e96828de6" class="bulleted-list"><li style="list-style-type:circle">Краткое описание (<code>summary</code>).</li></ul><ul id="16f42927-0b72-81b4-a2b7-dd43a77f3a37" class="bulleted-list"><li style="list-style-type:circle">Превью-картинку (<code>thumbnail</code>).</li></ul><ul id="16f42927-0b72-816d-bed7-fd0647eedf5d" class="bulleted-list"><li style="list-style-type:circle">Ссылку на пошаговую инструкцию: <strong>&quot;11 Steps&quot;</strong> (с переходом к шагам из таблицы <code>instruction_steps</code>).</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-8166-b418-e8c84344620f" class="numbered-list" start="2"><li><strong>Действия пользователя:</strong><ul id="16f42927-0b72-81c3-98ed-d973494c19eb" class="bulleted-list"><li style="list-style-type:disc">Пользователь нажимает на <strong>&quot;14 Steps&quot;</strong> и переходит к пошаговой инструкции п 2.3.2.1.</li></ul></li></ol><hr id="16f42927-0b72-8197-9394-ef8f4381afa7"/><h3 id="16f42927-0b72-817c-955e-ed4c6c0effd0" class=""><strong>Алгоритм работы</strong></h3><ol type="1" id="16f42927-0b72-8173-8a02-fb656cd1b7b8" class="numbered-list" start="1"><li>Бот запрашивает данные из таблицы <code>repair_instructions</code> для текущей детали.</li></ol><ol type="1" id="16f42927-0b72-8144-89b8-e014126670a1" class="numbered-list" start="2"><li>Формирует отдельные сообщения для каждой записи:<ul id="16f42927-0b72-818e-919c-f1a3c77b0068" class="bulleted-list"><li style="list-style-type:disc">Отображает название, источник, описание, картинку и ссылку на шаги.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8167-b9f7-f32c520f5cd7" class="numbered-list" start="3"><li>Все сообщения отправляются пользователю одновременно.</li></ol><ol type="1" id="16f42927-0b72-811c-bd39-db389ec8c4a7" class="numbered-list" start="4"><li>При нажатии на <strong>&quot;11 Steps&quot;</strong> бот загружает шаги из таблицы <code>instruction_steps</code> для выбранной инструкции и отображает их в соответствии с логикой шага 2.</li></ol><hr id="16f42927-0b72-81a2-b71a-f6e067a5595c"/><h3 id="16f42927-0b72-81f5-9d15-c9e450ef20a7" class=""><strong>Пример данных</strong></h3><h3 id="16f42927-0b72-819c-9411-c49f2de37a08" class="">Таблица <code>repair_instructions</code>:</h3><table id="16f42927-0b72-8173-a1d1-c22e1f3ce308" class="simple-table"><tbody><tr id="16f42927-0b72-8116-9910-d856ea92ed30"><td id="=xri" class="">id</td><td id="GHn\" class="">part_id</td><td id="&gt;NSz" class="">title</td><td id="EGEd" class="">source</td><td id="SYIX" class="">summary</td><td id="KT&gt;V" class="">thumbnail</td><td id="I&gt;\a" class="">steps_count</td></tr><tr id="16f42927-0b72-810b-af0d-e41e91383463"><td id="=xri" class="">1</td><td id="GHn\" class="">101</td><td id="&gt;NSz" class="">Installation Guide</td><td id="EGEd" class="">YouTube</td><td id="SYIX" class="">Short install video.</td><td id="KT&gt;V" class="">/images/guide1.jpg</td><td id="I&gt;\a" class="">11</td></tr><tr id="16f42927-0b72-81e7-ad21-df8378e28567"><td id="=xri" class="">2</td><td id="GHn\" class="">101</td><td id="&gt;NSz" class="">Maintenance Tips</td><td id="EGEd" class="">YouTube</td><td id="SYIX" class="">Quick maintenance.</td><td id="KT&gt;V" class="">/images/guide2.jpg</td><td id="I&gt;\a" class="">8</td></tr></tbody></table><p id="16f42927-0b72-81c5-9821-d74189425e59" class="">
</p><p id="16f42927-0b72-81af-b4ca-de0ef3f3d12c" class="">
</p><p id="16f42927-0b72-81f4-80f1-c4b1b00a7225" class=""><strong>2.3.2.1. Пошаговая инструкция </strong></p><p id="16f42927-0b72-812a-901f-da569e899cb7" class="">Бот загружает шаги инструкции из таблицы <code>instruction_steps</code>, отображая для каждого шага название, картинку, краткое описание и ссылку &quot;Watch on video&quot; для перехода на видео. Шаги отправляются пользователю группами по 3 с кнопкой &quot;Next steps&quot; для пролистывания. Когда все шаги показаны, кнопка исчезает.</p><ul id="16f42927-0b72-81fd-9ca3-fe0d77490738" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание</mark></mark></summary><p id="16f42927-0b72-8185-8eac-d796109e3a73" class=""><strong>Общий функционал</strong></p><ol type="1" id="16f42927-0b72-8133-ab11-e41b9b4108e9" class="numbered-list" start="1"><li>Пользователь нажимает на ссылку <code>&quot;Steps&quot;</code> в разделе инструкций (см. пункт 2.3.2).</li></ol><ol type="1" id="16f42927-0b72-8187-9687-c7d9d869ccc0" class="numbered-list" start="2"><li>Бот загружает пошаговые данные для выбранной инструкции из таблицы <code>instruction_steps</code>.</li></ol><ol type="1" id="16f42927-0b72-81bb-b239-eda3d760b9a1" class="numbered-list" start="3"><li>Шаги отображаются по 3 за раз. Для перехода к следующей группе шагов пользователь использует инлайн-кнопку <code>&quot;Next steps&quot;</code>.</li></ol><ol type="1" id="16f42927-0b72-81a6-aba8-d2759b899a5d" class="numbered-list" start="4"><li>Каждый шаг содержит:<ul id="16f42927-0b72-81e8-9d0e-f12237f70376" class="bulleted-list"><li style="list-style-type:disc">Название (<code>title</code>).</li></ul><ul id="16f42927-0b72-81dd-832d-d3ca3307134a" class="bulleted-list"><li style="list-style-type:disc">Картинку (<code>image</code>).</li></ul><ul id="16f42927-0b72-812a-b8cf-c98ca145169b" class="bulleted-list"><li style="list-style-type:disc">Краткое описание (<code>description</code>).</li></ul><ul id="16f42927-0b72-81bd-8b58-d89ce47537bc" class="bulleted-list"><li style="list-style-type:disc">Кликабельный анкор с текстом <code>&quot;Watch on video&quot;</code>, ведущий на точное место в видео (<code>video_link</code>).</li></ul></li></ol><hr id="16f42927-0b72-81a0-9b6a-e02f149ca4ea"/><p id="16f42927-0b72-81d0-84d7-c0b968e7e73c" class=""><strong>Логика работы</strong></p><ol type="1" id="16f42927-0b72-81c3-9de6-d15a531893e8" class="numbered-list" start="1"><li><strong>Получение данных:</strong><ul id="16f42927-0b72-811e-a8c2-d74b83906304" class="bulleted-list"><li style="list-style-type:disc">Бот получает <code>instruction_id</code> выбранной инструкции из таблицы <code>repair_instructions</code>.</li></ul><ul id="16f42927-0b72-8181-b480-dc08391bc0f0" class="bulleted-list"><li style="list-style-type:disc">Запрашивает данные шагов (<code>instruction_steps</code>), отсортированные по полю <code>step_number</code>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8103-86a1-f5e084b7750f" class="numbered-list" start="2"><li><strong>Формирование сообщений:</strong><ul id="16f42927-0b72-81a6-b9a1-c9245c57966d" class="bulleted-list"><li style="list-style-type:disc">Каждое сообщение формируется для одного шага:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8126-9665-f7645e2b940e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Step {step_number}: {title}
{description}

[Watch on video](video_link)
</code></pre></li></ul></li></ol><ol type="1" id="16f42927-0b72-81e5-a799-c86344b498c5" class="numbered-list" start="3"><li><strong>Навигация по шагам:</strong><ul id="16f42927-0b72-8173-b638-e6d26fe3949a" class="bulleted-list"><li style="list-style-type:disc">Шаги отображаются группами по 3.</li></ul><ul id="16f42927-0b72-81d9-82b0-ce8801f769cc" class="bulleted-list"><li style="list-style-type:disc">Если доступно больше шагов:<ul id="16f42927-0b72-81ec-a13b-cac60b4486fe" class="bulleted-list"><li style="list-style-type:circle">Добавляется инлайн-кнопка <code>&quot;Next steps&quot;</code>.</li></ul><ul id="16f42927-0b72-8181-b1e6-fb5755a7b11e" class="bulleted-list"><li style="list-style-type:circle">При нажатии загружается следующая группа шагов.</li></ul></li></ul><ul id="16f42927-0b72-814b-a6a2-e3f053d234b6" class="bulleted-list"><li style="list-style-type:disc">Когда все шаги показаны:<ul id="16f42927-0b72-81e5-bb3b-cfd819ebe8e0" class="bulleted-list"><li style="list-style-type:circle">Инлайн-кнопка <code>&quot;Next steps&quot;</code> становится неактивной или исчезает.</li></ul></li></ul></li></ol><hr id="16f42927-0b72-81ae-936d-f3bb56877cc7"/><p id="16f42927-0b72-81f9-84df-f4cedfdc473e" class=""><strong>Пример структуры данных</strong></p><h3 id="16f42927-0b72-817d-a227-c24a4d3788ee" class="">Таблица <code>instruction_steps</code>:</h3><table id="16f42927-0b72-8130-8a91-d598fd1ed837" class="simple-table"><tbody><tr id="16f42927-0b72-818a-9870-d12497fdcf17"><td id="qteh" class="">id</td><td id="&gt;[WI" class="">instruction_id</td><td id="QYWP" class="">step_number</td><td id=":QRW" class="">title</td><td id="vmt&lt;" class="">description</td><td id="Q|^=" class="">image</td><td id="siq}" class="">video_link</td></tr><tr id="16f42927-0b72-81d6-b549-e22e72f2d3b9"><td id="qteh" class="">1</td><td id="&gt;[WI" class="">101</td><td id="QYWP" class="">1</td><td id=":QRW" class="">Step 1 Title</td><td id="vmt&lt;" class="">Do this first.</td><td id="Q|^=" class="">/images/step1.jpg</td><td id="siq}" class="">/video?t=10</td></tr><tr id="16f42927-0b72-8167-b49f-e27cdef51b33"><td id="qteh" class="">2</td><td id="&gt;[WI" class="">101</td><td id="QYWP" class="">2</td><td id=":QRW" class="">Step 2 Title</td><td id="vmt&lt;" class="">Then do this.</td><td id="Q|^=" class="">/images/step2.jpg</td><td id="siq}" class="">/video?t=45</td></tr><tr id="16f42927-0b72-8120-b7af-cc08fc8651f6"><td id="qteh" class="">3</td><td id="&gt;[WI" class="">101</td><td id="QYWP" class="">3</td><td id=":QRW" class="">Continue</td><td id="vmt&lt;" class="">Keep going.</td><td id="Q|^=" class="">/images/step3.jpg</td><td id="siq}" class="">/video?t=90</td></tr><tr id="16f42927-0b72-81aa-b2a4-d61045056b86"><td id="qteh" class="">4</td><td id="&gt;[WI" class="">101</td><td id="QYWP" class="">4</td><td id=":QRW" class="">Final Step</td><td id="vmt&lt;" class="">Finish up.</td><td id="Q|^=" class="">/images/step4.jpg</td><td id="siq}" class="">/video?t=120</td></tr></tbody></table><hr id="16f42927-0b72-816d-987d-c9718740e87d"/><h3 id="16f42927-0b72-81b4-93b8-ea71b41add20" class=""><strong>Технические требования</strong></h3><ol type="1" id="16f42927-0b72-81ab-9619-d529391c6642" class="numbered-list" start="1"><li><strong>Подключение к таблице </strong><code><strong>instruction_steps</strong></code><strong>:</strong><ul id="16f42927-0b72-812c-a125-f1504c1133f6" class="bulleted-list"><li style="list-style-type:disc">Запрашивать данные по <code>instruction_id</code>.</li></ul><ul id="16f42927-0b72-8103-ad22-e0fee2f12af1" class="bulleted-list"><li style="list-style-type:disc">Сортировать шаги по <code>step_number</code>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8168-acfb-ec30e219de23" class="numbered-list" start="2"><li><strong>Формирование сообщений:</strong><ul id="16f42927-0b72-815d-ad2e-e2e6c01a2ab1" class="bulleted-list"><li style="list-style-type:disc">Использовать Markdown-формат для кликабельных ссылок <code>[текст](ссылка)</code>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-81fa-aad3-eb31bf617af1" class="numbered-list" start="3"><li><strong>Инлайн-кнопки:</strong><ul id="16f42927-0b72-81b5-8723-c93a8a2f1496" class="bulleted-list"><li style="list-style-type:disc"><code>&quot;Next steps&quot;</code> для пролистывания шагов.</li></ul><ul id="16f42927-0b72-81a4-b0c9-f93f72c414c0" class="bulleted-list"><li style="list-style-type:disc">Убирать кнопку, если все шаги показаны.</li></ul></li></ol><p id="16f42927-0b72-81d4-9bda-daedbf903950" class="">
</p><ul id="16f42927-0b72-8112-a3c4-cf8876f2ed1e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание</mark></mark></summary></details></li></ul></details></li></ul></details></li></ul><p id="16f42927-0b72-8109-baa1-e38654d7ab47" class=""><strong>2.3.3 Кнопка Add part. Экран Выбор стока для добавления детали</strong><div class="indented"><p id="16f42927-0b72-81c6-9124-d75329c1e0c8" class="">Бот отображает список <strong>всех</strong> стоков, привязанных к текущему пользователю, в виде инлайн-кнопок. Названия стоков берутся из таблицы <code>stock_creds </code><mark class="highlight-default"><code>(через</code></mark><mark class="highlight-default"><mark class="highlight-default_background"><code> </code></mark></mark><code>user_stocks</code>). После выбора стока деталь добавляется в выбранный сток, и пользователь переходит на экран подтверждения</p></div></p><ul id="16f42927-0b72-811a-aa42-d056e84f5af7" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание</mark></mark></summary><ul id="16f42927-0b72-8140-8d0c-ec095badead5" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-816b-8ebd-ff428958acfb" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2013.png"><img style="width:1622px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2013.png"/></a></figure></details></li></ul><h3 id="16f42927-0b72-8180-8cda-c520ffc58b63" class=""><strong>Действие в БД:</strong></h3><ol type="1" id="16f42927-0b72-812c-8263-c9da650d8df4" class="numbered-list" start="1"><li>В таблице <code>user_stocks</code> создается новая запись для выбранного стока.</li></ol><ol type="1" id="16f42927-0b72-81c8-b89c-caeaacef8133" class="numbered-list" start="2"><li>Поля заполняются следующим образом:<ul id="16f42927-0b72-81ba-9b70-d8fe69302ab4" class="bulleted-list"><li style="list-style-type:disc"><code>part_number</code>: номер детали, указанный пользователем.</li></ul><ul id="16f42927-0b72-8169-bb4d-d224f5bf084b" class="bulleted-list"><li style="list-style-type:disc"><code>parts_and_replaces_id</code>: ID из таблицы <code>parts_and_replaces</code>, если он был найден или использован на предыдущих шагах. В этом случае ставим Статус 4. Если ID не был найден на предыдущих шага, поле <code>parts_and_replaces_id</code>остается пустым и ставим Статус 2.</li></ul></li></ol><p id="16f42927-0b72-8185-90f1-ccb1b111e103" class=""><strong>2.3.3.1 Кнопка Add part. Подтверждение</strong></p><h3 id="16f42927-0b72-81d6-a775-eb3f809829dc" class=""><strong>Сообщение:</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81ee-a60c-cd7d12ef636c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Part {part_name / part_number} added to {Stock_name 2}
</code></pre></details></li></ul><p id="16f42927-0b72-8103-949f-e809ed4a5600" class=""><strong>2.3.4 Кнопка Write-off. Выбор стока</strong></p><p id="16f42927-0b72-8108-88e9-d17c763e7bab" class="">Бот отображает список всех стоков, <strong>где была найдена</strong> указанная деталь, в виде инлайн-кнопок (поиск по стокам производился на шаге 2.3, для формирования <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Сообщения 2</a>). Названия стоков берутся из таблицы <code>stock_creds </code><mark class="highlight-default"><code>(через</code></mark><mark class="highlight-default"><mark class="highlight-default_background"><code> </code></mark></mark><code>user_stocks</code>). После выбора стока деталь удаляется из выбранного стока, и пользователю отображается сообщение об успешном удалении.</p><ul id="16f42927-0b72-812a-bdbe-e955992d834d" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание</mark></mark></summary><ul id="16f42927-0b72-81fe-b16b-e18edb7b1357" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81b4-9ec3-d2914d0aec9c" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2014.png"><img style="width:1678px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2014.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81e1-a868-e81ffc469ce5" class="">Бот отображает список всех стоков пользователя, где была найдена указанная деталь (результаты предыдущего поиска), в виде инлайн-кнопок.</p><p id="16f42927-0b72-81cc-93bf-d2ee9b8c8a1a" class="">Если деталь не найдена ни в одном стоке, выводится сообщение: &quot;No matching part found in your stock.&quot;</p><p id="16f42927-0b72-8187-8edb-dafbc7006e49" class="">После выбора стока:<div class="indented"><p id="16f42927-0b72-8128-9b05-d0da3336294c" class=""><strong>Действие в БД: </strong>Из таблицы <code>user_stocks</code> удаляется запись с указанной деталью для выбранного стока.</p><p id="16f42927-0b72-81c8-bce8-d28549bf4f1c" class=""><strong>2.3.4.1 Кнопка Write-off. Подтверждение списания</strong></p><p id="16f42927-0b72-8157-8737-db3e6e5210e4" class="">Сообщение:</p><p id="16f42927-0b72-81bf-964a-cf5c458dfe6a" class="">“Part {part_name из таблицы parts_and_replaces} / {part_number из таблицы user_stocks} removed from stock list.”</p></div></p></details></li></ul><p id="16f42927-0b72-813c-a9ec-d1f6c085ef96" class=""><strong>2.3.5 Add comment. Выбор стока</strong></p><p id="16f42927-0b72-8141-8e27-cb64c1e087e6" class="">Бот отображает список всех стоков, <strong>где была найдена</strong> указанная деталь, в виде инлайн-кнопок(поиск по стокам производился на шаге 2.3, для формирования <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Сообщения 2</a>). Названия стоков берутся из таблицы <code>stock_creds </code><mark class="highlight-default"><code>(через</code></mark><mark class="highlight-default"><mark class="highlight-default_background"><code> </code></mark></mark><code>user_stocks</code>). После выбора стока пользователь вводит комментарий, и бот сохраняет его в поле <code>comment</code> таблицы <code>user_stocks</code> для соответствующей записи.</p><ul id="16f42927-0b72-8192-9cb4-f1332af0648e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание</mark></mark></summary><p id="16f42927-0b72-81ed-8f3b-c6a75c109e23" class=""><strong>2.3.5 Add comment: Выбор стока</strong></p><p id="16f42927-0b72-81b8-ad15-fc0db12a8728" class="">Бот отображает список стоков, где найдена деталь, в виде инлайн-кнопок.</p><hr id="16f42927-0b72-8143-965b-e48569d26ae2"/><p id="16f42927-0b72-81d6-b3f4-d52231d4927f" class=""><strong>2.3.5.1 Add comment: Ввод комментария</strong></p><p id="16f42927-0b72-81a0-8373-cbd54afec87b" class="">После выбора стока пользователь вводит текст комментария.</p><hr id="16f42927-0b72-8136-805f-c79ba5cf735c"/><p id="16f42927-0b72-81a6-a46a-c6c0d4b481cb" class=""><strong>2.3.5.2 Add comment: Подтверждение</strong></p><p id="16f42927-0b72-818f-98b2-f9da4bcbe0f7" class="">Бот сохраняет комментарий в поле <code>comment</code> таблицы <code>user_stocks</code> и отображает сообщение:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81a2-b521-f3b00e5271e0" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Comment added for part {part_name / part_number} in {stock_name}.
</code></pre><ul id="16f42927-0b72-815d-b43c-cc1fcd595fb2" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81d9-b281-e1e28cfa5f2e" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2015.png"><img style="width:2540px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2015.png"/></a></figure></details></li></ul></details></li></ul><p id="16f42927-0b72-817e-b59f-ec97f0c48df4" class=""><strong>2.3.6 Кнопка Share</strong></p><p id="16f42927-0b72-815e-a3d1-e15f773a0e4f" class="">Кнопка нужна чтобы поделиться данными о детали другим пользователям телеграмм и за его пределы. </p><ul id="16f42927-0b72-81dd-963d-c44bb45265f8" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание</mark></mark></summary><p id="16f42927-0b72-814c-b308-c7e14ad25145" class="">Вопрос: Мне нужно расшарить это сообщение в телеграм/вотсапп и т.д.:</p><p id="16f42927-0b72-8144-8aa8-cef187f36906" class="">SMG  DC97-18962A / Front Drum Module Assembly</p><p id="16f42927-0b72-8198-b339-dc0ac72f8a36" class="">Pic: https://...</p><p id="16f42927-0b72-811b-b650-e72def321cc1" class="">Понятно что это можно делать выделив сообщение, стандартными способами в телефоне. Но интересуют варианты - как с Инлайн кнопки это можно сделать?</p></details></li></ul></details></li></ul></details></li></ul></div></p></details></li></ul><h1 id="16f42927-0b72-8198-85e1-e2c4d36648cc" class="">3. Ветка “Manage stock” </h1><ul id="16f42927-0b72-810f-ba2f-e022392e9088" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание режима Manage stock</mark></mark></summary><ul id="16f42927-0b72-817d-996a-f02f84cb19f9" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-816b-b43c-fff0745b5c70" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2016.png"><img style="width:651.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2016.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81d2-9cb2-df9217384917" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-813d-a4e7-e2630783695b" class=""><strong>Инлайн-кнопки</strong> на первой странице режима <strong>“Find Part”</strong> предназначены для управления стоком пользователя. Они служат отправной точкой для перехода к функционалу управления стоком. Пользователь может выбрать существующий сток или добавить новый. После выбора он переходит на страницу управления стоком для дальнейших действий.</p><p id="16f42927-0b72-81ae-aaac-df0e5a2396d2" class="">Эта ветка является частью ветки <strong>Find Parts</strong>, поэтому все поисковые запросы обрабатываются в соответствии с логикой, описанной в п.2. Собственной логики обработки поисковых запросов для ветки <strong>Manage Stock</strong> нет.</p><p id="16f42927-0b72-81ea-8934-d09ccc8f48e8" class="">Прим. У пользователя может быть несколько стоков, общая информация о которых (например, название стока, источник данных и другие параметры) хранится в таблице <code>stock_creds</code>, тогда как содержимое каждого стока, включая детали, их количество и статусы, находится в таблице <code>user_stocks</code>.</p><hr id="16f42927-0b72-81c5-9323-dd21b09094b9"/><h3 id="16f42927-0b72-81b8-93cf-dbd449270f96" class="">Инлайн-кнопки:</h3><p id="16f42927-0b72-8139-9ee8-fcdf1e113997" class=""><strong>3.1 Add new stock</strong></p><ul id="16f42927-0b72-81b0-b43d-ef9c30e297a1" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-81d9-af28-e927fbeb080e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">скрин</mark></mark></summary><figure id="16f42927-0b72-81b5-913f-c07043b38757" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2017.png"><img style="width:952px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2017.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8186-a2f9-c55157386f1c" class=""><strong>Действие пользователя:</strong></p><p id="16f42927-0b72-81ad-8286-ea2adacbfcdc" class="">Юзер вводит имя нового стока.</p><p id="16f42927-0b72-8160-88b1-c07925178921" class=""><strong>Действия бота:</strong></p><ol type="1" id="16f42927-0b72-8140-baef-ce912eaebaad" class="numbered-list" start="1"><li>Создается новая запись в таблице <code>stock_creds</code>:<ul id="16f42927-0b72-81f0-a132-c3dc5df0bb37" class="bulleted-list"><li style="list-style-type:disc"><code>id</code> — автоинкремент.</li></ul><ul id="16f42927-0b72-8197-9583-dfddffcae5b4" class="bulleted-list"><li style="list-style-type:disc"><code>user_id</code> — идентификатор текущего пользователя.</li></ul><ul id="16f42927-0b72-81d4-a237-ce6f06701003" class="bulleted-list"><li style="list-style-type:disc"><code>stock_name</code> — введенное пользователем имя стока.</li></ul><ul id="16f42927-0b72-8165-b3d1-edc3df804c66" class="bulleted-list"><li style="list-style-type:disc"><code>email</code> — устанавливается значение по умолчанию: <code>partsbot@gmail.com</code>.</li></ul><ul id="16f42927-0b72-8195-afa2-c7925f6704c7" class="bulleted-list"><li style="list-style-type:disc">Остальные поля остаются пустыми или заполняются значениями по умолчанию.</li></ul></li></ol><ol type="1" id="16f42927-0b72-810a-99e5-d5efb6d2aff4" class="numbered-list" start="2"><li>Бот выводит подтверждение:<em>&quot;Stock {stock_name} successfully created.&quot;</em></li></ol><p id="16f42927-0b72-81b8-b62c-d7ba361e6918" class=""><strong>Действия после создания стока:</strong></p><p id="16f42927-0b72-8185-b51c-ce25041175e7" class="">После успешного создания стока, пользователь автоматически переходит на экран <strong>3.2 Управление стоком</strong>, где отображаются доступные действия для работы с этим стоком.</p></details></li></ul><p id="16f42927-0b72-8181-8686-fe75fe28851e" class=""><strong>3.2 Страница Управления стоком</strong></p><ul id="16f42927-0b72-81f4-8ee8-c709bb9772b5" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-81f5-b861-c2089aa8a899" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">скрин</mark></mark></summary><figure id="16f42927-0b72-8161-bf46-c880c40a9186" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2018.png"><img style="width:623.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2018.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81d1-a4ba-c53cc8469b27" class="">При нажатии на инлайн-кнопку с названием стока на экране <strong>2.1</strong>, пользователь автоматически переходит на страницу <strong>3.2 — Управление выбранным стоком</strong>.</p><h3 id="16f42927-0b72-81f6-b8d1-fee6c27d95e8" class="">Страница работы с выбранным стоком</h3><h3 id="16f42927-0b72-81a4-8afb-c87a77859700" class="">Основное сообщение:</h3><p id="16f42927-0b72-81c4-a7ba-d0274a19575d" class=""><strong>{Stock_name}</strong></p><p id="16f42927-0b72-8143-97ec-f78c1c8d524f" class=""><em>(из поля </em><em><code>stock_name</code></em><em> таблицы </em><em><code>stock_creds</code></em><em>, связанной с текущим стоком)</em></p><p id="16f42927-0b72-81bd-bdb0-fd513b52e0d0" class=""><strong>Результаты обработки:</strong></p><ol type="1" id="16f42927-0b72-8116-adb8-e760a75ec6f1" class="numbered-list" start="1"><li><strong>Parts in Progress (A):</strong> ⏳</li></ol><ol type="1" id="16f42927-0b72-8165-acad-da885c369ddf" class="numbered-list" start="2"><li><strong>Parts recognized (Y):</strong> ✅</li></ol><ol type="1" id="16f42927-0b72-819f-9775-c080fcecceeb" class="numbered-list" start="3"><li><strong>Parts not recognized (Z):</strong> ⚠️</li></ol><ol type="1" id="16f42927-0b72-8125-b062-dac3b4822f57" class="numbered-list" start="4"><li><strong>Errors (N):</strong> 🚫</li></ol><p id="16f42927-0b72-81cc-860f-f0b590513ae4" class=""><strong>Статус:</strong> {Processing / Done}</p><hr id="16f42927-0b72-81be-affd-c0c8a9a15262"/><h3 id="16f42927-0b72-81c4-956c-d836438f25a6" class="">2. Расчет показателей и статуса обработки</h3><h3 id="16f42927-0b72-8161-9b21-f2a5c4399ae1" class="">2.1 Показатели</h3><p id="16f42927-0b72-8185-9ad7-c84ee6d16b8f" class="">Показатели рассчитываются на основе количества записей с разными значениями в поле <code>status</code> таблицы <code>user_stocks</code>:</p><ul id="16f42927-0b72-81dc-9b3e-fa7372d24eea" class="bulleted-list"><li style="list-style-type:disc"><strong>Parts in Progress (A):</strong><p id="16f42927-0b72-818f-9b55-c1afb92c6952" class="">Количество записей со статусами:</p><ul id="16f42927-0b72-815f-82e2-fe0937ad1f0d" class="bulleted-list"><li style="list-style-type:circle"><code>0 (New)</code> — Новая запись(спец_запрос).</li></ul><ul id="16f42927-0b72-815c-b9e9-d3772d02edeb" class="bulleted-list"><li style="list-style-type:circle"><code>1 (New)</code> — Новая запись.</li></ul><ul id="16f42927-0b72-815c-9876-cd124d821cf8" class="bulleted-list"><li style="list-style-type:circle"><code>5 (Not Found in Database)</code> — Не найдено в базе данных.</li></ul><ul id="16f42927-0b72-8106-99da-cd1aaa7d433d" class="bulleted-list"><li style="list-style-type:circle"><code>2 (Partnumber_Validated)</code> — Баркод распознан, но поиск в базе не завершен.</li></ul></li></ul><ul id="16f42927-0b72-816b-9158-f0ab753df68e" class="bulleted-list"><li style="list-style-type:disc"><strong>Parts recognized (Y):</strong><p id="16f42927-0b72-8103-b9f7-d002ae0897fc" class="">Количество записей со статусами:</p><ul id="16f42927-0b72-81e8-8b62-c5112ddb1fb3" class="bulleted-list"><li style="list-style-type:circle"><code>4 (Database Match)</code> — Найдено в базе данных.</li></ul><ul id="16f42927-0b72-814d-b6fe-ffbdc01ec9eb" class="bulleted-list"><li style="list-style-type:circle"><code>6 (Online Match)</code> — Найдено в интернете.</li></ul></li></ul><ul id="16f42927-0b72-81f7-bd64-e2d42b309780" class="bulleted-list"><li style="list-style-type:disc"><strong>Parts not recognized (Z):</strong><p id="16f42927-0b72-81f8-8052-ca32e6aa3578" class="">Количество записей со статусом:</p><ul id="16f42927-0b72-816d-bf1f-ff368c693d30" class="bulleted-list"><li style="list-style-type:circle"><code>7 (Not Found Online)</code> — Не найдено в интернете.</li></ul></li></ul><ul id="16f42927-0b72-810f-8f86-fce5faa77806" class="bulleted-list"><li style="list-style-type:disc"><strong>Errors (N):</strong><p id="16f42927-0b72-8141-81eb-df5b2b46e37c" class="">Количество записей со статусом:</p><ul id="16f42927-0b72-8148-a1c4-e18a1879b7ae" class="bulleted-list"><li style="list-style-type:circle"><code>3 (Barcode Not Recognized)</code> — Баркод не распознан.</li></ul></li></ul><h3 id="16f42927-0b72-810f-a095-dbced00e8771" class="">2.2 Расчет статуса процесса</h3><ul id="16f42927-0b72-8187-9be3-c6f1e6c6f07a" class="bulleted-list"><li style="list-style-type:disc">Если <strong>Parts in Progress (A) ≠ 0:Статус:</strong> Processing ⏳</li></ul><ul id="16f42927-0b72-8119-a164-d3bc6e757782" class="bulleted-list"><li style="list-style-type:disc">Если <strong>Parts in Progress (A) = 0:Статус:</strong> Done ✅</li></ul><blockquote id="16f42927-0b72-813f-825e-f315965e94a6" class="">Примечание:<p id="16f42927-0b72-814a-a46a-ca7849d05231" class="">Процесс считается выполняющимся, если в таблице <code>user_stocks</code> остаются записи со статусами <code>0 (New), 1 (New)</code>, <code>2 (Barcode Recognized)</code> или <code>5 (Not Found in Database)</code>. Если таких записей нет, процесс завершен.</p></blockquote><hr id="16f42927-0b72-811a-9ef2-ea05fcc8a257"/><h3 id="16f42927-0b72-8185-be2f-c78aaf2fe21c" class="">3. Обновление страницы</h3><p id="16f42927-0b72-8140-9d97-db572dc36af0" class="">Когда пользователь находится на экране, бот автоматически обновляет сообщение каждые 2 секунды, пересчитывая показатели и статус обработки.</p><p id="16f42927-0b72-81d4-8e11-fdadb183845d" class="">Обновление продолжается до тех пор, пока:</p><ol type="1" id="16f42927-0b72-8172-8f39-d8f1bc26e6a8" class="numbered-list" start="1"><li><strong>Статус не изменится на &quot;Done&quot;.</strong></li></ol><ol type="1" id="16f42927-0b72-8197-95e2-ca912b18df7c" class="numbered-list" start="2"><li><strong>Пользователь не уйдет с этой страницы.</strong></li></ol><hr id="16f42927-0b72-81e9-b13f-c52342473f96"/><h3 id="16f42927-0b72-8132-b55a-c9299a5fa20d" class="">Инлайн-кнопки:</h3><ul id="16f42927-0b72-8187-9841-d11c8dba50b4" class="bulleted-list"><li style="list-style-type:disc"><strong>Upload Stock file</strong> — Загрузить новый файл стока (см. п. 3.3).</li></ul><ul id="16f42927-0b72-810d-8ffa-e9a7c8be3979" class="bulleted-list"><li style="list-style-type:disc"><strong>Download Stock file</strong> — Скачать существующий файл стока (см. п. 3.4).</li></ul><ul id="16f42927-0b72-816f-89fb-f9047eaecc47" class="bulleted-list"><li style="list-style-type:disc"><strong>Write-off</strong> — Списать (удалить) деталь из стока (см. п. 3.9).</li></ul><ul id="16f42927-0b72-8118-af0c-edbcc26f2deb" class="bulleted-list"><li style="list-style-type:disc"><strong>Add part(s)</strong> — Добавить деталь в сток (см. п. 3.10).</li></ul><ul id="16f42927-0b72-811a-98c0-f31e1003830a" class="bulleted-list"><li style="list-style-type:disc"><strong>Show stock list</strong> — Показать детали стока в виде списка (см. п. 3.7).</li></ul><ul id="16f42927-0b72-8141-9303-fae1a4585882" class="bulleted-list"><li style="list-style-type:disc"><strong>Delete Stock</strong> — Удалить сток (см. п. 3.8).</li></ul><ul id="16f42927-0b72-8132-8c49-f8062f715e7a" class="bulleted-list"><li style="list-style-type:disc"><strong>Stock Recount</strong> — Проверяет наличие записей в таблице <code>Stock_Recount</code> для текущего стока:<ul id="16f42927-0b72-8185-97fd-e87828f9c0de" class="bulleted-list"><li style="list-style-type:circle">Если записи есть: переход на <strong>4.3 List Processing</strong>.</li></ul><ul id="16f42927-0b72-81af-a475-dff2277cf901" class="bulleted-list"><li style="list-style-type:circle">Если записей нет: переход на <strong>4.2 Upload Photos</strong>.</li></ul></li></ul><blockquote id="16f42927-0b72-81ce-b051-fbb52d882b42" class="">Примечание:<p id="16f42927-0b72-8160-b81e-caa4b75774b0" class="">Шаг <strong>4.1 (выбор стока)</strong> пропускается, так как сток уже выбран.</p></blockquote><hr id="16f42927-0b72-812c-b8f4-c330b6731aa4"/><p id="16f42927-0b72-8180-ad8a-fe9a4ee528ca" class="">Если потребуется что-то изменить или дополнить, сообщите!</p><p id="16f42927-0b72-812e-b15c-c806b744a78d" class=""><strong>Инлайн кнопки:</strong></p><ul id="16f42927-0b72-8159-a27c-c51f9ae42751" class="toggle"><li><details open=""><summary><strong>3.3 Upload Stock file</strong> - Загрузить новый файл стока.</summary><ul id="16f42927-0b72-81db-bfaa-cd7f1eefe01e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-814a-a852-db1206737483" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2019.png"><img style="width:3058px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2019.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8115-9ddf-e74b24075d8e" class="">Пользователь выбирает источник для загрузки файла стока. Доступны три варианта:</p><ul id="16f42927-0b72-815a-8876-dcb43d96b34c" class="bulleted-list"><li style="list-style-type:disc">Google Таблицы.</li></ul><ul id="16f42927-0b72-817d-84ba-d3b5fc7e9cde" class="bulleted-list"><li style="list-style-type:disc">Dropbox файл.</li></ul><ul id="16f42927-0b72-8155-bde8-e801f013d5f9" class="bulleted-list"><li style="list-style-type:disc">Локальный Excel файл.</li></ul><p id="16f42927-0b72-81e6-b938-ff939745572a" class=""><strong>Прим. 1:</strong> Сам бот <strong>не загружает сток-файлы в БД</strong>, а только собирает информацию и записывает ее в БД.</p><p id="16f42927-0b72-813a-983f-da16ac26f12b" class=""><strong>Прим. 2: </strong>Запись в БД происходит <strong>только на этапе подтверждения данных (шаг 3.34)</strong>. До этого бот запоминает введенные данные, но не сохраняет их в базу данных.</p><p id="16f42927-0b72-8143-97d6-deabe555f934" class="">
</p><p id="16f42927-0b72-8109-a209-f4981a3e5d30" class=""><strong>3.3.1 Google Sheet: Ввод ссылки</strong></p><ul id="16f42927-0b72-81f5-9b98-da0ec2080acf" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8131-a6b3-dfe1c44faa76" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2020.png"><img style="width:407.9875183105469px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2020.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-81f8-8a91-c2a618767e9f" class="bulleted-list"><li style="list-style-type:disc">Пользователь вводит ссылку на Google Sheet.</li></ul><ul id="16f42927-0b72-817e-b54e-e3a3e8c87650" class="bulleted-list"><li style="list-style-type:disc">Бот временно сохраняет ссылку, не записывая ее в базу данных.</li></ul><ul id="16f42927-0b72-81d4-9aaa-c30d442cf7b9" class="bulleted-list"><li style="list-style-type:disc">На следующем шаге (3.34) ссылка будет записана в поле <code>stock_link</code> таблицы <code>stock_creds</code>.</li></ul><hr id="16f42927-0b72-81cc-971c-d1b201f021f4"/><p id="16f42927-0b72-81e6-9cf1-fcce7553bd6b" class=""><strong>3.3.2 Excel file (local): Загрузка файла</strong></p><ul id="16f42927-0b72-81c6-9700-fd0db64f36c5" class="bulleted-list"><li style="list-style-type:disc">Пользователь загружает файл Excel через Telegram.</li></ul><ul id="16f42927-0b72-814c-8357-ec97c2c14ed3" class="bulleted-list"><li style="list-style-type:disc">Бот сохраняет файл в папку:<code>users/user_stocks/stock_id/</code>.<em>(путь к папке </em><em><code>users</code></em><em> задается в настройках бота)</em></li></ul><ul id="16f42927-0b72-81a0-b163-d9e5dd907600" class="bulleted-list"><li style="list-style-type:disc">Название файла временно запоминается и будет записано в поле <code>file_name</code> таблицы <code>stock_creds</code> на следующем шаге (3.34).</li></ul><hr id="16f42927-0b72-8118-861c-f708818ee9e5"/><p id="16f42927-0b72-8122-9d91-d5454b263c06" class=""><strong>3.3.3 Dropbox file (local): Ввод ссылки</strong></p><ul id="16f42927-0b72-81d4-af31-f4698e0304cb" class="bulleted-list"><li style="list-style-type:disc">Пользователь вводит ссылку на файл в Dropbox.</li></ul><ul id="16f42927-0b72-81f9-b460-d50e6658912f" class="bulleted-list"><li style="list-style-type:disc">Бот временно запоминает ссылку, не записывая ее в базу данных.</li></ul><ul id="16f42927-0b72-8137-91af-c39647369ca5" class="bulleted-list"><li style="list-style-type:disc">На следующем шаге (3.34) ссылка будет записана в поле <code>stock_link</code> таблицы <code>stock_creds</code>.</li></ul><ul id="16f42927-0b72-818d-b4b6-fce0aa941b44" class="toggle"><li><details open=""><summary><strong>3.3.4 После загрузки файла. Выбор столбца</strong></summary><p id="16f42927-0b72-81a1-b8b5-ee8f1a19f3a1" class="">На этом этапе пользователь выбирает или вводит столбец для обработки данных. Только после этого бот выполняет создание или редактирование записи в таблице <code>stock_creds</code>.</p><ul id="16f42927-0b72-816a-8f63-d92d62b62867" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81f5-8cf4-ce408f55cc12" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2021.png"><img style="width:567.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2021.png"/></a></figure></details></li></ul><hr id="16f42927-0b72-815f-86e6-dc18438838e5"/><h3 id="16f42927-0b72-8139-916f-d3c108a3bd37" class=""><strong>Действия бота:</strong></h3><ol type="1" id="16f42927-0b72-81b1-a48a-ebf37fdad407" class="numbered-list" start="1"><li><strong>Инлайн-кнопки для выбора столбца:</strong><p id="16f42927-0b72-81df-9230-f432030044cb" class="">Бот автоматически формирует инлайн-кнопки с диапазоном A-ZZ для удобства выбора.</p><ul id="16f42927-0b72-8134-aa73-c24bbc9c1eb7" class="bulleted-list"><li style="list-style-type:disc">Каждая кнопка соответствует одному столбцу (A, B, ..., Z, AA, AB, ..., ZZ).</li></ul><ul id="16f42927-0b72-8182-a11a-c7fb576a6695" class="bulleted-list"><li style="list-style-type:disc">При нажатии на кнопку бот фиксирует выбранный столбец и выполняет переход к следующему шагу.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8180-92b8-ee7ac7605ce6" class="numbered-list" start="2"><li><strong>Ввод вручную:</strong><p id="16f42927-0b72-8147-9815-d14410954a84" class="">Если пользователь вручную вводит название столбца, бот проверяет корректность ввода:</p><ul id="16f42927-0b72-81d4-bb56-e262537281cd" class="bulleted-list"><li style="list-style-type:disc">Если название вне диапазона A-ZZ, бот выводит сообщение:<br/><br/>Бот остается на текущем экране.<br/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8148-8682-ccd59bb17920" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Error: Please enter a valid column name within the range A to ZZ.
</code></pre></li></ul></li></ol><ol type="1" id="16f42927-0b72-818b-9321-dec702066ae4" class="numbered-list" start="3"><li><strong>Создание новой записи (для нового стока):</strong><p id="16f42927-0b72-8167-bebf-ea9b8dff170d" class="">Если в таблице <code>stock_creds</code> не было записи по текущему <mark class="highlight-red"><mark class="highlight-gray_background">stock_id  </mark></mark>то создаем новую запись:</p><ul id="16f42927-0b72-81fb-81e8-e49e6d72bfd3" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong>: автоинкремент.</li></ul><ul id="16f42927-0b72-815a-b762-db0e7d14acb6" class="bulleted-list"><li style="list-style-type:disc"><strong>user_id</strong>: идентификатор текущего пользователя.</li></ul><ul id="16f42927-0b72-81ba-8cc2-c6c14ca8dcdb" class="bulleted-list"><li style="list-style-type:disc"><strong>stock_name</strong>: имя стока (введенное на шаге 2).</li></ul><ul id="16f42927-0b72-8192-8813-d9b42390780b" class="bulleted-list"><li style="list-style-type:disc"><strong>email</strong>: <code>partsbot@gmail.com</code>.</li></ul><ul id="16f42927-0b72-814f-8f74-f698f0ad11b6" class="bulleted-list"><li style="list-style-type:disc"><strong>doc_types_id</strong>:<ul id="16f42927-0b72-816b-b067-eff6eb3a9d25" class="bulleted-list"><li style="list-style-type:circle"><code>1</code> для Dropbox.</li></ul><ul id="16f42927-0b72-8193-9da1-d5c86d36be7a" class="bulleted-list"><li style="list-style-type:circle"><code>2</code> для Google Sheet.</li></ul><ul id="16f42927-0b72-819a-b54a-e465637f6e80" class="bulleted-list"><li style="list-style-type:circle"><code>3</code> для локального Excel-файла.</li></ul></li></ul><ul id="16f42927-0b72-81b0-830b-d9f049d23065" class="bulleted-list"><li style="list-style-type:disc"><strong>stock_link</strong>:<ul id="16f42927-0b72-81fa-bdf6-db532f6cf913" class="bulleted-list"><li style="list-style-type:circle">Ссылка на Google Sheet или Dropbox файл.</li></ul><ul id="16f42927-0b72-816c-862e-d8766f5354b3" class="bulleted-list"><li style="list-style-type:circle">Для локального файла — оставляем пустым.</li></ul></li></ul><ul id="16f42927-0b72-814a-855c-f77417928c47" class="bulleted-list"><li style="list-style-type:disc"><strong>file_name</strong>:<ul id="16f42927-0b72-8153-9d9b-f699f0087eda" class="bulleted-list"><li style="list-style-type:circle">Для локального файла: имя файла, загруженного на шаге 3.3.2.</li></ul><ul id="16f42927-0b72-8180-8e0e-d711f3cb50a5" class="bulleted-list"><li style="list-style-type:circle">Для Dropbox и Google Sheet — оставляем пустым.</li></ul></li></ul><ul id="16f42927-0b72-817d-8011-d4f3b8ee355c" class="bulleted-list"><li style="list-style-type:disc"><strong>excel_column</strong>: название столбца, выбранное с помощью инлайн-кнопки или введенное вручную.</li></ul><ul id="16f42927-0b72-8199-b487-c99f02e0e704" class="bulleted-list"><li style="list-style-type:disc"><strong>sync_freq</strong>: <code>60</code> (по умолчанию).</li></ul><ul id="16f42927-0b72-816f-9ee1-e2335e3cdb3f" class="bulleted-list"><li style="list-style-type:disc"><strong>sync_switch</strong>: <code>on</code> (по умолчанию).</li></ul><ul id="16f42927-0b72-81a9-b50e-d1007033eb5e" class="bulleted-list"><li style="list-style-type:disc"><strong>update_time</strong>: текущее время в формате DateTime.</li></ul><ul id="16f42927-0b72-81f4-86e0-de21b8eeb475" class="bulleted-list"><li style="list-style-type:disc">Остальные поля (<code>partmanager</code>, <code>contact_types_id</code>, <code>contact_address</code>, <code>update_status</code>, <code>records_count</code>, <code>replace_records</code>) оставляем пустыми.</li></ul></li></ol><ol type="1" id="16f42927-0b72-813b-81d5-c672a13d72ef" class="numbered-list" start="4"><li><strong>Если запись уже была, то перезаписываем:</strong><p id="16f42927-0b72-81ae-839e-e867d4a6a11d" class="">Если пользователь выбрал существующий сток, запись обновляется:</p><ul id="16f42927-0b72-812c-b1f3-c209d71ad862" class="bulleted-list"><li style="list-style-type:disc">Поля <code>doc_types_id</code>, <code>stock_link</code>, <code>file_name</code>, <code>excel_column</code> и <code>update_time</code> перезаписываются новыми значениями.</li></ul></li></ol><hr id="16f42927-0b72-8123-9fa5-f6877bb7f515"/><p id="16f42927-0b72-8116-af5f-fcc51068c07d" class=""><strong>Результат:</strong></p><ul id="16f42927-0b72-812f-a12d-ef70a8f3b7c8" class="bulleted-list"><li style="list-style-type:disc">Пользователь выбирает столбец либо с помощью инлайн-кнопки, либо вводит вручную.</li></ul><ul id="16f42927-0b72-8193-b509-dce1cce1ee21" class="bulleted-list"><li style="list-style-type:disc">После выбора бот записывает данные в таблицу <code>stock_creds</code> и переходит к следующему шагу.</li></ul><ul id="16f42927-0b72-8158-8ad8-eb658eb38d73" class="bulleted-list"><li style="list-style-type:disc">Некорректный ввод обрабатывается сообщением об ошибке, и пользователь остается на текущем экране.</li></ul><p id="16f42927-0b72-814f-920c-e5e0c802c0b2" class="">
</p><p id="16f42927-0b72-8100-96e4-c69bcf92f303" class=""><strong>3.3.5 Подтверждение загрузки</strong></p><ul id="16f42927-0b72-8152-a694-c055262ce10f" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8179-9ee1-cb19c9b7a359" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2022.png"><img style="width:558px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2022.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8133-9bdd-fc3e277ff25f" class="">После выбора столбца пользователь переходит на страницу <strong>3.2 — Управление стоком</strong>, где отображаются два сообщения:</p><hr id="16f42927-0b72-8170-bd47-fba16762ac35"/><h3 id="16f42927-0b72-81ee-9ca6-e01d6cf09595" class="">Сообщение 1:</h3><p id="16f42927-0b72-8190-a9a4-eaac792fdc9c" class=""><strong>&quot;The stock will be uploaded in 1-10 minutes.&quot;</strong></p><hr id="16f42927-0b72-8121-9811-f88370680484"/><h3 id="16f42927-0b72-81fc-91e9-c572898ec537" class="">Сообщение 2:</h3><p id="16f42927-0b72-8141-8b2b-d00a880834cb" class="">{Stock_name}</p><ol type="1" id="16f42927-0b72-81d6-b602-f8f965d56d52" class="numbered-list" start="1"><li><strong>Parts in Progress (A):</strong> ⏳</li></ol><ol type="1" id="16f42927-0b72-8128-9712-c6f2ce8fe362" class="numbered-list" start="2"><li><strong>Parts recognized (Y):</strong> ✅</li></ol><ol type="1" id="16f42927-0b72-816d-bf94-fa5cb92514e1" class="numbered-list" start="3"><li><strong>Parts not recognized (Z):</strong> ⚠️</li></ol><ol type="1" id="16f42927-0b72-8193-bd92-d67b501592da" class="numbered-list" start="4"><li><strong>Errors (N):</strong> 🚫</li></ol><p id="16f42927-0b72-81b4-a104-dd6bdad766e5" class=""><strong>Status:</strong> {Processing / Done}</p><hr id="16f42927-0b72-81bd-a4b5-cf10c4fc7568"/><blockquote id="16f42927-0b72-8131-8256-e54e6dc88137" class="">Примечание: Второе сообщение формируется по правилам экрана 3.2 — Управление стоком.</blockquote></details></li></ul></details></li></ul><ul id="16f42927-0b72-814d-823f-ee6d68023052" class="toggle"><li><details open=""><summary><strong>3.4 Download Stock file</strong> — Скачать существующий файл стока.</summary><p id="16f42927-0b72-8122-a7a6-ccb8fae263c5" class="">Бот формирует файл Excel с данными стока в момент запроса, извлекая актуальную информацию из базы данных. Готовый файл отправляется пользователю, после чего удаляется с сервера для экономии места.</p><ol type="1" id="16f42927-0b72-81e4-b212-e0829859142d" class="numbered-list" start="1"><li><strong>Источник данных</strong><p id="16f42927-0b72-8182-b031-e372d28a68ee" class="">Данные берутся из двух таблиц:</p></li></ol><ul id="16f42927-0b72-8165-b6f0-d225d728d8a0" class="bulleted-list"><li style="list-style-type:disc"><strong>user_stocks</strong>: содержит партномер детали (part_number) и комментарий (comment).</li></ul><ul id="16f42927-0b72-819b-972a-f72c85e8c0ac" class="bulleted-list"><li style="list-style-type:disc"><strong>parts_and_replaces</strong>: содержит название детали (part_name), связанное с партномером.</li></ul><ol type="1" id="16f42927-0b72-8153-8852-d678b5daf12f" class="numbered-list" start="1"><li><strong>Формат Excel-файла</strong><br/>Файл должен содержать три столбца:<br/></li></ol><ul id="16f42927-0b72-817b-89c4-fce04c0b5e32" class="bulleted-list"><li style="list-style-type:disc"><strong>Part Number</strong> (из <code>user_stocks</code>).</li></ul><ul id="16f42927-0b72-81b3-8eaa-c1d58a3f8743" class="bulleted-list"><li style="list-style-type:disc"><strong>Название</strong> (из <code>parts_and_replaces</code>).</li></ul><ul id="16f42927-0b72-81c4-a705-c8199670536e" class="bulleted-list"><li style="list-style-type:disc"><strong>Комментарий</strong> (из <code>user_stocks</code>).<br/>Имя файла формируется как <br/><code>stock_user_{UserID}.xlsx</code> и является уникальным для каждого пользователя.</li></ul><ol type="1" id="16f42927-0b72-81c4-9f91-f21fac00f9cd" class="numbered-list" start="1"><li><strong>Действия при нажатии кнопки</strong></li></ol><ul id="16f42927-0b72-81d9-bc0b-c032210d1d2f" class="bulleted-list"><li style="list-style-type:disc">По нажатию на кнопку бот выполняет SQL-запрос, чтобы объединить данные из двух таблиц.</li></ul><ul id="16f42927-0b72-81bb-bfed-fc57e5b29109" class="bulleted-list"><li style="list-style-type:disc">Генерирует Excel-файл с указанными полями.</li></ul><ul id="16f42927-0b72-8141-9d27-c71fcf5589fc" class="bulleted-list"><li style="list-style-type:disc">Отправляет готовый файл пользователю в чат.</li></ul><ol type="1" id="16f42927-0b72-81dd-b2a0-c50aa981143c" class="numbered-list" start="1"><li><strong>Пример данных</strong></li></ol><ul id="16f42927-0b72-8123-8d95-d660e7f83192" class="bulleted-list"><li style="list-style-type:disc"><strong>user_stocks</strong>:<table id="16f42927-0b72-8120-b1e4-ccfbcf044d01" class="simple-table"><tbody><tr id="16f42927-0b72-8140-864b-c21fe45cdeb2"><td id="|^zF" class="">Part_Number</td><td id="nNvP" class="">Comment</td></tr><tr id="16f42927-0b72-812c-9569-eff26bd6b12a"><td id="|^zF" class="">12345</td><td id="nNvP" class="">&quot;Urgent&quot;</td></tr><tr id="16f42927-0b72-81cf-8de2-dd7ec05943df"><td id="|^zF" class="">67890</td><td id="nNvP" class="">&quot;Stock: 3 pcs&quot;</td></tr></tbody></table></li></ul><ul id="16f42927-0b72-812d-9fc8-c11180940276" class="bulleted-list"><li style="list-style-type:disc"><strong>parts_and_replaces</strong>:<table id="16f42927-0b72-81a2-a41e-fbc7714ba591" class="simple-table"><tbody><tr id="16f42927-0b72-8158-9a89-fb73f55fae63"><td id="FKgA" class="">Part_Number</td><td id="CwcS" class="">Part_Name</td></tr><tr id="16f42927-0b72-8110-88e3-e32c99bf5696"><td id="FKgA" class="">12345</td><td id="CwcS" class="">&quot;Washer Motor&quot;</td></tr><tr id="16f42927-0b72-8125-baac-d01d9809cc39"><td id="FKgA" class="">67890</td><td id="CwcS" class="">&quot;Fridge Display Panel&quot;</td></tr></tbody></table></li></ul><ul id="16f42927-0b72-8102-82db-ca9f06445fc9" class="bulleted-list"><li style="list-style-type:disc"><strong>Excel-файл:</strong><table id="16f42927-0b72-81fa-a5f1-f7e9958d7ff3" class="simple-table"><tbody><tr id="16f42927-0b72-8103-a60a-df08e79b4523"><td id="EURM" class="">Part Number</td><td id="Sy&lt;e" class="">Название</td><td id="&gt;t[s" class="">Комментарий</td></tr><tr id="16f42927-0b72-8165-88d8-ed40fbdbbc00"><td id="EURM" class="">12345</td><td id="Sy&lt;e" class="">Washer Motor</td><td id="&gt;t[s" class="">Urgent</td></tr><tr id="16f42927-0b72-81cc-b357-e3a99b568c3c"><td id="EURM" class="">67890</td><td id="Sy&lt;e" class="">Fridge Display Panel</td><td id="&gt;t[s" class="">Stock: 3 pcs</td></tr></tbody></table></li></ul><p id="16f42927-0b72-81b3-bcac-d39f5ef31b4e" class="">Про связь таблиц    и   можно найти в <strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Правила поиска по спискам деталей</a></strong></p><p id="16f42927-0b72-8146-9453-cffb9e0059d0" class="">
</p></details></li></ul><ul id="16f42927-0b72-81f1-846a-cfdac06337a3" class="toggle"><li><details open=""><summary><strong>3.7 Show stock list</strong> — Показать детали стока в виде списка.</summary><p id="16f42927-0b72-81bc-aea1-c0defd012d18" class="">Бот отображает список деталей текущего стока, используя данные из таблицы user_stocks, связанные с stock_id. Применяются<a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21"> Правила построения «Списка деталей»,</a> включая информацию о названии деталей, комментариях и связанных стоках. Прим. В этом списке всегда есть данные о стоке и возможны комменты.</p><ul id="16f42927-0b72-81fa-82dd-f0eccecfad28" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">скрин</mark></mark></summary><figure id="16f42927-0b72-8179-8321-de3cfa42b2f3" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2023.png"><img style="width:595.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2023.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81cf-b7f5-ee42691af92e" class="">
</p></details></li></ul><ul id="16f42927-0b72-819a-b253-e21e06cdda2e" class="toggle"><li><details open=""><summary><strong>3.8 Delete Stock</strong> — Удалить сток.</summary><ul id="16f42927-0b72-8163-8868-e771f1c03e68" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">скрин</mark></mark></summary><figure id="16f42927-0b72-81c8-86ed-c9a66e5535e2" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2024.png"><img style="width:3020px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2024.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81a8-bc64-c10d4397d473" class="">При нажатии кнопки бот запрашивает подтверждение удаления стока, отображая инлайн-кнопку <strong>&quot;Confirm&quot;</strong>.</p><p id="16f42927-0b72-815e-b586-f30a49388efb" class=""><strong>Действия при подтверждении:</strong></p><ol type="1" id="16f42927-0b72-811d-8cfe-c4950685580d" class="numbered-list" start="1"><li>Удаляются все записи, связанные с текущим <code>stock_id</code>, из таблицы <code>user_stocks</code>.</li></ol><ol type="1" id="16f42927-0b72-818e-ade0-c995ee161af6" class="numbered-list" start="2"><li>Удаляется запись с этим же <code>stock_id</code> из таблицы <code>stock_creds</code>.</li></ol></details></li></ul><ul id="16f42927-0b72-8116-a9bb-d9374dc0d7ee" class="toggle"><li><details open=""><summary><strong>3.9 Add part(s) и 3.10 Write-off</strong> — Добавить / Списать (удалить) деталь из стока.</summary><p id="16f42927-0b72-810d-aa9c-fc68e01a79cc" class="">При нажатии пользователь перенаправляется на шаг <strong>2.2</strong> для ввода партномера вручную или через штрихкод. После выбора детали процесс продолжается на <strong>Странице детали</strong> с этими же кнопками, но уже связанными с выбранной деталью.</p><ol type="1" id="16f42927-0b72-8147-afd9-e75b36070e90" class="numbered-list" start="1"><li><strong>Логика работы</strong><ul id="16f42927-0b72-8103-80e7-cd7aed8a49b9" class="bulleted-list"><li style="list-style-type:disc">На данном этапе деталь еще не выбрана.</li></ul><ul id="16f42927-0b72-81d2-9dbf-c5e24eff34e5" class="bulleted-list"><li style="list-style-type:disc">При нажатии на любую из кнопок пользователь перенаправляется на шаг <strong>2.2</strong>, где ему предлагается:<ul id="16f42927-0b72-81e3-893e-e64371b04aed" class="bulleted-list"><li style="list-style-type:circle">Ввести партномер детали вручную.</li></ul><ul id="16f42927-0b72-81b6-ad16-e7b49a8f1d43" class="bulleted-list"><li style="list-style-type:circle">Или отправить штрихкод детали.</li></ul></li></ul><ul id="16f42927-0b72-8156-9bf8-f2d3869a2419" class="bulleted-list"><li style="list-style-type:disc">После ввода данных пользователь переходит на <strong>Страницу детали</strong>, где снова видит кнопки <strong>Add Part</strong> и <strong>Write-off</strong>, уже связанные с выбранной деталью.</li></ul></li></ol><ol type="1" id="16f42927-0b72-81a8-bda2-f34bebec8b80" class="numbered-list" start="2"><li><strong>Причина размещения кнопок на главной странице</strong><ul id="16f42927-0b72-81e4-ae88-d5b54168512a" class="bulleted-list"><li style="list-style-type:disc">Добавление и списание деталей — это ключевые операции в системе складского учета.</li></ul><ul id="16f42927-0b72-81e3-9b03-e9af0a231a42" class="bulleted-list"><li style="list-style-type:disc">Их наличие на главной странице обеспечивает интуитивное взаимодействие пользователя с системой.</li></ul><ul id="16f42927-0b72-81e0-9679-c57146b25314" class="bulleted-list"><li style="list-style-type:disc">Даже если деталь еще не выбрана, пользователь может сразу начать процесс, а бот перенаправит его на шаг <strong>2.2</strong> для ввода данных.</li></ul></li></ol><p id="16f42927-0b72-8147-aa91-ec02d24c197f" class="">
</p></details></li></ul><ul id="16f42927-0b72-8126-986f-e8e06e98e47f" class="toggle"><li><details open=""><summary><strong>3.11 Stock Recount - </strong>Инвентаризация/пересчет стока. Переходим на ветку 4 с текущим <code>stock_id</code>и продолжаем логику ветки 4.. </summary><p id="16f42927-0b72-816e-a666-fe0a7e4f8949" class=""><strong>Проверяет наличие записей в таблице Stock_Recount по выбранному стоку:</strong></p><ul id="16f42927-0b72-81f3-8d19-ef946f2af787" class="bulleted-list"><li style="list-style-type:disc">Если записи есть: переход на <strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">4.3 List Processing</a></strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">.</a></li></ul><ul id="16f42927-0b72-8106-aee0-ee79a345d651" class="bulleted-list"><li style="list-style-type:disc">Если записей нет: переход на <strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">4.2 Upload Photos</a></strong>.</li></ul><p id="16f42927-0b72-8100-bde9-c9a0dc74e544" class=""><strong>Примечание:</strong> Шаг <strong>4.1 Выбор стока</strong> пропускается, так как сток уже выбран.</p><h3 id="16f42927-0b72-810c-abad-f40da72de459" class=""></h3></details></li></ul><p id="16f42927-0b72-81e4-afd3-cda87facaa12" class="">
</p><p id="16f42927-0b72-81fc-8e7e-e4f2a5ebad45" class="">
</p></details></li></ul></details></li></ul><h1 id="16f42927-0b72-81aa-a65c-c6766bd43894" class="">4. Функция “Stock Recount”</h1><ul id="16f42927-0b72-81c8-bf9e-d9bb7edc16c2" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание Функция “Stock Recount”</mark></mark></summary><p id="16f42927-0b72-812c-8527-e2576c7a3d71" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-814e-b0c5-caf47326f104" class="">Функция &quot;Stock Recount&quot; поддерживает обработку фотографий с баркодами. Бот не занимается распознаванием самостоятельно: он загружает изображения на локальный сервер и создает запись в базе данных. Это та же процедура что и 2.2.1, но в случае &quot;Stock Recount&quot; возможна одновременная загрузка и обработка нескольких фотографий (в п 2.2.1 - только одна). После получения результата бот обновляет данные и публикует их пользователю.</p><h2 id="16f42927-0b72-8112-abd0-e1d8d24dcc53" class="">Логика процесса:</h2><ul id="16f42927-0b72-81dc-8f9a-d2a82dbeaa9f" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Короткое описание шагов</mark></mark></summary><h3 id="16f42927-0b72-8133-a7b0-ecde73e125c6" class=""><strong>Экран 4.1 — Stock Recount. Choose Stock</strong></h3><p id="16f42927-0b72-8157-a882-f0b3428473b9" class="">На этом экране пользователь выбирает текущий сток, с которым будет работать.</p><ul id="16f42927-0b72-8153-b8b2-fd2cf5e3ed7e" class="bulleted-list"><li style="list-style-type:disc">После выбора стока пользователь переходит на экран <strong>4.2 Upload Photos</strong> (если таблица <code>Stock_Recount</code> пуста) или на экран <strong>4.3 List Processing</strong> (если в таблице есть записи).</li></ul><h3 id="16f42927-0b72-8111-a12a-db7174ec6908" class=""><strong>Экран 4.2 — Upload Photos</strong></h3><p id="16f42927-0b72-8197-ac1f-c850a31a036e" class="">На этом экране пользователь загружает фотографии с баркодами деталей.</p><ul id="16f42927-0b72-8156-8f2c-c2cdc453b3d7" class="bulleted-list"><li style="list-style-type:disc">Фотографии сохраняются на локальный диск, а информация о них записывается в таблицу <code><strong>Stock_Recount</strong></code>.</li></ul><ul id="16f42927-0b72-813b-8ba9-e9fd0f1ef820" class="bulleted-list"><li style="list-style-type:disc">После загрузки фотографий пользователь автоматически переходит на экран <strong>4.3 List Processing</strong>, где отображаются результаты обработки.</li></ul><h3 id="16f42927-0b72-8165-a3ce-d46fe4f60f8c" class=""><strong>Экран 4.3 — List Processing</strong></h3><p id="16f42927-0b72-8134-a89b-f4f850a78324" class="">После завершения обработки фотографий на этом экране пользователь принимает решение, что делать с распознанным списком (таблица <code>Stock_Recount</code>).</p><p id="16f42927-0b72-81cd-81e8-f536212ee96f" class=""><strong>Инлайн-кнопки</strong> (Юзер решает что делать с этим списком):</p><ol type="1" id="16f42927-0b72-8107-9b95-fbd6e9c25975" class="numbered-list" start="1"><li><strong>4.5 Replace Stock File:</strong> Полностью заменить текущий сток списком из таблицы <code>Stock_Recount</code>.</li></ol><ol type="1" id="16f42927-0b72-816c-8378-c09e30dc3352" class="numbered-list" start="2"><li><strong>4.5 Add Parts to Stock:</strong> Дополнить текущий сток запчастями из таблицы <code>Stock_Recount</code>.</li></ol><ol type="1" id="16f42927-0b72-81a3-b22f-d5f7c59b0a69" class="numbered-list" start="3"><li><strong>4.6 Clear List:</strong> Удалить распознанный список и начать загрузку новой партии фотографий.</li></ol><h3 id="16f42927-0b72-8181-8bae-f631d31d6f82" class=""><strong>Ограничения процесса:</strong></h3><p id="16f42927-0b72-816b-9b01-ebb27f05b7f9" class="">Текущая логика запрещает загрузку или обработку новой партии фотографий, пока пользователь не примет решение по старому списку на экране <strong>4.3 List Processing</strong>.</p><p id="16f42927-0b72-8101-9128-e7be852a4b4a" class="">Пользователь должен либо:</p><ul id="16f42927-0b72-8140-8001-c501422b445c" class="bulleted-list"><li style="list-style-type:disc">Загрузить распознанные номера в свой сток.(шаг 4.5)</li></ul><ul id="16f42927-0b72-812f-88d5-dbf25d406aa8" class="bulleted-list"><li style="list-style-type:disc">Удалить текущий список из таблицы <code>Stock_Recount</code>.(шаг 4.6)</li></ul><ul id="16f42927-0b72-81e4-91f1-e8570bbf5d9e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Таблицы:</mark></mark></summary><h3 id="16f42927-0b72-81b0-945a-d8e38c4729a7" class=""><code><strong>user_stocks</strong></code></h3><p id="16f42927-0b72-8166-b1bc-c7c38c4ed340" class="">Таблица, где хранится список деталей пользователя.</p><ul id="16f42927-0b72-81e5-8eca-d15ad29e285b" class="bulleted-list"><li style="list-style-type:disc">Содержит детали, которые пользователь добавил или загрузил в свой сток.</li></ul><ul id="16f42927-0b72-81a1-826a-ffd1db7c407a" class="bulleted-list"><li style="list-style-type:disc">Связана с таблицами <code>stock_creds</code> (для хранения информации о стоках) и <code>parts_and_replaces</code> (для получения названий и картинок деталей).</li></ul><hr id="16f42927-0b72-8115-854c-c6b942458bc6"/><h3 id="16f42927-0b72-816b-9f68-c8e92570805b" class=""><code><strong>parts_and_replaces</strong></code></h3><p id="16f42927-0b72-8187-9e29-c09113176537" class="">Универсальная база данных, содержащая партномера, названия и изображения деталей.</p><ul id="16f42927-0b72-8144-a073-e1929d94e0d5" class="bulleted-list"><li style="list-style-type:disc">Используется для получения информации о названии и изображении деталей по партномеру.</li></ul><ul id="16f42927-0b72-81bc-9e21-d8e89b65e0a9" class="bulleted-list"><li style="list-style-type:disc">Связана с таблицей <code>Stock_Recount</code> через поле <code>recognized_part_number</code>.</li></ul><hr id="16f42927-0b72-817d-a549-d44ca8ea2840"/><h3 id="16f42927-0b72-81db-89f6-c3e41b776cc5" class=""><code><strong>stock_creds</strong></code></h3><p id="16f42927-0b72-81c6-acfe-d0dab76cb5f0" class="">Таблица, где хранится информация о стоках пользователя.</p><ul id="16f42927-0b72-81a6-be1a-f333efba2473" class="bulleted-list"><li style="list-style-type:disc">Используется для получения названия стока (<code>stock_name</code>) и привязки деталей из таблицы <code>user_stocks</code> к конкретному стоку.</li></ul><hr id="16f42927-0b72-812c-9b22-d91292349164"/><h3 id="16f42927-0b72-819b-9e27-fa33f1f7660d" class=""><code><strong>Stock_Recount</strong></code></h3><p id="16f42927-0b72-81f0-aaa0-f755729705cf" class="">Временная таблица для хранения данных о последней загруженной партии фотографий.</p><ul id="16f42927-0b72-814b-907a-faf88e5a1970" class="bulleted-list"><li style="list-style-type:disc">Используется для обработки баркодов, распознавания партномеров и их связи с универсальной базой данных (<code>parts_and_replaces</code>).</li></ul><p id="16f42927-0b72-8187-8b9f-f61bc7344447" class=""><strong>Основные поля:</strong></p><ul id="16f42927-0b72-815a-a591-e9835c205711" class="bulleted-list"><li style="list-style-type:disc"><code><strong>id</strong></code> — уникальный идентификатор записи.</li></ul><ul id="16f42927-0b72-8125-88c4-dadfba3bcb68" class="bulleted-list"><li style="list-style-type:disc"><code><strong>user_id</strong></code> — идентификатор пользователя, загрузившего фотографии.</li></ul><ul id="16f42927-0b72-8104-8889-f69719725ace" class="bulleted-list"><li style="list-style-type:disc"><code><strong>stock_id</strong></code> — идентификатор текущего стока.</li></ul><ul id="16f42927-0b72-81bb-a828-fc0b438e2298" class="bulleted-list"><li style="list-style-type:disc"><code><strong>photo_path</strong></code> — путь к загруженному изображению.</li></ul><ul id="16f42927-0b72-81b0-ad28-e0b2f3b92825" class="bulleted-list"><li style="list-style-type:disc"><code><strong>recognized_part_number</strong></code> — распознанный партномер (если баркод успешно обработан).</li></ul><ul id="16f42927-0b72-81b7-9fb5-c576d8bd151a" class="bulleted-list"><li style="list-style-type:disc"><code><strong>parts_and_replaces_id</strong></code> — идентификатор записи в таблице <code>parts_and_replaces</code> (при успешной связи).</li></ul><ul id="16f42927-0b72-81a1-aa6f-f0b2365f9b10" class="bulleted-list"><li style="list-style-type:disc"><code><strong>status</strong></code> — текущий статус обработки записи.</li></ul><p id="16f42927-0b72-8184-8413-f9a02be16be3" class=""><strong>Возможные значения статусов:</strong></p><ol type="1" id="16f42927-0b72-81d2-98b8-c8431ef1a129" class="numbered-list" start="0"><li><strong>New</strong> — Новая запись - <em>спец_запрос</em>.</li></ol><ol type="1" id="16f42927-0b72-81e0-9443-e6082b623fcd" class="numbered-list" start="1"><li><strong>New</strong> — Новая запись </li></ol><ol type="1" id="16f42927-0b72-81bb-8443-da9882ef2be8" class="numbered-list" start="2"><li><strong>Partnumber_Validated</strong> — Баркод распознан.</li></ol><ol type="1" id="16f42927-0b72-81cb-96b7-cbf998043738" class="numbered-list" start="3"><li><strong>Barcode Not Recognized</strong> — Баркод не распознан.</li></ol><ol type="1" id="16f42927-0b72-8193-b9d3-c4d1e1989341" class="numbered-list" start="4"><li><strong>Database Match</strong> — Найдено в базе данных.</li></ol><ol type="1" id="16f42927-0b72-81e0-a545-fc19a122ee7d" class="numbered-list" start="5"><li><strong>Not Found in Database</strong> — Не найдено в базе данных.</li></ol><ol type="1" id="16f42927-0b72-81dc-8c4c-e8e362e967c5" class="numbered-list" start="6"><li><strong>Online Match</strong> — Найдено в интернете.</li></ol><ol type="1" id="16f42927-0b72-811a-8dfe-d26c2d00ec47" class="numbered-list" start="7"><li><strong>Not Found Online</strong> — Не найдено в интернете.</li></ol></details></li></ul></details></li></ul><h2 id="16f42927-0b72-81fb-bc1f-f765003f75a5" class="">4.1 Stock Recount. Choose Stock</h2><ul id="16f42927-0b72-811b-87c0-d05fc026f9d6" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-8199-8822-e4c36f8eee97" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81ff-a619-fd60b9acc12c" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2025.png"><img style="width:435.9875183105469px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2025.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8168-a065-c5fc76844d52" class="">Экран предназначен для выбора стока, в котором будет выполняться инвентаризация.</p><h3 id="16f42927-0b72-81c4-a126-ff0a4721966c" class=""><strong>1. Инлайн-кнопки</strong></h3><p id="16f42927-0b72-8197-a92d-ec903c65af16" class=""><strong>Список текущих стоков пользователя:</strong></p><p id="16f42927-0b72-816a-a329-c3d818eb7557" class="">Стоки отображаются в виде инлайн-кнопок.</p><p id="16f42927-0b72-81ac-b586-df24262fc526" class=""><strong>Формат кнопки:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81be-88c3-d3d11e4afee9" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;Stock name&gt; (&lt;количество запчастей&gt;)
</code></pre><ul id="16f42927-0b72-8113-b708-fe90ee78be4b" class="bulleted-list"><li style="list-style-type:disc"><code><strong>stock_name</strong></code> —  название стока из таблицы <strong>stock_creds</strong>, где <code>user_id</code> соответствует текущему пользователю..</li></ul><ul id="16f42927-0b72-8183-b535-fc3cbed19b4d" class="bulleted-list"><li style="list-style-type:disc"><code><strong>parts_count</strong></code> — количество запчастей в стоке, рассчитывается на ходу с помощью <strong>COUNT()</strong> из таблицы <strong>user_stocks</strong>, где <code>stock_id</code> совпадает.</li></ul><p id="16f42927-0b72-81d9-ade1-eb3f685feafb" class=""><strong>Кнопка &quot;Add new stock&quot;:</strong></p><p id="16f42927-0b72-81bc-8579-d48a6105647f" class="">При нажатии отправляет пользователя на экран <strong>&quot;3.1 Add new stock&quot;</strong> для создания нового стока.</p><hr id="16f42927-0b72-81d9-a761-dde26cfc9d0c"/><h3 id="16f42927-0b72-8113-8257-eadb18fe4aa9" class=""><strong>2. Действие после выбора стока</strong></h3><p id="16f42927-0b72-81d6-8ef6-e32178f24b84" class=""><strong>Проверка наличия записей в таблице Stock_Recount:</strong></p><p id="16f42927-0b72-8105-b7b9-c9af187ae539" class="">После выбора стока бот проверяет, есть ли в таблице <strong>Stock_Recount</strong> записи, связанные с этим <code>stock_id</code>.</p><p id="16f42927-0b72-8137-a692-fbab8feeb189" class=""><strong>Результат проверки:</strong></p><ul id="16f42927-0b72-81ce-87d0-eb0dffd1bdc2" class="bulleted-list"><li style="list-style-type:disc"><strong>Если записи есть:</strong><br/>Пользователь автоматически переходит на экран <br/><strong>List Processing</strong>, где отображается список запчастей для обработки.</li></ul><ul id="16f42927-0b72-81f6-bdce-d3b04df51d2f" class="bulleted-list"><li style="list-style-type:disc"><strong>Если записей нет:</strong><br/>Пользователь переходит на экран <br/><strong>4.2 Upload Photos</strong> для загрузки фотографий.</li></ul><hr id="16f42927-0b72-8167-a2c1-f5aabdaee28e"/><h3 id="16f42927-0b72-8165-af67-ca586a7c0a18" class=""><strong>3. Итог</strong></h3><ul id="16f42927-0b72-8186-8c3d-ef37c687355b" class="bulleted-list"><li style="list-style-type:disc">Пользователь выбирает сток для проведения инвентаризации.</li></ul><ul id="16f42927-0b72-81bf-9273-cf0388caef82" class="bulleted-list"><li style="list-style-type:disc">Стоки отображаются в виде инлайн-кнопок с количеством запчастей.</li></ul><ul id="16f42927-0b72-81a8-8f43-d105438f0637" class="bulleted-list"><li style="list-style-type:disc">При выборе стока система проверяет таблицу <strong>Stock_Recount</strong>:<ul id="16f42927-0b72-814e-afbd-f5a693a7e698" class="bulleted-list"><li style="list-style-type:circle"><strong>Если записи есть</strong> — переход на <strong>List Processing</strong>.</li></ul><ul id="16f42927-0b72-8160-9228-e5ba94b2400d" class="bulleted-list"><li style="list-style-type:circle"><strong>Если записей нет</strong> — переход на <strong>Upload Photos</strong>.</li></ul></li></ul><ul id="16f42927-0b72-812a-bf3e-ee2525dbc52e" class="bulleted-list"><li style="list-style-type:disc">При необходимости пользователь может создать новый сток, нажав на кнопку <strong>&quot;Add new stock&quot;</strong>.</li></ul></details></li></ul><h2 id="16f42927-0b72-8149-b967-f6a87d792fc7" class="">4.2 Upload photos</h2><ul id="16f42927-0b72-812d-b319-c3eacd0d5917" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-81bc-9a4b-d8bdb9bb3e27" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81e0-8d52-d69d7a5d2a84" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2026.png"><img style="width:924px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2026.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81cd-b054-c479a3a91045" class="">Эта страница предназначена для загрузки фотографий пользователем, если в таблице Stock_Recount для выбранного стока нет записей.</p><hr id="16f42927-0b72-8112-a32a-c71b2d7e1ca1"/><h3 id="16f42927-0b72-81d0-9d0a-c2f054d7d9f0" class=""><strong>Действия пользователя:</strong></h3><ul id="16f42927-0b72-81b1-bab2-d625295c6f31" class="bulleted-list"><li style="list-style-type:disc"><strong>Пользователь загружает одну или несколько фотографий.</strong></li></ul><hr id="16f42927-0b72-8105-8502-ce1bf45ebd4a"/><h3 id="16f42927-0b72-8127-a862-cf5619014aaf" class=""><strong>Ограничения:</strong></h3><ul id="16f42927-0b72-81c1-bde5-ead2550d8729" class="bulleted-list"><li style="list-style-type:disc"><strong>Количество фотографий:</strong><br/>Лимит зависит от возможностей Telegram (сколько позволяет отправить за один раз).<br/></li></ul><ul id="16f42927-0b72-817a-9ec2-f2b44d41ff23" class="bulleted-list"><li style="list-style-type:disc"><strong>Формат файлов:</strong><br/>Поддерживаются только изображения.<br/><ul id="16f42927-0b72-81a1-ab94-d7549e7a91ed" class="bulleted-list"><li style="list-style-type:circle"><strong>Если формат неверный:</strong><br/>Сообщение: <br/><strong>&quot;Invalid request. Please upload photos only.&quot;</strong></li></ul></li></ul><hr id="16f42927-0b72-8100-926d-cedb415baa05"/><h3 id="16f42927-0b72-8157-9cca-d5c54ccbc5f9" class=""><strong>После отправки фото:</strong></h3><ol type="1" id="16f42927-0b72-81a0-a11b-eac509e394c5" class="numbered-list" start="1"><li><strong>Сохранение файлов:</strong><ul id="16f42927-0b72-81f5-a7b8-f8f8a6417652" class="bulleted-list"><li style="list-style-type:disc">Фотографии сохраняются на сервере в папку:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8171-957a-e9457de8209b" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">users/{user_id}/stocks/{stock_id}/Stock_Recount/
</code></pre></li></ul></li></ol><ol type="1" id="16f42927-0b72-81fe-8694-e818a72f6ab3" class="numbered-list" start="2"><li><strong>Запись в таблице Stock_Recount:</strong><p id="16f42927-0b72-8178-8198-d660745ae9b2" class="">При сохранении каждой фотографии в таблице <strong>Stock_Recount</strong> создается новая запись со следующими данными:</p><ul id="16f42927-0b72-81c9-8f65-c04f7f2f7dec" class="bulleted-list"><li style="list-style-type:disc"><code><strong>id</strong></code> — уникальный идентификатор записи (автоинкремент).</li></ul><ul id="16f42927-0b72-81bd-8b70-c7d171cd8d6d" class="bulleted-list"><li style="list-style-type:disc"><code><strong>user_id</strong></code> — идентификатор пользователя, загрузившего фото.</li></ul><ul id="16f42927-0b72-8100-8c32-df131dbb5b3f" class="bulleted-list"><li style="list-style-type:disc"><code><strong>stock_id</strong></code> — идентификатор текущего стока.</li></ul><ul id="16f42927-0b72-811e-8d21-c843ca20cb00" class="bulleted-list"><li style="list-style-type:disc"><code><strong>photo_path</strong></code> — путь к сохраненному изображению (относительный путь в директории).</li></ul><ul id="16f42927-0b72-8168-84ed-db875c6deee0" class="bulleted-list"><li style="list-style-type:disc"><code><strong>recognized_part_number</strong></code> — пустое значение (ожидает распознавания).</li></ul><ul id="16f42927-0b72-81b2-9606-c35b65dbf57e" class="bulleted-list"><li style="list-style-type:disc"><code><strong>parts_and_replaces_id</strong></code> — пустое значение (ожидает обработки).</li></ul><ul id="16f42927-0b72-813c-bd5d-df7d8affa462" class="bulleted-list"><li style="list-style-type:disc"><code><strong>status</strong></code> — устанавливается как <strong>0 (Новая запись)</strong>.</li></ul></li></ol><hr id="16f42927-0b72-81fb-8b94-f2064405a820"/><h3 id="16f42927-0b72-8115-a24b-c96ef0efaca3" class=""><strong>Переход на следующую страницу:</strong></h3><p id="16f42927-0b72-81f5-ba0b-ec3b106218f3" class="">После успешной загрузки фотографий и создания записей в базе данных пользователь <strong>автоматически переходит на страницу “4.3 List Processing”</strong>.</p><p id="16f42927-0b72-8179-bd8e-f7205af534b0" class="">
</p></details></li></ul><h2 id="16f42927-0b72-81ba-8282-e73cc5fa926a" class="">4.3 List Processing</h2><ul id="16f42927-0b72-814b-95a0-de57389485fa" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-8199-86a0-f207e36f7624" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8138-949d-dca0e61bd031" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2027.png"><img style="width:960px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2027.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8173-addc-f73683eb5104" class="">После загрузки фотографий пользователь автоматически попадает на этот экран. Здесь отображаются результаты обработки фотографий и предлагаются действия для работы со списком.</p><hr id="16f42927-0b72-81c3-830f-f3a583f79d34"/><h3 id="16f42927-0b72-818f-97eb-e9cd07beea10" class=""><strong>1. Сообщение пользователю:</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81b4-af09-dd6448e173ee" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Results
1. Parts in Progress: A ⏳
2. Parts recognized: Y ✅
3. Parts not recognized: Z ⚠️
4. Errors: N 🚫

Options:
📝 Show / Edit List — view or edit the current list.
🔄 Replace Stock File — replace the current stock with this list.
➕ Add Parts to Stock — add parts from this list to the existing stock.
📸 Clear List / Upload New Photos — delete this list and upload new photos.

What action would you like to take with this list?
</code></pre><hr id="16f42927-0b72-81d9-b044-d07e5df6cc91"/><h3 id="16f42927-0b72-8132-a018-e138276f92f9" class=""><strong>2. Расчет показателей и статуса обработки</strong></h3><h3 id="16f42927-0b72-8186-9d92-e4a530fbf4c7" class=""><strong>2.1 Показатели:</strong></h3><p id="16f42927-0b72-8112-a262-c1a30b676376" class="">Показатели рассчитываются на основе количества записей с разными значениями в поле <code><strong>status</strong></code> таблицы <strong>Stock_Recount</strong>:</p><ul id="16f42927-0b72-813f-ad00-d96c26fc35fe" class="bulleted-list"><li style="list-style-type:disc"><strong>Parts in Progress (A):</strong><p id="16f42927-0b72-8102-871f-d2f65fbf2fa3" class="">Количество записей со статусами:</p><ul id="16f42927-0b72-81a5-9b67-c023061b4671" class="bulleted-list"><li style="list-style-type:circle"><strong>0 (New):</strong> Новая запись - спец запрос</li></ul><ul id="16f42927-0b72-81cf-86c2-de4175df3661" class="bulleted-list"><li style="list-style-type:circle"><strong>1 (New):</strong> Новая запись</li></ul><ul id="16f42927-0b72-810e-a796-d6329af03b7d" class="bulleted-list"><li style="list-style-type:circle"><strong>5 (Not Found in Database):</strong> Не найдено в базе данных.</li></ul><ul id="16f42927-0b72-81ea-8946-d694e4f61128" class="bulleted-list"><li style="list-style-type:circle"><strong>2 (Partnumber_Validated):</strong> Прошла баркод корректно, но поиск в БД не завершен.</li></ul></li></ul><ul id="16f42927-0b72-817e-9a8e-d1c6b59e2ec5" class="bulleted-list"><li style="list-style-type:disc"><strong>Parts recognized (Y):</strong><p id="16f42927-0b72-8128-80c0-d91900893d6b" class="">Количество записей со статусами:</p><ul id="16f42927-0b72-81f9-8c37-d019339ed1d3" class="bulleted-list"><li style="list-style-type:circle"><strong>4 (Database Match):</strong> Найдено в базе данных.</li></ul><ul id="16f42927-0b72-81e6-95eb-df27992e63f8" class="bulleted-list"><li style="list-style-type:circle"><strong>6 (Online Match):</strong> Найдено в интернете.</li></ul></li></ul><ul id="16f42927-0b72-818e-9c2a-cc1aa122f448" class="bulleted-list"><li style="list-style-type:disc"><strong>Parts not recognized (Z):</strong><p id="16f42927-0b72-8121-99b7-e9ad86e828a8" class="">Количество записей со статусом:</p><ul id="16f42927-0b72-8163-b384-c03da8cc57fe" class="bulleted-list"><li style="list-style-type:circle"><strong>7 (Not Found Online):</strong> Не найдено в интернете.</li></ul></li></ul><ul id="16f42927-0b72-8198-ba77-deff59cad701" class="bulleted-list"><li style="list-style-type:disc"><strong>Errors (N):</strong><p id="16f42927-0b72-81e3-830d-f447c83ccc4d" class="">Количество записей со статусом:</p><ul id="16f42927-0b72-81e3-8b96-fc7be173d4f3" class="bulleted-list"><li style="list-style-type:circle"><strong>3 (Barcode Not Recognized):</strong> Баркод не распознан.</li></ul></li></ul><hr id="16f42927-0b72-81f6-82e2-e05c08a83abf"/><h3 id="16f42927-0b72-8113-9514-e85c9b93be8d" class=""><strong>2.2 Расчет статуса процесса:</strong></h3><p id="16f42927-0b72-8106-a5d4-deeb795f29d7" class="">Статус процесса определяется на основе показателя <strong>Parts processing (A):</strong></p><ul id="16f42927-0b72-81ea-80fb-e9b5066793f2" class="bulleted-list"><li style="list-style-type:disc"><strong>Если Parts processing (A) ≠ 0:Status: Processing ⏳</strong></li></ul><ul id="16f42927-0b72-8168-b7b3-f5cd1129efb8" class="bulleted-list"><li style="list-style-type:disc"><strong>Если Parts processing (A) = 0:Status: Done ✅</strong></li></ul><p id="16f42927-0b72-811b-906a-dad9e3227a10" class="">Таким образом:</p><ul id="16f42927-0b72-816c-a72b-c660cd357be7" class="bulleted-list"><li style="list-style-type:disc">Если в таблице <strong>Stock_Recount</strong> остаются записи со статусами 0<strong> (New),</strong> <strong>1 (New)</strong> или <strong>5 (Not Found in Database)</strong>, процесс считается выполняющимся.</li></ul><ul id="16f42927-0b72-81a3-b3be-fadbb815f130" class="bulleted-list"><li style="list-style-type:disc">Если таких записей нет, процесс считается завершенным.</li></ul><hr id="16f42927-0b72-819c-91ef-dd66713ee983"/><h3 id="16f42927-0b72-8161-a6c7-c2bf696238e6" class=""><strong>3. Обновление страницы:</strong></h3><ul id="16f42927-0b72-8112-ad49-f33578096a9b" class="bulleted-list"><li style="list-style-type:disc">Когда пользователь находится на этом экране, бот автоматически обновляет сообщение каждые <strong>2 секунды</strong>, пересчитывая показатели и статус обработки.</li></ul><ul id="16f42927-0b72-814c-b9e2-f1f210368df2" class="bulleted-list"><li style="list-style-type:disc">Обновление продолжается до тех пор, пока:<ul id="16f42927-0b72-81ff-a7c2-c3699a4a081f" class="bulleted-list"><li style="list-style-type:circle"><strong>Статус не изменится на &quot;Done&quot;</strong>, или</li></ul><ul id="16f42927-0b72-81d0-9971-f2b85cec7c6f" class="bulleted-list"><li style="list-style-type:circle">Пользователь не уйдет с этой страницы (в этом случае обновления прекращаются).</li></ul></li></ul><ul id="16f42927-0b72-81df-b584-cb6487e199c7" class="toggle"><li><details open=""><summary><strong>Описание статусов в таблице</strong> <strong>Stock_Recount:</strong></summary><p id="16f42927-0b72-8104-9207-fff1601295e3" class="">0 - <strong>New</strong> <em>(Новая запись - спецзапрос)</em></p><p id="16f42927-0b72-8165-a53f-ef49ba08c190" class="">1 - <strong>New</strong> <em>(Новая запись)</em></p><p id="16f42927-0b72-819c-ac16-cdce79ab1a23" class="">2 - <strong>Partnumber_Validated</strong> <em>(Прошла баркод корректно)</em></p><p id="16f42927-0b72-81ad-bca9-d0e15f3fe837" class="">3 - <strong>Barcode Not Recognized</strong> <em>(Прошла баркод некорректно)</em></p><p id="16f42927-0b72-815f-b32a-f816cdf5cf71" class="">4 - <strong>Database Match</strong> <em>(Найдено в базе данных)</em></p><p id="16f42927-0b72-811c-ab5f-c5bdd2f3cebe" class="">5 - <strong>Not Found in Database</strong> <em>(Не найдено в базе данных)</em></p><p id="16f42927-0b72-81e0-a61e-ffb27e2b2f96" class="">6 - <strong>Online Match</strong> <em>(Найдено в интернете)</em></p><p id="16f42927-0b72-81a5-8363-e80373cce785" class="">7 - <strong>Not Found Online</strong> <em>(Не найдено в интернете)</em></p></details></li></ul></details></li></ul><h2 id="16f42927-0b72-8188-9140-fc41d1d38f2a" class="">4.4 Show List</h2><ul id="16f42927-0b72-8147-8cf7-cc576b49e248" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-81b0-b83a-fc7b9ffe5405" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8132-a655-ea97a4d7c815" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2028.png"><img style="width:1816px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2028.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8152-8a1e-ff655c08d0e5" class="">Вывод списка деталей — фотографии, загруженные пользователем:</p><p id="16f42927-0b72-813f-b370-f05b4e9c43cb" class="">Применяем <strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Правила построения «Списка деталей»</a></strong>.</p><ul id="16f42927-0b72-81a8-a276-c6a8622692d5" class="bulleted-list"><li style="list-style-type:disc"><strong>Вводные данные</strong>: список деталей из таблицы <code>Stock_Recount</code> для текущего <code>stock_id</code>. В качестве партномера используется поле <code>recognized_part_number</code>.</li></ul><p id="16f42927-0b72-81b9-9660-da2c6831701a" class=""><strong>Примечание</strong>: в списке содержатся данные о стоках.</p><p id="16f42927-0b72-8125-83b5-edd0842c3ac4" class=""><strong>Клик по блоку с деталью. </strong>Согласно общей логике работы со списками - переходим на 2.3 Страница Детали.</p><ul id="16f42927-0b72-8125-8d7b-e3b243210a65" class="toggle"><li><details open=""><summary><strong>4.4.1 Клик по нижнему блоку в списке Edit</strong></summary><ul id="16f42927-0b72-8123-a365-f82094cc5957" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark> </summary><p id="16f42927-0b72-812b-ba7e-dd1d1eb2950a" class="">Выводим тот же список, но с возможностью редактирования партномера. см п 1.5.1</p></details></li></ul></details></li></ul><p id="16f42927-0b72-8158-91d7-c87563f0b5d6" class=""><div class="indented"><ul id="16f42927-0b72-81f6-aaab-fbd0162e4133" class="toggle"><li><details open=""><summary><strong>4.4.2 Edit partnumber</strong></summary><ul id="16f42927-0b72-8158-8c9f-c8035c817e59" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8180-ada0-e4b858b4be33" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2029.png"><img style="width:1460px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2029.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8162-a6b4-f8b8b9af1251" class="">Экран где пользователь может изменить партномер. см п 1.5.2</p><p id="16f42927-0b72-818e-9e63-c361fd243300" class="">При клике на деталь на экране 4.4, пользователь остается на той же странице. Лист деталей скрывается, и бот отправляет сообщение с информацией о выбранной детали (загруженное фото, распознанный партномер, фото из БД, название). Бот ожидает ввода нового партномера, после чего заменяет его в таблице Stock_Recount.</p><h3 id="16f42927-0b72-81c0-a53b-d25d7ebc4c64" class=""><strong>1. Содержание сообщения:</strong></h3><h3 id="16f42927-0b72-813a-92f8-e820ec5e2892" class=""><strong>Изображения - мы выводит 2 фото в одном сообщении:</strong></h3><ul id="16f42927-0b72-81bd-8a89-f7df0e174400" class="bulleted-list"><li style="list-style-type:disc"><strong>Фото, загруженное пользователем:</strong><br/>Берется из поля <br/><code>photo_path</code> таблицы <strong>Stock_Recount</strong>.</li></ul><ul id="16f42927-0b72-81ea-86ac-f7c9d8b62258" class="bulleted-list"><li style="list-style-type:disc"><strong>Фото из таблицы Parts_and_Replaces:</strong><br/>Отображается, если:<br/><ul id="16f42927-0b72-81b7-9bbc-d5d5ef21fb25" class="bulleted-list"><li style="list-style-type:circle">Поле <code>Parts_and_Replaces_id</code> в таблице <strong>Stock_Recount</strong> не пустое.</li></ul><ul id="16f42927-0b72-81f4-959a-d3e3650020b5" class="bulleted-list"><li style="list-style-type:circle">Поле <code>pic</code> в таблице <strong>Parts_and_Replaces</strong> заполнено.</li></ul></li></ul><p id="16f42927-0b72-81f5-9835-eccf6e4aec0e" class=""><strong>Примечания:</strong></p><ul id="16f42927-0b72-81f3-8a12-fadbd037f16a" class="bulleted-list"><li style="list-style-type:disc">Если условия для второго фото не выполнены, отправляется только фото, загруженное пользователем.</li></ul><ul id="16f42927-0b72-81b2-8cd4-db188648f1d2" class="bulleted-list"><li style="list-style-type:disc">Если оба условия выполнены, оба фото отправляются в одном сообщении.</li></ul><h3 id="16f42927-0b72-818e-84c7-cbbc7f5aa50b" class=""><strong>Текстовое сообщение:</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8141-b28d-e74fcfc1420f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Barcode result: {значение из recognized_part_number в Stock_Recount}
Part name: {значение из part_name в Parts_and_Replaces, если запись найдена, если не найдена - &quot;N/A&quot;}
Please enter a new part number:
</code></pre><ul id="16f42927-0b72-812e-8188-f821fd0ecd75" class="bulleted-list"><li style="list-style-type:disc"><strong>Barcode result:</strong> Извлекается из <code>recognized_part_number</code> таблицы <strong>Stock_Recount</strong>.</li></ul><ul id="16f42927-0b72-81fa-8847-ddeac4cd67c6" class="bulleted-list"><li style="list-style-type:disc"><strong>Part name:</strong> Извлекается из <code>part_name</code> таблицы <strong>Parts_and_Replaces</strong>, если запись найдена. Если записи нет, строка с именем детали отсутствует.</li></ul><hr id="16f42927-0b72-8145-b03c-d74a636efdbe"/><h3 id="16f42927-0b72-8154-a6ef-cb6bdcf01caf" class=""><strong>2. Действия пользователя:</strong></h3><ol type="1" id="16f42927-0b72-8163-be76-c83d2974ee6d" class="numbered-list" start="1"><li><strong>Ввод нового партномера:</strong><ul id="16f42927-0b72-81ef-b0aa-ec52e6dc456b" class="bulleted-list"><li style="list-style-type:disc">Пользователь вводит новый партномер.</li></ul><ul id="16f42927-0b72-81bc-bbd5-f79cd5d7ff46" class="bulleted-list"><li style="list-style-type:disc">Ввод проверяется согласно логике п. 2.1.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8171-9cc5-d43b531b5870" class="numbered-list" start="2"><li><strong>Если ввод корректен:</strong><ul id="16f42927-0b72-813e-b567-f2c6ff12338f" class="bulleted-list"><li style="list-style-type:disc">Новый партномер записывается в поле <code>recognized_part_number</code> таблицы <strong>Stock_Recount</strong> для текущей записи (по идентификатору <code>id</code>).</li></ul><ul id="16f42927-0b72-81d8-8a9d-cf726b0d870e" class="bulleted-list"><li style="list-style-type:disc">Устанавливается Статус 2 в таблице <strong>Stock_Recount</strong></li></ul><ul id="16f42927-0b72-8160-a553-f4261e3661a7" class="bulleted-list"><li style="list-style-type:disc">Пользователь получает сообщение:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81f0-b44d-c0c45195d5e0" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Part number updated successfully.
</code></pre></li></ul><ul id="16f42927-0b72-81ad-ac3b-fb99d8d01c72" class="bulleted-list"><li style="list-style-type:disc">Пользователь остается на этой странице 4.3 для продолжения работы.</li></ul><p id="16f42927-0b72-8152-a945-da9434766e21" class="">
</p><p id="16f42927-0b72-81ff-8757-d9ebca3fac53" class="">
</p></li></ol></details></li></ul></div></p></details></li></ul><h2 id="16f42927-0b72-8184-afd6-e6c070950d26" class="">4.5 Кнопки 🔄 Replace Stock File / ➕ Add Parts to Stock </h2><ul id="16f42927-0b72-8171-8aea-e3220e5c5d6a" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-813a-be77-ce58d837af04" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин </mark></mark></summary><figure id="16f42927-0b72-819d-ba39-c8e97076b91d" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2030.png"><img style="width:2552px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2030.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81e6-9be3-e607d4f49b3b" class=""><strong>Replace Stock File</strong> или <strong>Add Parts to Stock</strong> позволяют заменить или добавить запчасти из таблицы <strong>Stock_Recount</strong> в таблицу <strong>User_stocks</strong>.</p><p id="16f42927-0b72-8160-9896-e75d542185c1" class="">Эти действия выполняются после экрана подтверждения, где пользователь видит информацию о добавляемых и удаляемых запчастях, и подтверждает операцию. После выполнения пользователь возвращается на страницу <strong>“3.2 Управление стоком”</strong>.</p><hr id="16f42927-0b72-81e4-88db-ce2c8b59c08f"/><h3 id="16f42927-0b72-8116-bbf5-ebdb3f9c8ac6" class=""><strong>1. Сообщение пользователю:</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81f6-9bdb-dfac34f06cbb" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">{Action name}

Parts to be added: {X}
Parts to be removed (barcode errors): {Y} 🚫

Please confirm:
</code></pre><ul id="16f42927-0b72-8121-8e54-e93814e37ec3" class="bulleted-list"><li style="list-style-type:disc"><strong>{Action name}</strong> — это выбранное на предыдущем шаге действие. Возможные значения:<ul id="16f42927-0b72-812c-8650-e3e9c00233e4" class="bulleted-list"><li style="list-style-type:circle">Replace Stock File</li></ul><ul id="16f42927-0b72-8144-a1bf-df3510d6837c" class="bulleted-list"><li style="list-style-type:circle">Add Parts to Stock</li></ul></li></ul><ul id="16f42927-0b72-81b3-9184-ec56a71db00b" class="bulleted-list"><li style="list-style-type:disc"><strong>{X}</strong> — сумма записей в таблице <strong>Stock_Recount</strong> со статусами <strong>2, 4, 5, 6, 7</strong>.</li></ul><ul id="16f42927-0b72-812d-b72b-fbf2bb55debd" class="bulleted-list"><li style="list-style-type:disc"><strong>{Y}</strong> — сумма записей в таблице <strong>Stock_Recount</strong> со статусами <strong>1, 3</strong>.</li></ul><p id="16f42927-0b72-81c8-bd0b-ea06dfe3475f" class=""><strong>Подтверждение:</strong></p><p id="16f42927-0b72-81a0-987c-fffb3cf17a73" class="">Пользователь подтверждает действие с помощью инлайн-кнопки <strong>Confirm</strong>.</p><hr id="16f42927-0b72-81c7-a929-c26641f20920"/><h3 id="16f42927-0b72-811b-9967-c0fd185ff4b6" class=""><strong>2. Действия после подтверждения:</strong></h3><h3 id="16f42927-0b72-81f0-8517-e2a053934d1e" class=""><strong>2.1 Replace Stock File:</strong></h3><ol type="1" id="16f42927-0b72-81de-8ab0-c8f7e254af9b" class="numbered-list" start="1"><li>Удаляет все записи, связанные с текущим стоком (<code>stock_id</code>), из таблицы <strong>User_stocks</strong>.</li></ol><ol type="1" id="16f42927-0b72-81f1-baad-c65b1144854a" class="numbered-list" start="2"><li>Добавляет записи из таблицы <strong>Stock_Recount</strong>, связанные с текущим стоком (<code>stock_id</code>), для записей со статусами <strong>2, 4, 5, 6, 7</strong>:<ul id="16f42927-0b72-817d-9ff2-fb84ebe63a2e" class="bulleted-list"><li style="list-style-type:disc">В поле <code>part_number</code> таблицы <strong>User_stocks</strong> записывается распознанный партномер (<code>recognized_part_number</code> из таблицы <strong>Stock_Recount</strong>).</li></ul><ul id="16f42927-0b72-81eb-bfa7-c8edefd2fd7c" class="bulleted-list"><li style="list-style-type:disc">Поле <code>Parts_and_Replaces_id</code>, уже присутствующее в обеих таблицах (<strong>Stock_Recount</strong> и <strong>User_stocks</strong>), просто переносится.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8110-a132-dd4bf18c7346" class="numbered-list" start="3"><li>Удаляет все записи из таблицы <strong>Stock_Recount</strong>, связанные с текущим стоком (<code>stock_id</code>).</li></ol><hr id="16f42927-0b72-81a8-9c24-f6943bd11828"/><h3 id="16f42927-0b72-81d1-87c5-fbef8995eaa8" class=""><strong>2.2 Add Parts to Stock:</strong></h3><ol type="1" id="16f42927-0b72-81f1-b782-d94dbd11ea94" class="numbered-list" start="1"><li>Существующие записи в таблице <strong>User_stocks</strong> для текущего стока остаются без изменений.</li></ol><ol type="1" id="16f42927-0b72-81e7-a079-dc5405f5bce6" class="numbered-list" start="2"><li>Добавляет новые записи из таблицы <strong>Stock_Recount</strong>, связанные с текущим стоком (<code>stock_id</code>), для записей со статусами <strong>2, 4, 5, 6, 7</strong>:<ul id="16f42927-0b72-815a-be0a-f6b487b1cf11" class="bulleted-list"><li style="list-style-type:disc">В поле <code>part_number</code> таблицы <strong>User_stocks</strong> записывается распознанный партномер (<code>recognized_part_number</code> из таблицы <strong>Stock_Recount</strong>).</li></ul><ul id="16f42927-0b72-81be-9941-c89db653ed5e" class="bulleted-list"><li style="list-style-type:disc">Поле <code>Parts_and_Replaces_id</code>, уже присутствующее в обеих таблицах (<strong>Stock_Recount</strong> и <strong>User_stocks</strong>), просто переносится.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8108-8467-df83600b66a1" class="numbered-list" start="3"><li>Удаляет все записи из таблицы <strong>Stock_Recount</strong>, связанные с текущим стоком (<code>stock_id</code>).</li></ol><hr id="16f42927-0b72-8166-9d56-dcb3744f1cc9"/><h3 id="16f42927-0b72-8176-90df-fa335f5ccef2" class=""><strong>3. Основное различие:</strong></h3><ul id="16f42927-0b72-811e-824c-d0fe9df62190" class="bulleted-list"><li style="list-style-type:disc"><strong>Replace Stock File:</strong> Полностью удаляет существующие записи из таблицы <strong>User_stocks</strong> перед добавлением новых.</li></ul><ul id="16f42927-0b72-81dd-b113-ebce19db1c29" class="bulleted-list"><li style="list-style-type:disc"><strong>Add Parts to Stock:</strong> Сохраняет существующие записи в таблице <strong>User_stocks</strong> и добавляет новые записи.</li></ul><hr id="16f42927-0b72-8154-824b-f18cc30e14b6"/><h3 id="16f42927-0b72-8167-bb5c-d8a17d772861" class=""><strong>4. Завершение действия:</strong></h3><p id="16f42927-0b72-819b-b049-db5249c30b1b" class="">После выполнения действия пользователь возвращается на страницу <strong>“3.2 Управление стоком”</strong>. при этом активным остается текущий сток.</p><p id="16f42927-0b72-81aa-bc19-c763d60327b5" class=""><strong>Сообщение пользователю:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-818f-97b7-e8b35404e31d" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">{Action name}
Done
</code></pre><ul id="16f42927-0b72-8163-9e8f-d5dd94c7ed8c" class="bulleted-list"><li style="list-style-type:disc"><strong>{Action name}</strong> — выполненное действие:<ul id="16f42927-0b72-81b0-8ca1-e6e44650fc19" class="bulleted-list"><li style="list-style-type:circle">Replace Stock File</li></ul><ul id="16f42927-0b72-81a2-9261-ed656bc5ac9c" class="bulleted-list"><li style="list-style-type:circle">Add Parts to Stock</li></ul></li></ul><hr id="16f42927-0b72-81c3-a4c8-e916f177d68e"/><h3 id="16f42927-0b72-81c6-b24f-c67193e127a8" class=""><strong>5. Итог:</strong></h3><ul id="16f42927-0b72-8188-b346-ea3f64a48823" class="bulleted-list"><li style="list-style-type:disc">Пользователь подтверждает действие, после чего бот выполняет его.</li></ul><ul id="16f42927-0b72-8179-a9b3-c9ec3af1c452" class="bulleted-list"><li style="list-style-type:disc">Возможные действия:<ul id="16f42927-0b72-811b-b028-d8b017fca49d" class="bulleted-list"><li style="list-style-type:circle">Полное обновление стока.</li></ul><ul id="16f42927-0b72-810b-b1bc-e8ebb15a3b6a" class="bulleted-list"><li style="list-style-type:circle">Добавление новых записей в существующий сток.</li></ul></li></ul><ul id="16f42927-0b72-8132-ae49-f5223d40afa6" class="bulleted-list"><li style="list-style-type:disc">После выполнения пользователь переходит на страницу <strong>“3.2 Управление стоком”</strong> с подтверждающим сообщением, при этом активным остается текущий сток..</li></ul></details></li></ul><h2 id="16f42927-0b72-816b-9ec5-e345d88b7a65" class="">4.6 Clear List / Upload New Photos</h2><ul id="16f42927-0b72-8134-b860-fb869c42f4b7" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание </mark></mark></summary><ul id="16f42927-0b72-8100-a112-fe5c45975d3f" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81d0-8646-f17d49085348" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2031.png"><img style="width:2834px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2031.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81fe-93ec-c69f48aa650c" class="">Эта Кнопка позволяет пользователю удалить результаты предыдущей загрузки баркодов (очистить таблицу <strong>Stock_Recount</strong> по текущему <code>stock_id</code>) и перейти на страницу для загрузки новых фотографий.</p><p id="16f42927-0b72-8119-8ee4-c47f5508fd68" class=""><strong>Примечание: </strong>Текущая логика запрещает загружать или обрабатывать новую партию фотографий, пока пользователь не примет решение по старому списку (загрузил распознанные номера в свой сток или удалил их).</p><hr id="16f42927-0b72-810f-936a-c9d9cd3f7576"/><h3 id="16f42927-0b72-8186-80a9-e1b60f0e4af7" class=""><strong>Сообщение пользователю:</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81a4-9037-d25339f946ef" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Clear List / Upload New Photos

Please confirm:
</code></pre><p id="16f42927-0b72-81f0-8e7d-f8501a1cc27b" class="">Пользователь подтверждает действие с помощью инлайн-кнопки <strong>Confirm</strong>.</p><hr id="16f42927-0b72-81f8-b801-f19942afbdba"/><h3 id="16f42927-0b72-8152-af1c-cee842dea601" class=""><strong>Действия после подтверждения:</strong></h3><ol type="1" id="16f42927-0b72-8121-b3c7-e60433663468" class="numbered-list" start="1"><li><strong>Действия в базе данных:</strong><ul id="16f42927-0b72-812d-9805-e35563b752ef" class="bulleted-list"><li style="list-style-type:disc">Удаляются все записи в таблице <strong>Stock_Recount</strong>, связанные с текущим стоком (<code>stock_id</code>).</li></ul><ul id="16f42927-0b72-81b9-9805-d6648fe3a658" class="bulleted-list"><li style="list-style-type:disc">Новые данные не добавляются.</li></ul></li></ol><ol type="1" id="16f42927-0b72-8172-b486-c25e224df3cc" class="numbered-list" start="2"><li><strong>Переход на следующую страницу:</strong><p id="16f42927-0b72-819f-9ada-d0198abfa78f" class="">После выполнения действия пользователь возвращается на страницу <strong>4.2 Upload Photos</strong>, где он может загрузить новые фотографии.</p></li></ol><ol type="1" id="16f42927-0b72-8113-a754-e9fee224d999" class="numbered-list" start="3"><li><strong>Сообщение пользователю:</strong></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-816b-964f-cb1820080dc3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">List Cleared

Please send photos with part barcodes — single photos or in batches:
</code></pre><hr id="16f42927-0b72-81f3-ad9c-df2cb5db634d"/><h3 id="16f42927-0b72-8140-9d1e-db66c6fc867b" class=""><strong>Итог:</strong></h3><ul id="16f42927-0b72-8170-8aec-d4f66ee2cfaf" class="bulleted-list"><li style="list-style-type:disc">Пользователь подтверждает действие, после чего бот очищает таблицу <strong>Stock_Recount</strong> по текущему <code>stock_id</code>.</li></ul><ul id="16f42927-0b72-817e-b91b-e190b866f74f" class="bulleted-list"><li style="list-style-type:disc">После этого пользователь переходит на страницу <strong>4.2 Upload Photos</strong>, где может загрузить новую партию фотографий.</li></ul></details></li></ul></details></li></ul><h1 id="16f42927-0b72-817d-97c3-cafe435c9421" class="">5. Функция “Prices”</h1><ul id="16f42927-0b72-813d-ab90-ebe81167167c" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание Функция “Prices”</mark></mark></summary><ul id="16f42927-0b72-811e-8242-f4bea0b64c9a" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин Блоки сообщения</mark></mark></summary><figure id="16f42927-0b72-81f1-940b-c83b129ed705" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2032.png"><img style="width:651.9874877929688px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2032.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-8174-a88f-ce32118e3b65" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин_Экран запроса - Экран выдачи</mark></mark></summary><figure id="16f42927-0b72-813a-ae0d-c583e1d452ec" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2033.png"><img style="width:1292px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2033.png"/></a></figure></details></li></ul><p id="16f42927-0b72-812a-afc7-e70f720d45ed" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-81ea-b3ae-dd2a8cb20742" class="">Функция Prices обычно запускается с экрана 2.3 «Страница детали», пропуская этот шаг и сразу показывая сообщение о ценах на детали. Однако пользователь может зайти в раздел Prices через главное меню бота и ввести партномер.</p><p id="16f42927-0b72-814c-9aa2-f388c77eed2f" class="">В этом случае бот:</p><ul id="16f42927-0b72-819f-8d33-e9f8f8f29fec" class="bulleted-list"><li style="list-style-type:disc">Проверяет корректность ввода (п. 2.1). Если всё в порядке:<ul id="16f42927-0b72-81ab-a80d-dc588fcf2dab" class="bulleted-list"><li style="list-style-type:circle">Формирует задание на поиск детали в таблице <code>pricebot_tasks</code>.</li></ul><ul id="16f42927-0b72-8159-87cb-c6dccb4a606c" class="bulleted-list"><li style="list-style-type:circle">Каждые 3 секунды проверяет статусы в таблице <code>pricebot_tasks</code> и обновляет сообщение пользователю.</li></ul></li></ul><hr id="16f42927-0b72-81bd-82c9-d060656c42d0"/><h3 id="16f42927-0b72-8168-ba05-d7facaa94921" class="">Логика работы узла</h3><h3 id="16f42927-0b72-81cc-96be-c4f1110933e1" class="">1. Пользовательский ввод и создание задач</h3><ul id="16f42927-0b72-8182-b894-fefe28ee6a93" class="bulleted-list"><li style="list-style-type:disc"><strong>Пользователь:</strong><ul id="16f42927-0b72-811a-800e-dfe62fd72f1a" class="bulleted-list"><li style="list-style-type:circle">Нажимает кнопку <strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Прайс</a></strong> на Экране <a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">Страница детали</a> .<p id="16f42927-0b72-8177-b3da-e28da82d16b0" class="">либо</p></li></ul><ul id="16f42927-0b72-81b9-b790-e28d9dcc51df" class="bulleted-list"><li style="list-style-type:circle">Вводит <strong>партномер</strong> запрашиваемой детали (например, <code>DD81-01502A</code>).</li></ul></li></ul><ul id="16f42927-0b72-8105-a08b-e03e66fd5131" class="bulleted-list"><li style="list-style-type:disc"><strong>Телеграм-бот:</strong><ul id="16f42927-0b72-812d-95e9-f1dc62f7aebd" class="bulleted-list"><li style="list-style-type:circle">Проверяет корректность ввода (<a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">п.2.1</a>):<ul id="16f42927-0b72-8143-9f5a-ca8328cabc83" class="bulleted-list"><li style="list-style-type:square">Если поле пустое или введён некорректный партномер, бот отправляет сообщение:<em>&quot;Invalid part number. Please try again.&quot;</em></li></ul></li></ul><ul id="16f42927-0b72-81c5-b4f8-e264017dc4f6" class="bulleted-list"><li style="list-style-type:circle">Если данные корректны:<ul id="16f42927-0b72-819f-891a-e6b10001ac9f" class="bulleted-list"><li style="list-style-type:square">Извлекает список доступных магазинов для пользователя из таблицы <strong>user_shops</strong>. Учитываются только магазины со статусом <code>1</code> (активен).</li></ul><ul id="16f42927-0b72-8141-a3e7-e6d11ab660e6" class="bulleted-list"><li style="list-style-type:square">Создаёт записи в таблице <strong>pricebot_tasks</strong> для каждого активного магазина:<ul id="16f42927-0b72-8142-bf9a-db2c9f2fba77" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong> — уникальный идентификатор задачи.</li></ul><ul id="16f42927-0b72-8152-915b-efc8b602da8d" class="bulleted-list"><li style="list-style-type:disc"><strong>user_id</strong> — идентификатор пользователя.</li></ul><ul id="16f42927-0b72-8152-9777-c2f607b4ab0b" class="bulleted-list"><li style="list-style-type:disc"><strong>part_number</strong> — партномер, указанный пользователем.</li></ul><ul id="16f42927-0b72-815e-a66a-f1aeb9b5d1e7" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_id</strong> — идентификатор магазина.</li></ul><ul id="16f42927-0b72-81ac-95c8-fda39739f7b5" class="bulleted-list"><li style="list-style-type:disc"><strong>status</strong> — устанавливается как <code>пусто</code>.</li></ul><ul id="16f42927-0b72-8161-9266-fad27f859e55" class="bulleted-list"><li style="list-style-type:disc">Остальные поля оставляются пустыми.</li></ul></li></ul><ul id="16f42927-0b72-8115-b005-cbbcca2027bc" class="bulleted-list"><li style="list-style-type:square">Отправляет сообщение пользователю:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8103-98d3-f810133ae3d2" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Task in progress... Searching prices for part DD81-01502A.
</code></pre></li></ul></li></ul></li></ul><hr id="16f42927-0b72-8173-8031-f6c7d0332f77"/><h3 id="16f42927-0b72-81b8-91b1-f3f51f16fab3" class="">2. Отслеживание задач</h3><ul id="16f42927-0b72-81f0-b5b3-cfd99c1d83f6" class="bulleted-list"><li style="list-style-type:disc"><strong>Телеграм-бот:</strong><ul id="16f42927-0b72-81dd-814e-c3b60770a5ad" class="bulleted-list"><li style="list-style-type:circle">Каждые 3 секунды проверяет таблицу <strong>pricebot_tasks</strong> на предмет обновлений статусов задач:<ul id="16f42927-0b72-8152-bb7f-ec827486e562" class="bulleted-list"><li style="list-style-type:square"><strong>Статус </strong><code><strong>1</strong></code><strong> (in_progress):</strong><ul id="16f42927-0b72-811c-81c6-d07450ec171c" class="bulleted-list"><li style="list-style-type:disc">Задача в процессе обработки. Бот не обновляет сообщение.</li></ul></li></ul><ul id="16f42927-0b72-8169-93ca-e7ba5a3f5412" class="bulleted-list"><li style="list-style-type:square"><strong>Статус </strong><code><strong>2</strong></code><strong> (completed):</strong><ul id="16f42927-0b72-8114-b342-eb5aa0c3c54b" class="bulleted-list"><li style="list-style-type:disc">Задача завершена, данные собраны. Бот публикует результат и обновляет статус задачи на <code>21</code> (<em>completed_published</em>).</li></ul></li></ul><ul id="16f42927-0b72-8197-958e-d50d8a727a25" class="bulleted-list"><li style="list-style-type:square"><strong>Статус </strong><code><strong>3</strong></code><strong> (no_part):</strong><ul id="16f42927-0b72-810e-8322-fcf2f7297c0b" class="bulleted-list"><li style="list-style-type:disc">Данные по детали не найдены. Бот публикует информацию об отсутствии деталей и обновляет статус задачи на <code>31</code> (<em>no_part_published</em>).</li></ul></li></ul><ul id="16f42927-0b72-81cb-a161-ecd6e02371f0" class="bulleted-list"><li style="list-style-type:square"><strong>Статус </strong><code><strong>4</strong></code><strong> (no_response):</strong><ul id="16f42927-0b72-81ad-a32d-f8a55d3f145d" class="bulleted-list"><li style="list-style-type:disc">Сайт магазина не ответил или произошла ошибка. Бот публикует сообщение об ошибке и обновляет статус задачи на <code>41</code> (<em>no_response_published</em>).</li></ul></li></ul></li></ul></li></ul><hr id="16f42927-0b72-819e-a4bf-cef0c1a90265"/><h3 id="16f42927-0b72-814e-8dc0-f8100ebfd284" class="">3. Формирование итогового сообщения</h3><p id="16f42927-0b72-8159-966e-ea2f25d7d091" class="">Телеграм-бот формирует сообщение, состоящее из трёх блоков:</p><ol type="1" id="16f42927-0b72-8182-9792-f38f2b1a49e8" class="numbered-list" start="1"><li><strong>Блок с ценами (успешные задачи).</strong></li></ol><ul id="16f42927-0b72-8188-ad73-ff81f4f385e5" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81c1-bb5a-e7b2074d72c9" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2034.png"><img style="width:646px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2034.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8121-b248-f82cc742f51b" class=""><strong>а. Формирование строки по отдельному магазину</strong>:<div class="indented"><ul id="16f42927-0b72-81c6-9ec4-d9b5d7d4ed2a" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_name</strong> — название магазина (жирным шрифтом).</li></ul><ul id="16f42927-0b72-81ad-9635-f9ce123cf57f" class="bulleted-list"><li style="list-style-type:disc"><code>📦 $</code> — добавляется, если <strong>delivery_price</strong> из <strong>user_shops</strong> не равно нулю.</li></ul><ul id="16f42927-0b72-8110-b60d-d957067633eb" class="bulleted-list"><li style="list-style-type:disc"><strong>delivery_price</strong> — стоимость доставки.</li></ul><ul id="16f42927-0b72-813e-beb8-e6c0462eb888" class="bulleted-list"><li style="list-style-type:disc"><strong>availability</strong> — текст доступности товара.</li></ul><ul id="16f42927-0b72-810f-bdc7-d877904551a9" class="bulleted-list"><li style="list-style-type:disc"><code>All results (X)</code> — текст со ссылкой на <strong>page_link</strong> и количеством найденных позиций (<strong>X = found_parts</strong>).</li></ul><ul id="16f42927-0b72-816a-bd7e-f46069dd05d4" class="bulleted-list"><li style="list-style-type:disc"><strong>part_name</strong>, <strong>your_price </strong><mark class="highlight-red_background"><strong>(если есть)</strong></mark>, <strong>your_price_link, regular_price, regular_price_link</strong> — название детали, кликабельные цены.</li></ul><ul id="16f42927-0b72-81de-a591-f290cc80c5f4" class="bulleted-list"><li style="list-style-type:disc">Дополнительные строки: <strong>special_field_1</strong>, <strong>special_field_2</strong>, <strong>special_field_3</strong> (если заполнены).</li></ul><ul id="16f42927-0b72-81d8-8598-f45def4ba16a" class="bulleted-list"><li style="list-style-type:disc">между блоками могут быть разделители “ -&gt; ” см. <strong>Пример:</strong></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-817f-9ec8-e381ec27932f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Amresupply.com 📦 $13.99 -&gt; Special Order -&gt; A/S-HOSE DRAIN IN;F800,PP+
$140.69 (your price) / $0
</code></pre></div></p><p id="16f42927-0b72-8126-99cf-cc2bf83bbf92" class=""><strong>б. Формирование блока с сортировкой по ценам.</strong></p><p id="16f42927-0b72-81e9-9b0c-f87e0f4f4263" class="">Все строки с найденными ценами должны быть отсортированы от меньшей к большей. При добавлении новой строки в сообщение необходимо пересобрать весь блок с ценами, включая новые и ранее обработанные строки. Для этого статусы <code>2</code> (<em>completed</em>) и <code>21</code> (<em>completed_published</em>) сортируются по полю <strong>regular_price</strong>. Новые строки не добавляются в конец блока, а включаются в общий список с учётом сортировки. Таким образом, перед обновлением сообщения пересчитывается и формируется весь блок с ценами, который затем публикуется целиком (блок с ценами, а не все сообщение).</p><p id="16f42927-0b72-8121-8f0d-f4595c99900f" class="">
</p><ol type="1" id="16f42927-0b72-81ec-ab92-e035e18e44b9" class="numbered-list" start="2"><li><strong>Блок с Ошибками (нет ответа или ошибка).</strong><ul id="16f42927-0b72-814d-89d3-ce0239d76775" class="bulleted-list"><li style="list-style-type:disc">Для статуса <code>4</code>:<ul id="16f42927-0b72-81a5-abfd-ed26b8ba79df" class="bulleted-list"><li style="list-style-type:circle">Если <strong>page_link</strong> доступна:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-812c-a9a4-d0aeabefa211" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">No answer / Error
{shop_name} ({page_link})
</code></pre></li></ul><ul id="16f42927-0b72-816a-bb0b-fc235d2b6c1b" class="bulleted-list"><li style="list-style-type:circle">Если <strong>page_link</strong> отсутствует:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81b1-a0e8-d09e2a2ed323" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">No answer / Error
{shop_name}
</code></pre></li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-811d-b9bb-ce538258117c" class="numbered-list" start="3"><li><strong>Блок 3: Поиск по стокам пользователя.</strong><ul id="16f42927-0b72-816b-a9cd-f3e270909b30" class="bulleted-list"><li style="list-style-type:disc">Если деталь найдена в <strong>user_stocks</strong> или среди заменителей в <strong>parts_and_replaces</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-813a-8962-c12e436b5c9c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">✅ Parts found in: {stock_name 1}, {stock_name 2}, ...
</code></pre></li></ul><ul id="16f42927-0b72-81f0-9754-dc4efe9a7982" class="bulleted-list"><li style="list-style-type:disc">Если не найдена:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81ca-ac6e-cf627cbeed2a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">You do not have part {part_number} or replaces in your stock.
</code></pre></li></ul></li></ol><hr id="16f42927-0b72-8184-ad9a-e0671eee81c8"/><h3 id="16f42927-0b72-81a0-8191-e861c2d1be53" class="">Статусы задач в таблице <strong>pricebot_tasks</strong></h3><ul id="16f42927-0b72-8168-9048-d9d32672d882" class="bulleted-list"><li style="list-style-type:disc"><strong>Начальные статусы:</strong><ul id="16f42927-0b72-813b-9263-e914fbe88aab" class="bulleted-list"><li style="list-style-type:circle"><code>1</code> (<em>in_progress</em>) — задача в процессе выполнения.</li></ul><ul id="16f42927-0b72-8133-9717-def2629179a1" class="bulleted-list"><li style="list-style-type:circle"><code>2</code> (<em>completed</em>) — задача выполнена, данные собраны.</li></ul><ul id="16f42927-0b72-81dd-a9b6-e0c22d0ccbd0" class="bulleted-list"><li style="list-style-type:circle"><code>3</code> (<em>no_part</em>) — данные по детали не найдены.</li></ul><ul id="16f42927-0b72-8159-b32c-e58a77fcb6fc" class="bulleted-list"><li style="list-style-type:circle"><code>4</code> (<em>no_response</em>) — сайт магазина не ответил или произошла ошибка.</li></ul></li></ul><ul id="16f42927-0b72-81cf-9a4a-dba56e80cfac" class="bulleted-list"><li style="list-style-type:disc"><strong>Публикация и финальные статусы:</strong><ul id="16f42927-0b72-8146-850b-f36e36bb09bd" class="bulleted-list"><li style="list-style-type:circle"><code>21</code> (<em>completed_published</em>) — данные собраны и опубликованы.</li></ul><ul id="16f42927-0b72-81bd-826c-d153ca3e1b7f" class="bulleted-list"><li style="list-style-type:circle"><code>31</code> (<em>no_part_published</em>) — информация об отсутствии детали опубликована.</li></ul><ul id="16f42927-0b72-81c0-aea9-e83b13d84e48" class="bulleted-list"><li style="list-style-type:circle"><code>41</code> (<em>no_response_published</em>) — информация об ошибке опубликована.</li></ul></li></ul><hr id="16f42927-0b72-8166-a096-e8b0189953e7"/><h3 id="16f42927-0b72-81b8-92cd-d50403d18a45" class="">Пример сообщения</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81ae-8a94-c1a5ce80ff76" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Amresupply.com 📦 $13.99 -&gt; Special Order -&gt; A/S-HOSE DRAIN IN;F800,PP+
$140.69 (your price) / $0

Amazon.ca 🅰️ (All results) -&gt;   $82.86
10 days

Reliableparts.net 📦 $10.95 (All results) -&gt; In Stock -&gt;
A/S-HOSE DRAIN IN;F800,PP+TPE,
$91.54 (your price) / $119.0

No answer / Error
Marcone.com

You do not have part DD81-01502A or replaces in your stock

✅ Search completed
</code></pre><hr id="16f42927-0b72-81d6-a806-cdd7f57c792b"/><ul id="16f42927-0b72-811e-a110-ea0b82364bff" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background"><strong>Структура таблицы pricebot_tasks</strong></mark></mark><mark class="highlight-blue"><mark class="highlight-yellow_background">:</mark></mark></summary><ol type="1" id="16f42927-0b72-81c5-8910-c6ced3eb9038" class="numbered-list" start="1"><li><strong>id</strong> — Уникальный идентификатор задачи.</li></ol><ol type="1" id="16f42927-0b72-8108-9096-c5aafcf8aa10" class="numbered-list" start="2"><li><strong>user_id</strong> — Идентификатор пользователя.</li></ol><ol type="1" id="16f42927-0b72-8180-b823-f234ebaad3d0" class="numbered-list" start="3"><li><strong>part_number</strong> — Партномер детали.</li></ol><ol type="1" id="16f42927-0b72-8164-8078-e0dbbc699555" class="numbered-list" start="4"><li><strong>shop_id</strong> — Идентификатор магазина.</li></ol><ol type="1" id="16f42927-0b72-816c-88bf-f24df61baea0" class="numbered-list" start="5"><li><strong>status</strong> — Статус задачи (<code>1</code> — в процессе, <code>2</code> — завершена, <code>3</code> — деталь не найдена, <code>4</code> — нет ответа, <code>21</code> — завершена и опубликована, <code>31</code> — деталь не найдена и опубликована, <code>41</code> — нет ответа и опубликовано).</li></ol><ol type="1" id="16f42927-0b72-817c-a079-f1e69a53e1ce" class="numbered-list" start="6"><li><strong>page_link</strong> — Ссылка на страницу результата.</li></ol><ol type="1" id="16f42927-0b72-8114-8ee7-eac12981e229" class="numbered-list" start="7"><li><strong>found_parts</strong> — Количество найденных позиций.</li></ol><ol type="1" id="16f42927-0b72-817a-be1d-c4e57d52ae97" class="numbered-list" start="8"><li><strong>availability</strong> — Текст доступности.</li></ol><ol type="1" id="16f42927-0b72-81f8-9cb6-e077e9a178d1" class="numbered-list" start="9"><li><strong>part_name</strong> — Название детали.</li></ol><ol type="1" id="16f42927-0b72-8174-8798-febfcd045459" class="numbered-list" start="10"><li><strong>your_price</strong> — Цена со скидкой.</li></ol><ol type="1" id="16f42927-0b72-814f-bba8-d092d0da3907" class="numbered-list" start="11"><li><strong>your_price_link</strong> — Ссылка на цену со скидкой.</li></ol><ol type="1" id="16f42927-0b72-81a5-8793-f1aeb0252cad" class="numbered-list" start="12"><li><strong>regular_price</strong> — Обычная цена.</li></ol><ol type="1" id="16f42927-0b72-812c-8149-fa63d546e85c" class="numbered-list" start="13"><li><strong>regular_price_link</strong> — Ссылка на обычную цену.</li></ol><ol type="1" id="16f42927-0b72-81fb-be6c-fda7024ad7ed" class="numbered-list" start="14"><li><strong>special_field_1</strong>, <strong>special_field_2</strong>, <strong>special_field_3</strong> — Дополнительные данные.</li></ol></details></li></ul></details></li></ul><h1 id="16f42927-0b72-816c-9fbc-fe965e363c4e" class="">0. Меню бота</h1><ul id="16f42927-0b72-80d1-b9a0-cdfdfc9bda22" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание Меню бота</mark></mark></summary><p id="16f42927-0b72-813c-a623-c1cb6bb84d47" class="">Главное меню бота — это упрощённый инструмент для быстрого доступа к ключевым функциям, уже доступным в сценариях взаимодействия. Каждая функция в меню представлена в виде ярлыка, позволяющего мгновенно перейти к нужной ветке или операции, что делает использование бота удобным и гибким.</p><p id="16f42927-0b72-812c-b3c4-c413aa7454dd" class="">Некоторые функции работают по принципу прямого перехода: пользователь сразу попадает в нужный раздел сценария. Другие же сначала открывают «приветственный» экран, где пользователь может ознакомиться с кратким описанием или инструкцией. После этого пользователь переходит на  соответствующую ветку сценария.</p><ul id="16f42927-0b72-81db-9dc4-de9ae3a5edac" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81d4-8261-e9f03d7c80c3" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2035.png"><img style="width:587.9861450195312px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2035.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-81eb-ae9b-e1c3b99ef2c3" class="toggle"><li><details open=""><summary><strong>Пункты меню</strong></summary><ul id="16f42927-0b72-819c-adb1-f7fe3b783413" class="toggle"><li><details open=""><summary><strong>0.1 Diagrams&amp;manuals / 0.9 Model sticker scanner</strong></summary><ul id="16f42927-0b72-81ab-ab68-fe5062a9d50b" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин 0.1 Diagrams&amp;manuals</mark></mark></summary><figure id="16f42927-0b72-8199-9978-c7835437f72e" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2036.png"><img style="width:570px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2036.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-81c8-9b6a-e1e0f86f7e08" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин 0.9 Model sticker reader</mark></mark></summary><figure id="16f42927-0b72-81e6-bc6d-c93e39fe1371" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2037.png"><img style="width:564px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2037.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81b6-b913-e3e273b46058" class="">Эти экраны практически идентичны экрану 1.2, за исключением изменённого приветственного сообщения. В остальном полностью сохраняется вся логика 1.2, включая стандартный поиск модели и последующие переходы на страницу выдачи (1.3).</p></details></li></ul><ul id="16f42927-0b72-81b7-a78a-d5e703bfcca2" class="toggle"><li><details open=""><summary><strong>0.2 Your stocks</strong></summary><ul id="16f42927-0b72-81a4-b1bb-f0f31a6a028a" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81e4-a167-cc5a534dee86" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2038.png"><img style="width:623.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2038.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81c7-910a-f45c298a3ffa" class="">Кроме приветственного сообщения - это повтор экрана 2.1</p></details></li></ul><ul id="16f42927-0b72-8167-9c72-d81a8e3a2fa6" class="toggle"><li><details open=""><summary><strong>0.3 Stock Recount</strong></summary><ul id="16f42927-0b72-810e-8a7e-cbc8a9879313" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-811b-90f6-fdced467b43b" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2039.png"><img style="width:623.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2039.png"/></a></figure></details></li></ul><p id="16f42927-0b72-816b-b71f-c8217f25a892" class="">Это прямой переход на экран 4.1. По сути, это единственный вход на экран 4.1, так как в основных ветках сценария путь начинается с экранов 4.2 или 4.3.</p></details></li></ul><ul id="16f42927-0b72-818b-b167-d0e43bdf0c05" class="toggle"><li><details open=""><summary><strong>0.4 Prices</strong></summary><ul id="16f42927-0b72-814f-b355-cb6ead19c002" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8135-84fc-e69cf1b92466" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2040.png"><img style="width:623.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2040.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81da-a86b-e98cbeca136b" class=""><strong>Подробное </strong><strong><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">описание</a></strong></p><p id="16f42927-0b72-81e9-b7b6-d67ab0f100bd" class="">Функция <strong>Prices</strong> обычно запускается с экрана <strong>2.3 «Страница детали»</strong>, пропуская текущий шаг (<strong>0.4 Prices_Ввод партномера детали</strong>) и сразу отображая сообщение о ценах на детали.</p><p id="16f42927-0b72-81b6-accf-ff0a7d1773fc" class="">Однако пользователь может зайти в раздел <strong>Prices</strong> (этот экран) через главное меню бота и ввести партномер и получить то же сообщение о ценах.</p><p id="16f42927-0b72-81e6-b364-e5ca4574a4c1" class="">В этом случае бот:</p><ul id="16f42927-0b72-8148-a8f5-fa8fffda6ef0" class="bulleted-list"><li style="list-style-type:disc"><strong>Проверяет корректность ввода</strong> (п. 2.1). Если всё в порядке:</li></ul><ul id="16f42927-0b72-81a0-9b98-e65c25fb64ec" class="bulleted-list"><li style="list-style-type:disc"><strong>Формирует задание</strong> на поиск детали в таблице <strong>pricebot_tasks</strong>.</li></ul><ul id="16f42927-0b72-8185-a051-f2cf7d4488c8" class="bulleted-list"><li style="list-style-type:disc"><strong>Каждые 3 секунды</strong> проверяет статусы в таблице <strong>pricebot_tasks</strong> и обновляет сообщение пользователю.</li></ul></details></li></ul><ul id="16f42927-0b72-81f6-a157-deaca56218b4" class="toggle"><li><details open=""><summary><strong>0.5 Shops</strong></summary><ul id="16f42927-0b72-81c9-aa7f-f108d358cf8b" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-818f-af43-cecd923e64ba" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2041.png"><img style="width:595.9874877929688px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2041.png"/></a></figure><p id="16f42927-0b72-81ed-b3a2-c1e142e618c1" class="">
</p></details></li></ul><p id="16f42927-0b72-8112-b026-e47f739f2b8f" class="">Это раздел настроек магазинов пользователя (оригинальная страница, на ветках не повторяется). Здесь отображаются все подключенные магазины в виде инлайн-кнопок. Нажатие на магазин позволяет включать или отключать его в таблице <strong>user_shops</strong>.</p><p id="16f42927-0b72-81c8-8138-ed79d553cddd" class="">В нижней части списка всегда отображаются две дополнительные кнопки:</p><ul id="16f42927-0b72-81be-89c1-c632a530a534" class="bulleted-list"><li style="list-style-type:disc"><strong>➕ 🛒 Add new shop ➕ 🛒</strong> — переводит пользователя в отдельный чат с поддержкой для добавления нового магазина.</li></ul><ul id="16f42927-0b72-811e-9b7e-cae37b6bbc53" class="bulleted-list"><li style="list-style-type:disc"><strong>🔑 Manage Credentials 🔑</strong> — открывает тот же список магазинов, но при нажатии на магазин пользователь переходит на экран ввода учетных данных для выбранного магазина.</li></ul><ul id="16f42927-0b72-81d0-a82e-ca9019b89098" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание</mark></mark></summary><h3 id="16f42927-0b72-8134-aa65-f50de75e2489" class="">1. .<strong>Отображение списка магазинов</strong></h3><ul id="16f42927-0b72-8143-9b92-d77dd125bf67" class="bulleted-list"><li style="list-style-type:disc"><strong>Источник данных:</strong><ul id="16f42927-0b72-81bb-841e-d23900f99b7b" class="bulleted-list"><li style="list-style-type:circle"><strong>Таблица </strong><code><strong>shops</strong></code> (общий список магазинов):<ul id="16f42927-0b72-8147-9c8b-face96296e98" class="bulleted-list"><li style="list-style-type:square">Поля: <code>id</code>, <code>shop_name</code>.</li></ul></li></ul><ul id="16f42927-0b72-816e-b285-e471a2a9b535" class="bulleted-list"><li style="list-style-type:circle"><strong>Таблица </strong><code><strong>user_shops</strong></code> (связь пользователя с магазинами):<ul id="16f42927-0b72-818b-b4a4-f0e89df26faf" class="bulleted-list"><li style="list-style-type:square">Поля: <code>user_id</code>, <code>shop_id</code>, <code>status</code>.</li></ul></li></ul></li></ul><ul id="16f42927-0b72-8129-a0de-f965258aaedb" class="bulleted-list"><li style="list-style-type:disc"><strong>Логика формирования кнопок:</strong><ol type="1" id="16f42927-0b72-8179-8ea1-c4e21a5628b7" class="numbered-list" start="1"><li>Для текущего пользователя (<code>user_id</code>) выбираем все записи из таблицы <code>user_shops</code>.</li></ol><ol type="1" id="16f42927-0b72-812c-b19a-d282b790c3ca" class="numbered-list" start="2"><li>Для каждого магазина:<ul id="16f42927-0b72-81ef-8b63-f98ff76f756e" class="bulleted-list"><li style="list-style-type:disc">Показываем кнопку с названием магазина (<code>shop_name</code>) из таблицы <code>shops</code>.</li></ul><ul id="16f42927-0b72-8199-905c-cf08f5d905e3" class="bulleted-list"><li style="list-style-type:disc">Состояние кнопки зависит от поля <code>status</code>:<ul id="16f42927-0b72-81ff-978b-dd37159b7b62" class="bulleted-list"><li style="list-style-type:circle"><strong>0</strong> — Магазин не активен. Кнопка отображается с красной галкой (❌).</li></ul><ul id="16f42927-0b72-81db-a3f3-f526a7aa46ee" class="bulleted-list"><li style="list-style-type:circle"><strong>1</strong> — Магазин активен. Кнопка отображается с зеленой галкой (✅).</li></ul><ul id="16f42927-0b72-8178-a2bd-fa4d37ca6f4e" class="bulleted-list"><li style="list-style-type:circle"><strong>2</strong> — Магазин в статусе &quot;N/A&quot;. Кнопка отображается с серой галкой (➖).</li></ul></li></ul><ul id="16f42927-0b72-81c8-8eab-fb991e703df7" class="bulleted-list"><li style="list-style-type:disc">Последняя кнопка в списке: <strong>“Manage Credentials”</strong>.</li></ul></li></ol></li></ul><ul id="16f42927-0b72-8126-9bee-c21f026a45ec" class="bulleted-list"><li style="list-style-type:disc"><strong>Пример кнопок:</strong></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-81c7-bdd7-fa0dac866eac" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Amazon ✅
eBay ❌
BestBuy ➖
</code></pre><ul id="16f42927-0b72-819d-8090-d2663a136ca7" class="bulleted-list"><li style="list-style-type:disc"><strong>Действия при нажатии:</strong><ol type="1" id="16f42927-0b72-8197-82eb-cdd2a7aef780" class="numbered-list" start="1"><li>Если магазин был <strong>выключен</strong> (❌), устанавливаем <code>status = 1</code> (Активен).</li></ol><ol type="1" id="16f42927-0b72-81bc-864b-ec6abd7f986e" class="numbered-list" start="2"><li>Если магазин был <strong>включен</strong> (✅), устанавливаем <code>status = 0</code> (Не активен).</li></ol><ol type="1" id="16f42927-0b72-815e-95b2-f781c4c5189e" class="numbered-list" start="3"><li>Если магазин имеет статус <strong>2 (N/A)</strong>, действие не выполняется.</li></ol><ol type="1" id="16f42927-0b72-8156-8b9e-e173d3832663" class="numbered-list" start="4"><li>Обновляем состояние кнопки для пользователя после изменения <code>status</code>.</li></ol></li></ul><hr id="16f42927-0b72-81c3-b908-f29fffe06c5f"/><h3 id="16f42927-0b72-8130-963e-ce502a528011" class="">2. Кнопка / Список &quot;Manage Credentials&quot;</h3><p id="16f42927-0b72-8182-8813-c50fba1491d2" class="">При нажатии на эту кнопку открывается тот же список магазинов. Однако при выборе магазина мы не включаем и не отключаем его, а переходим на экран &quot;Enter Credentials”, где пользователь сможет ввести логин и пароль для выбранного магазина.</p><ul id="16f42927-0b72-81a8-b906-cf2a32ac65f6" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин:</mark></mark></summary><figure id="16f42927-0b72-8162-8d6f-f6ea319a0cc9" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2042.png"><img style="width:648px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2042.png"/></a></figure></details></li></ul><p id="16f42927-0b72-8110-861a-e4d158ec6bec" class="">
</p><hr id="16f42927-0b72-8161-972a-d3c336531361"/><h3 id="16f42927-0b72-81e0-98f2-defabd90d5ac" class="">3. Экран &quot;Enter Credentials&quot;</h3><ul id="16f42927-0b72-81c2-93de-c56fa03c3806" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин и описание:</mark></mark></summary><figure id="16f42927-0b72-81b1-8936-ceb50a797053" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2043.png"><img style="width:435.9875183105469px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2043.png"/></a></figure><p id="16f42927-0b72-812f-8ff8-e2e3135f6877" class="">На трёх экранах пользователю задаются следующие вопросы, ответы на которые записываются в таблицу <strong>user_shop_creds</strong>:</p><ol type="1" id="16f42927-0b72-8148-8647-e762d9b3b68a" class="numbered-list" start="1"><li><strong>“Enter login:”</strong><p id="16f42927-0b72-81a3-ac56-dc967c158068" class="">— записывается в поле <strong>login</strong>.</p></li></ol><ol type="1" id="16f42927-0b72-8100-955b-d8964904627b" class="numbered-list" start="2"><li><strong>“Enter password:”</strong><p id="16f42927-0b72-81f8-9d1d-e4a92d4c884e" class="">— записывается в поле <strong>password</strong>.</p></li></ol><ol type="1" id="16f42927-0b72-8112-bb4c-cf4ec8cdc169" class="numbered-list" start="3"><li><strong>“Enter PO number:”</strong><p id="16f42927-0b72-81b8-b097-d36a7709e6cc" class="">— записывается в поле <strong>po_number</strong>.</p></li></ol><p id="16f42927-0b72-8116-b3a3-dc58edb1a9b8" class="">На четвёртом экране отображается сообщение:</p><p id="16f42927-0b72-812a-b5b8-c99095bc7939" class=""><strong>“Credentials saved successfully.”</strong></p></details></li></ul><p id="16f42927-0b72-8134-bb0a-e706b62c7f8a" class="">
</p><hr id="16f42927-0b72-814a-b45d-f4adcd1576c8"/><ul id="16f42927-0b72-819d-b7c8-c0ee5065d91e" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background"><strong>4. Таблицы</strong></mark></mark></summary><h3 id="16f42927-0b72-8111-bcf6-d34bb6a49cc9" class="">Таблица <code>shops</code></h3><ul id="16f42927-0b72-81c1-8b87-ecf316ad19cc" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong> INT (PK) — Уникальный ID магазина.</li></ul><ul id="16f42927-0b72-816d-99df-d4784bc9ab9c" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_name</strong> VARCHAR — Название магазина.</li></ul><ul id="16f42927-0b72-8133-906e-f75417d7648f" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_url</strong> VARCHAR — Ссылка на магазин.</li></ul><ul id="16f42927-0b72-812e-a507-e41569a7c3f6" class="bulleted-list"><li style="list-style-type:disc"><strong>delivery_price</strong> DECIMAL — Стандартная цена доставки для магазина.</li></ul><hr id="16f42927-0b72-8197-8d5b-dbfd76db618b"/><h3 id="16f42927-0b72-81a7-8136-d4fa7e386868" class="">Таблица <code>user_shops</code></h3><ul id="16f42927-0b72-8108-ab57-cd64b6aefc0d" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong> INT (PK) — Уникальный ID записи.</li></ul><ul id="16f42927-0b72-8171-9b7c-ff498ecfba37" class="bulleted-list"><li style="list-style-type:disc"><strong>user_id</strong> INT (FK) — Идентификатор пользователя.</li></ul><ul id="16f42927-0b72-81d4-9b6f-e1f2f11c15be" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_id</strong> INT (FK) — Идентификатор магазина (ссылка на таблицу <code>shops</code>).</li></ul><ul id="16f42927-0b72-8114-bea4-d1b32a490879" class="bulleted-list"><li style="list-style-type:disc"><strong>delivery_price</strong> DECIMAL — Индивидуальная цена доставки для пользователя (перезаписывает стандартную).</li></ul><ul id="16f42927-0b72-81c0-b517-f91fa803ed75" class="bulleted-list"><li style="list-style-type:disc"><strong>status</strong> TINYINT — Статус магазина для пользователя (<code>0</code> — не активен, <code>1</code> — активен, <code>2</code> — N/A).</li></ul><hr id="16f42927-0b72-81b1-87b2-dd1471ee9377"/><h3 id="16f42927-0b72-8180-adbd-d6a4e3eff05f" class="">Таблица <code>user_shop_creds</code></h3><ul id="16f42927-0b72-8157-a056-d909fee48ac2" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong> INT (PK) — Уникальный ID записи.</li></ul><ul id="16f42927-0b72-81d0-bc79-f5de2dacbace" class="bulleted-list"><li style="list-style-type:disc"><strong>user_id</strong> INT (FK) — Идентификатор пользователя.</li></ul><ul id="16f42927-0b72-81b6-9cfc-fb551891b8ab" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_id</strong> INT (FK) — Идентификатор магазина (ссылка на таблицу <code>shops</code>).</li></ul><ul id="16f42927-0b72-8133-af27-f904706489a5" class="bulleted-list"><li style="list-style-type:disc"><strong>login</strong> VARCHAR — Логин для входа в магазин.</li></ul><ul id="16f42927-0b72-8130-9460-ed9adfa52f24" class="bulleted-list"><li style="list-style-type:disc"><strong>password</strong> VARCHAR — Пароль для входа в магазин.</li></ul><ul id="16f42927-0b72-81bf-86e6-f26d8fa16a25" class="bulleted-list"><li style="list-style-type:disc"><strong>po_number</strong> VARCHAR — PO number</li></ul><h3 id="16f42927-0b72-812c-a470-dc69dac7be95" class="">Таблица <code>pricebot_tasks</code></h3><ul id="16f42927-0b72-8134-8a7c-ee06775e193a" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong> INT (PK) — Уникальный ID задачи.</li></ul><ul id="16f42927-0b72-8171-98fd-dde8fac18929" class="bulleted-list"><li style="list-style-type:disc"><strong>user_id</strong> INT (FK) — Идентификатор пользователя.</li></ul><ul id="16f42927-0b72-8128-8a94-e514000baf15" class="bulleted-list"><li style="list-style-type:disc"><strong>part_number</strong> VARCHAR — Партномер детали.</li></ul><ul id="16f42927-0b72-81bb-9604-ce7dcdb64e2b" class="bulleted-list"><li style="list-style-type:disc"><strong>shop_id</strong> INT (FK) — Идентификатор магазина (ссылка на таблицу <code>shops</code>).</li></ul><ul id="16f42927-0b72-8171-b12c-d532df9c2958" class="bulleted-list"><li style="list-style-type:disc"><strong>status</strong> TINYINT — Статус задачи:<ul id="16f42927-0b72-8139-a80a-f9e51c17e039" class="bulleted-list"><li style="list-style-type:circle"><code>1</code> — в процессе (<em>in_progress</em>).</li></ul><ul id="16f42927-0b72-81a0-8f6e-ff42073b18ef" class="bulleted-list"><li style="list-style-type:circle"><code>2</code> — завершена (<em>completed</em>).</li></ul><ul id="16f42927-0b72-81ea-80b7-c7b2d6d0efee" class="bulleted-list"><li style="list-style-type:circle"><code>3</code> — деталь не найдена (<em>no_part</em>).</li></ul><ul id="16f42927-0b72-81ad-a5d8-e77ea18f7d3f" class="bulleted-list"><li style="list-style-type:circle"><code>4</code> — нет ответа (<em>no_response</em>).</li></ul><ul id="16f42927-0b72-8155-b0bd-fab8e8cbc17f" class="bulleted-list"><li style="list-style-type:circle"><code>21</code> — завершена и опубликована (<em>completed_published</em>).</li></ul><ul id="16f42927-0b72-816c-b5b7-faafff2548ca" class="bulleted-list"><li style="list-style-type:circle"><code>31</code> — деталь не найдена и опубликована (<em>no_part_published</em>).</li></ul><ul id="16f42927-0b72-81ea-be83-d740fec2a8dc" class="bulleted-list"><li style="list-style-type:circle"><code>41</code> — нет ответа и опубликовано (<em>no_response_published</em>).</li></ul></li></ul><ul id="16f42927-0b72-81ab-b28d-c29b73a24f68" class="bulleted-list"><li style="list-style-type:disc"><strong>page_link</strong> VARCHAR — Ссылка на страницу результата.</li></ul><ul id="16f42927-0b72-814b-abbf-c8a60d7ee9fa" class="bulleted-list"><li style="list-style-type:disc"><strong>found_parts</strong> INT — Количество найденных позиций.</li></ul><ul id="16f42927-0b72-81ce-90bf-d4057998dea0" class="bulleted-list"><li style="list-style-type:disc"><strong>availability</strong> VARCHAR — Текст доступности товара.</li></ul><ul id="16f42927-0b72-811f-9af5-d8ef2d61ea65" class="bulleted-list"><li style="list-style-type:disc"><strong>part_name</strong> VARCHAR — Название детали.</li></ul><ul id="16f42927-0b72-8185-b0b1-ee6204ea2cc7" class="bulleted-list"><li style="list-style-type:disc"><strong>your_price</strong> DECIMAL — Цена со скидкой.</li></ul><ul id="16f42927-0b72-8199-976d-ddc9200dcb2f" class="bulleted-list"><li style="list-style-type:disc"><strong>your_price_link</strong> VARCHAR — Ссылка на цену со скидкой.</li></ul><ul id="16f42927-0b72-81bf-916b-ecae647f6dd4" class="bulleted-list"><li style="list-style-type:disc"><strong>regular_price</strong> DECIMAL — Обычная цена.</li></ul><ul id="16f42927-0b72-81f1-9d69-cb3ed63af8a0" class="bulleted-list"><li style="list-style-type:disc"><strong>regular_price_link</strong> VARCHAR — Ссылка на обычную цену.</li></ul><ul id="16f42927-0b72-813d-a524-d5e41334c283" class="bulleted-list"><li style="list-style-type:disc"><strong>special_field_1</strong> VARCHAR — Дополнительная информация (например, уникальные свойства).</li></ul><ul id="16f42927-0b72-8110-870c-d0fd6bd63a2f" class="bulleted-list"><li style="list-style-type:disc"><strong>special_field_2</strong> VARCHAR — Дополнительная информация (например, складские остатки).</li></ul><ul id="16f42927-0b72-81c5-9f20-f5b9b2ca5810" class="bulleted-list"><li style="list-style-type:disc"><strong>special_field_3</strong> VARCHAR — Дополнительная информация (например, акции).</li></ul></details></li></ul><h3 id="16f42927-0b72-8199-a654-ec4b7fbded4e" class="">5. Пример UX</h3><ol type="1" id="16f42927-0b72-8147-a3c4-e62762e4953b" class="numbered-list" start="1"><li>Пользователь нажимает <strong>&quot;Shops&quot;</strong>:<ul id="16f42927-0b72-8112-a85c-cc7723559213" class="bulleted-list"><li style="list-style-type:disc">Видит список магазинов с галками (<code>✅</code> или <code>❌</code>).</li></ul><ul id="16f42927-0b72-81c9-9158-e1fe16a25fe0" class="bulleted-list"><li style="list-style-type:disc">Может включать/выключать магазины в один клик.</li></ul></li></ol><ol type="1" id="16f42927-0b72-813b-b933-ccdd4ed6f5bd" class="numbered-list" start="2"><li>Нажимает <strong>&quot;Manage Credentials&quot;</strong>:<ul id="16f42927-0b72-8137-9186-ea943ea27d8d" class="bulleted-list"><li style="list-style-type:disc">Открывается аналогичный лист с магазинами.</li></ul><ul id="16f42927-0b72-81ca-8685-e6ccbdda6e13" class="bulleted-list"><li style="list-style-type:disc">Выбирает магазин и вводит учетные данные.</li></ul></li></ol><p id="16f42927-0b72-8141-8a31-e04605292351" class="">
</p><hr id="16f42927-0b72-810a-8e54-e8b9da706a50"/><p id="16f42927-0b72-81da-8532-f7760908ef91" class="">
</p></details></li></ul></details></li></ul><ul id="16f42927-0b72-815e-b771-d5283440ecad" class="toggle"><li><details open=""><summary><strong>0.6 Parts finder / 0.8 Parts barcode reader / 0.10 Add part / 0.11 Write-off part</strong></summary><ul id="16f42927-0b72-81d2-b428-ea67038a6a45" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин 0.6 Parts finder</mark></mark></summary><figure id="16f42927-0b72-81ac-9886-d6a8436def29" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2044.png"><img style="width:536px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2044.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-81e3-baf5-f1e6ee1c8568" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин 0.8 Parts barcode reader</mark></mark></summary><figure id="16f42927-0b72-8144-99a7-fe52d157725b" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2045.png"><img style="width:876px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2045.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-81a3-bac6-d7e91bab3512" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин 0.10 Add part</mark></mark></summary><figure id="16f42927-0b72-819a-acfa-ef2a5cb41cd4" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2046.png"><img style="width:623.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2046.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-8167-849d-fe1fb7c54540" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин 0.11 Write-off part</mark></mark></summary><figure id="16f42927-0b72-81c6-a686-db6febe281d3" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2047.png"><img style="width:623.9874877929688px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2047.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81fd-88c8-cba30c81d12d" class="">Эти экраны практически идентичны экрану 2.2, за исключением изменённого приветственного сообщения. В остальном полностью сохраняется вся логика 2.2, включая стандартный поиск детали (те же варианты инпута) и последующие переходы на страницу карточки детали (2.3).</p></details></li></ul><ul id="16f42927-0b72-8132-b891-d338587c9517" class="toggle"><li><details open=""><summary><strong>0.7 Replace finder</strong></summary><ul id="16f42927-0b72-81f9-a4a0-e98676b8f442" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-815e-ab32-e35647894327" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2048.png"><img style="width:623.9937744140625px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2048.png"/></a></figure></details></li></ul><ul id="16f42927-0b72-819a-aa1f-e36361edf674" class="toggle"><li><details open=""><summary><strong>Приветсвенный экран</strong></summary><p id="16f42927-0b72-81a0-b2da-f4c6210741e2" class="">Это модификация экрана 2.2, выполняет поиск по партномеру с возможностью перехода на страницу 2.3 (страницу детали). Единственным отличием является добавление нового сообщения, в котором необходимо вывести все номера замен (replaces) в столбик. Данные берутся из таблицы parts_and_replaces, из поля replaces. При этом нужно распарсить JSON из указанного поля для формирования списка.</p></details></li></ul><ul id="16f42927-0b72-814e-b3d6-d668b64a42da" class="toggle"><li><details open=""><summary><strong>Второй экран - Страница Детали 2.3 + сообщение о реплейсах</strong></summary><p id="16f42927-0b72-817a-80c5-f2f6e98f8e14" class="">После того как пользователь ввёл партномер или отправил баркод, запрос проверяется на валидность (шаг 2.1), выполняется стандартный поиск детали (шаг 2.2), а затем отображается карточка детали, как в шаге 2.3.</p><p id="16f42927-0b72-811f-bb66-faa526c5a5ca" class="">Единственное отличие — добавлено дополнительное сообщение о заменах (replaces):</p><p id="16f42927-0b72-814c-afdb-d14db1321762" class="">Пример:</p><p id="16f42927-0b72-81f1-af4d-f39523ebc1b0" class=""><strong>Replaces:</strong></p><p id="16f42927-0b72-8194-9745-dc21fce1da9b" class="">DC97-07526B</p><p id="16f42927-0b72-8111-84d5-d91546fbc0d7" class="">DC97-07526E</p><p id="16f42927-0b72-81a0-94d0-d5893f1c7675" class="">DC97-18962A</p><p id="16f42927-0b72-8150-bb37-f011ac27724d" class=""><strong>Как получили:</strong></p><ol type="1" id="16f42927-0b72-816a-89c2-e40535e3018a" class="numbered-list" start="1"><li>Пользователь ввёл партномер, например, <code>DC97-07526A</code>.</li></ol><ol type="1" id="16f42927-0b72-81b2-aebf-f28e3037ad3e" class="numbered-list" start="2"><li>Из таблицы <strong>parts_and_replaces</strong> извлекли поле <strong>replaces</strong>, содержащее JSON, например:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8128-8132-ea2a037f762a" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">[&quot;DC97-07526B&quot;, &quot;DC97-07526E&quot;, &quot;DC97-18962A&quot;]
</code></pre></li></ol><ol type="1" id="16f42927-0b72-81bd-b593-cc6d5cbca8b4" class="numbered-list" start="3"><li>Распарсили JSON в массив и отформатировали данные в список по строкам.</li></ol><ol type="1" id="16f42927-0b72-8115-a40c-fffe9894f7a4" class="numbered-list" start="4"><li>Сформированное сообщение отправили пользователю.</li></ol></details></li></ul><p id="16f42927-0b72-8140-8c2a-d1f1e96043f3" class="">
</p></details></li></ul><ul id="16f42927-0b72-8152-93b1-eeb6df6bb2f4" class="toggle"><li><details open=""><summary><strong>0.12 Help &amp; Support</strong></summary><p id="16f42927-0b72-8100-92aa-c4d2e8e2b126" class="">Переход в чат поддержки</p></details></li></ul><p id="16f42927-0b72-8182-a7db-eaa4aba55e1f" class="">
</p><p id="16f42927-0b72-815b-beb6-f27dd0469b12" class="">
</p><p id="16f42927-0b72-81b5-9537-ec57f8fad125" class="">
</p><p id="16f42927-0b72-81a2-9443-f51d708a636b" class="">
</p><hr id="16f42927-0b72-8167-b23a-fb2d4fdccf44"/><ul id="16f42927-0b72-81c7-af4c-e3fdf3e20eb1" class="toggle"><li><details open=""><summary><strong>Вывод информации о детали из таблицы Parts_and_Replaces</strong></summary><p id="16f42927-0b72-81a3-b5a7-d98930b353e8" class=""><strong>Parts_and_Replaces</strong> – это основная база данных по деталям.</p><ul id="16f42927-0b72-81d5-a117-c30a8ec65f72" class="bulleted-list"><li style="list-style-type:disc"><strong>replaces</strong> – JSON-массив, содержащий все партномера, связанные с конкретной деталью. Используется для работы с информацией о партномерах.</li></ul><ul id="16f42927-0b72-81cb-875c-e76054a90217" class="bulleted-list"><li style="list-style-type:disc"><strong>part_name</strong> – название детали. Если поле пустое, выводится “N/A”.</li></ul><ul id="16f42927-0b72-81ff-bae5-c5a70c38e939" class="bulleted-list"><li style="list-style-type:disc"><strong>brand</strong> – бренд детали.</li></ul><ul id="16f42927-0b72-810f-9f98-dfa13baf44fb" class="bulleted-list"><li style="list-style-type:disc"><strong>main_part_number</strong> – основной партномер, с которого начинается добавление детали в базу и поиск информации. Он всегда содержится в поле <code>replaces</code> и используется только один раз для начального поиска.</li></ul><ul id="16f42927-0b72-81a0-bd0f-d8624e208aa6" class="bulleted-list"><li style="list-style-type:disc"><strong>pic</strong> – путь к изображению детали. Если поле пустое, выводится “NO_IMAGE_AVAILABLE.png” (<a href="https://disk.yandex.ru/i/30Bxcw_9GfH5dw">ссылка</a>).</li></ul><ul id="16f42927-0b72-81e2-bcbd-e19c43349396" class="bulleted-list"><li style="list-style-type:disc"><strong>pic_link</strong> – ссылка на изображение детали (если доступно).</li></ul><p id="16f42927-0b72-81b4-81b2-c71c07ff66b1" class=""><strong>Вывод информации осуществляется только если статус в Parts_and_Replaces равен 2.</strong></p><p id="16f42927-0b72-81ad-9ad7-f10fa5676ee1" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><strong>Пример***:</strong></mark></mark></p></details></li></ul><p id="16f42927-0b72-8149-841b-cc71f81181e9" class="">
</p></details></li></ul></details></li></ul><h1 id="16f42927-0b72-81ae-9c3a-f764ae4b054e" class=""><strong>Стандартные элементы на всех экранах.</strong></h1><ul id="16f42927-0b72-81e4-9fbb-fbcdf26621a7" class="toggle"><li><details open=""><summary>Инлайн кнопка <strong>“Return to menu ↩️”</strong> </summary><ul id="16f42927-0b72-81e7-8b79-e9a6fbab9326" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8169-950b-d9b255bfd35a" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2049.png"><img style="width:2016px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2049.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81a3-a565-c3aec304d258" class="">Возвращает пользователя на первый экран <mark class="highlight-red_background"><strong>текущей</strong></mark> ветки:</p><ul id="16f42927-0b72-8137-a0ed-de355c75a6ca" class="bulleted-list"><li style="list-style-type:disc">Для ветки <strong>Find Model</strong> — экран &quot;1. Find Model&quot;.</li></ul><ul id="16f42927-0b72-81f8-80a1-f929713462e2" class="bulleted-list"><li style="list-style-type:disc">Для веток <strong>Find Part и Manage Stocks</strong> — экран &quot;2. Find Part&quot;.</li></ul></details></li></ul><ul id="16f42927-0b72-81f2-a411-edcb5d15c097" class="toggle"><li><details open=""><summary><strong>Логгирование последнего действия пользователя и кнопка “🛠️️ Support ticket 🛠️”</strong></summary><ul id="16f42927-0b72-81a1-a171-e1e37b6012c5" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8195-8638-efe62daa5067" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2050.png"><img style="width:554px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2050.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81f8-8447-d70c306e97ad" class=""><mark class="highlight-blue"><mark class="highlight-yellow_background"><a href="https://www.notion.so/16b429270b7280b08ea6eae1e0d1f4de?pvs=21">Таблицы</a></mark></mark></p><p id="16f42927-0b72-8170-9ff2-edef2438c1ad" class="">Задача - обеспечить сохранение полного контекста действий пользователя на текущем экране, включая его запрос, ответ бота, список инлайн-кнопок (включая их ссылки), а также связанных данных из других таблиц. Только пользователь нажал на кнопку  - данные СРАЗУ сохраняются. Далее пользователь может добавить комментарий, но данные о сессии уже будут сохранены в таблицу <code>issues</code></p><p id="16f42927-0b72-8179-bf36-c5f0ebde79fa" class="">
</p><h3 id="16f42927-0b72-81fe-832c-c3ec209c18a4" class=""><strong>Механика работы кнопки &quot;Support ticket&quot;</strong></h3><h3 id="16f42927-0b72-8164-aa48-c107ff22673e" class=""><strong>1. Регулярная работа бота</strong></h3><p id="16f42927-0b72-81fe-89e9-e5589285bd2b" class="">При любом действии пользователя (ввод текста, нажатие кнопки):</p><ul id="16f42927-0b72-81bb-89d6-f371886d270c" class="bulleted-list"><li style="list-style-type:disc">Данные сохраняются в таблицу <code>current_user_session</code>:<ul id="16f42927-0b72-8191-b5be-c88ff9c9407c" class="bulleted-list"><li style="list-style-type:circle"><code><strong>id</strong></code> — Уникальный идентификатор записи.</li></ul><ul id="16f42927-0b72-8125-aea8-c53c5dd86436" class="bulleted-list"><li style="list-style-type:circle"><code><strong>user_id</strong></code> — Идентификатор пользователя.</li></ul><ul id="16f42927-0b72-81e5-bdac-ecb777225b08" class="bulleted-list"><li style="list-style-type:circle"><code><strong>timestamp</strong></code> — Время действия.</li></ul><ul id="16f42927-0b72-8175-a603-eb68b0cbdc73" class="bulleted-list"><li style="list-style-type:circle"><code><strong>screen_name</strong></code> — Название текущего экрана (номер шага/экрана в этом ТЗ).</li></ul><ul id="16f42927-0b72-8191-8c57-c17671b21f25" class="bulleted-list"><li style="list-style-type:circle"><code><strong>user_input</strong></code> — Текст запроса или путь к файлу (если это изображение).</li></ul><ul id="16f42927-0b72-813d-b9d6-f889a6fd7ed2" class="bulleted-list"><li style="list-style-type:circle"><code><strong>bot_response</strong></code> — Текст ответа бота.</li></ul><ul id="16f42927-0b72-814c-aa72-c98723fa8f5a" class="bulleted-list"><li style="list-style-type:circle"><code><strong>buttons</strong></code> — JSON-строка с текстами и ссылками инлайн-кнопок.</li></ul><ul id="16f42927-0b72-8113-8761-dcf975e69dfe" class="bulleted-list"><li style="list-style-type:circle"><code><strong>job_id</strong></code> — Идентификатор текущей работы (если применимо).</li></ul></li></ul><hr id="16f42927-0b72-8129-9b60-d04f9e46e51f"/><h3 id="16f42927-0b72-8184-bd82-e8c854f35a9d" class=""><strong>2. При нажатии кнопки &quot;Support ticket&quot;</strong></h3><ol type="1" id="16f42927-0b72-81a4-9af0-e7942579ba1f" class="numbered-list" start="1"><li><strong>Создание записи о проблеме:</strong><ul id="16f42927-0b72-819a-8079-d4dadb1b431c" class="bulleted-list"><li style="list-style-type:disc">Данные из <code>current_user_session</code> копируются в таблицу <code>issues</code>:<ul id="16f42927-0b72-8120-a9de-ee7d44679348" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_id</strong></code> — Уникальный идентификатор проблемы (создается автоматически).</li></ul><ul id="16f42927-0b72-8149-bbfb-c5c14960a0da" class="bulleted-list"><li style="list-style-type:circle"><code><strong>user_id</strong></code> — Идентификатор пользователя.</li></ul><ul id="16f42927-0b72-81d5-b01c-e7936edc603a" class="bulleted-list"><li style="list-style-type:circle"><code><strong>timestamp</strong></code> — Время создания проблемы.</li></ul><ul id="16f42927-0b72-81a7-8ad2-d351b497be23" class="bulleted-list"><li style="list-style-type:circle"><code><strong>job_id</strong></code> — Идентификатор текущей работы (если применимо).</li></ul><ul id="16f42927-0b72-8175-aaa6-f1dd06e467b9" class="bulleted-list"><li style="list-style-type:circle"><code><strong>screen_name</strong></code> — Экран, на котором была нажата кнопка.</li></ul></li></ul><ul id="16f42927-0b72-810c-9831-cb9f3ef8a7a8" class="bulleted-list"><li style="list-style-type:disc">Дополнительно записываются текст запроса, ответ бота и список инлайн-кнопок.</li></ul></li></ol><ol type="1" id="16f42927-0b72-811d-be5f-e71c7d89118c" class="numbered-list" start="2"><li><strong>Дублирование данных в связанные таблицы:</strong><ul id="16f42927-0b72-8149-a0d3-eb998d3e8f16" class="bulleted-list"><li style="list-style-type:disc">На основе текущего <strong>job_id</strong> создаются копии данных из связанных таблиц:<ul id="16f42927-0b72-81ea-8056-d31590ec479b" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_job_docs</strong></code> — копия данных из <code><strong>job_docs</strong></code>.</li></ul><ul id="16f42927-0b72-81bf-9e6d-e0dcb7119fc1" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_job_docs_info</strong></code> — копия данных из <code><strong>job_docs_info</strong></code>.</li></ul><ul id="16f42927-0b72-81ac-ae9c-c4e3b1ebe07b" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_job_stocks</strong></code> — копия данных из <code><strong>job_stocks</strong></code>.</li></ul><ul id="16f42927-0b72-8103-a1b3-c4a9867eccaf" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_Responses</strong></code> — копия данных из <code><strong>Responses</strong></code>.</li></ul><ul id="16f42927-0b72-8189-93b9-ddf096c4dd87" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_model_numbers</strong></code> — копия данных из <code><strong>models_numbers</strong></code>.</li></ul><ul id="16f42927-0b72-81e7-b377-c9db6a04b150" class="bulleted-list"><li style="list-style-type:circle"><code><strong>issue_model_numbers_not_found</strong></code> — копия данных из <code><strong>models_numbers_not_found</strong></code>.</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-8143-8644-cff78d124c2d" class="numbered-list" start="3"><li><strong>Переход на страницу ввода комментария:</strong><ul id="16f42927-0b72-810f-ac95-ce3c9038a963" class="bulleted-list"><li style="list-style-type:disc">Пользователь перенаправляется на экран для добавления текста или голосового сообщения.</li></ul><ul id="16f42927-0b72-8187-a045-cd1e387ac82f" class="bulleted-list"><li style="list-style-type:disc">Текущий <code><strong>issue_id</strong></code> сохраняется и связывается с пользователем.</li></ul></li></ol><ol type="1" id="16f42927-0b72-811a-a502-e2f03c236421" class="numbered-list" start="4"><li><strong>Обработка комментариев:</strong><ul id="16f42927-0b72-813d-a6d6-c4f4045d9b7e" class="bulleted-list"><li style="list-style-type:disc"><strong>Ввод текста:</strong><ul id="16f42927-0b72-81ef-bd56-f0827ac7d869" class="bulleted-list"><li style="list-style-type:circle">Текст записывается в таблицу <code>issues</code> в поле <code><strong>description</strong></code>.</li></ul></li></ul><ul id="16f42927-0b72-8192-86ca-c578279de78a" class="bulleted-list"><li style="list-style-type:disc"><strong>Отправка голосового сообщения:</strong><ul id="16f42927-0b72-81a0-8791-d68d26282201" class="bulleted-list"><li style="list-style-type:circle">Сообщение сохраняется:<ul id="16f42927-0b72-81e5-8f99-db44825ad61f" class="bulleted-list"><li style="list-style-type:square"><strong>На диск:</strong> файл размещается в папке <code>[путь к папке users]/[user_id]/issues/[issue_id]</code>.</li></ul><ul id="16f42927-0b72-8195-a944-e341af0dcc34" class="bulleted-list"><li style="list-style-type:square"><strong>В БД:</strong> записываются:<ul id="16f42927-0b72-81b1-a759-fa804b81f44e" class="bulleted-list"><li style="list-style-type:disc"><code><strong>file_path</strong></code> — полный путь к сохраненному файлу.</li></ul><ul id="16f42927-0b72-81b3-b5da-f4194dcaa754" class="bulleted-list"><li style="list-style-type:disc"><code><strong>file_type</strong></code> — значение <code>&quot;audio&quot;</code>.</li></ul></li></ul></li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-8179-aa66-d79b952581d2" class="numbered-list" start="5"><li><strong>Сохранение данных при отсутствии комментария:</strong><ul id="16f42927-0b72-81c8-b438-f2ddbf375609" class="bulleted-list"><li style="list-style-type:disc">Если комментарий не добавлен, данные сохраняются как есть.</li></ul></li></ol><hr id="16f42927-0b72-81d5-951a-e9ad8085cf40"/><h3 id="16f42927-0b72-812c-9d8c-e382625822df" class=""><strong>3. После отправки комментария</strong></h3><ul id="16f42927-0b72-818c-83a5-df8223ca6502" class="bulleted-list"><li style="list-style-type:disc">Пользователю отправляется сообщение:<strong>&quot;Got it! 🛠️&quot;</strong><em>&quot;We’ve updated your ticket. You can return to your tasks.&quot;</em></li></ul><ul id="16f42927-0b72-8142-b5ef-ddffca2a6caf" class="bulleted-list"><li style="list-style-type:disc">Пользователь остается на текущем экране.</li></ul><hr id="16f42927-0b72-814a-abad-f37ca3baf3dc"/><h3 id="16f42927-0b72-81be-a2ee-d778ca584b6e" class=""><strong>4. При следующем действии пользователя</strong></h3><ul id="16f42927-0b72-8117-8ce3-eca9d2ff3338" class="bulleted-list"><li style="list-style-type:disc">Таблица <code>current_user_session</code> очищается.</li></ul><ul id="16f42927-0b72-8152-a201-c37db8057397" class="bulleted-list"><li style="list-style-type:disc">Новое действие пользователя записывается в таблицу заново.</li></ul></details></li></ul><ul id="16f42927-0b72-80e8-92f9-ef90518547d6" class="toggle"><li><details open=""><summary><strong>Правила поиска по спискам деталей</strong></summary><p id="16f42927-0b72-80b1-85be-f9a888f43d13" class="">В нашей системе поиск деталей организован так, чтобы учитывать специфику взаимозаменяемых партномеров (реплейсов). Для этого используется таблица <strong>Parts_and_Replaces</strong> (ПиР), которая содержит полные данные о реплейсах для каждой детали. Ключевая идея — мы ищем соответствие запроса в данных таблицы <strong>Parts_and_Replaces</strong>, а не в таблице <strong>User_Stocks</strong> напрямую.</p><hr id="16f42927-0b72-8019-9cef-db78d19d2366"/><h3 id="16f42927-0b72-80b6-992a-c8b1be60eb06" class="">Проблема простого поиска</h3><p id="16f42927-0b72-8083-8da0-cfea4bb3c562" class="">Предположим, нам нужно проверить, есть ли деталь <strong>W10192966</strong> в списке стока пользователя, который хранится в таблице <strong>User_Stocks</strong>. В этой таблице есть поле <strong>PartNumber</strong>, но поиск напрямую по нему невозможен.</p><p id="16f42927-0b72-8016-a365-f2ed5d8a07b2" class="">Одна и та же деталь может быть записана под разными партномерами, называемыми реплейсами. Например, для партномера <strong>W10192966</strong> существуют следующие реплейсы:</p><ul id="16f42927-0b72-80fb-8552-c632de619374" class="bulleted-list"><li style="list-style-type:disc"><strong>AP6016656</strong></li></ul><ul id="16f42927-0b72-8074-8bd6-de2474da5db5" class="bulleted-list"><li style="list-style-type:disc"><strong>WPW10192966</strong></li></ul><ul id="16f42927-0b72-8048-8c6b-f3d540c7add8" class="bulleted-list"><li style="list-style-type:disc"><strong>AH11749949</strong></li></ul><ul id="16f42927-0b72-800c-9f41-c501d803432b" class="bulleted-list"><li style="list-style-type:disc"><strong>EA11749949</strong></li></ul><p id="16f42927-0b72-80f3-a9fd-e9052b8a10dc" class="">В таблице <strong>User_Stocks</strong> может быть сохранена деталь под любым из этих номеров. Простая проверка по полю <strong>PartNumber</strong> не даст результата, если запись использует другой реплейс.</p><hr id="16f42927-0b72-805e-bcfc-c4c8d7f2108e"/><h3 id="16f42927-0b72-803e-b984-ffb4d0f4f16b" class="">Решение: Поиск через таблицу <strong>Parts_and_Replaces</strong></h3><p id="16f42927-0b72-80f8-b66b-cdf082267346" class="">Для точного поиска используется связь таблицы <strong>User_Stocks</strong> с таблицей <strong>Parts_and_Replaces</strong>. Каждая запись в <strong>User_Stocks</strong> имеет поле <strong>Parts_and_Replaces_id</strong>, которое указывает на соответствующую запись в ПиР.</p><hr id="16f42927-0b72-8090-ba51-d4193dc7b920"/><h3 id="16f42927-0b72-8002-8da3-de28a886fa16" class="">Алгоритм поиска</h3><ol type="1" id="16f42927-0b72-80d3-95e3-c0f35b60804b" class="numbered-list" start="1"><li><strong>Получение записей из User_Stocks:</strong><ul id="16f42927-0b72-80db-a280-f9135bd6311a" class="bulleted-list"><li style="list-style-type:disc">Из таблицы <strong>User_Stocks</strong> извлекаются все значения поля <strong>Parts_and_Replaces_id</strong>, которые связаны с пользователем.</li></ul></li></ol><ol type="1" id="16f42927-0b72-80d0-a032-d9dde3086938" class="numbered-list" start="2"><li><strong>Переход к таблице ПиР:</strong><ul id="16f42927-0b72-8010-a9fc-eb9e629e475f" class="bulleted-list"><li style="list-style-type:disc">Используем полученные <strong>Parts_and_Replaces_id</strong> для выборки из таблицы <strong>Parts_and_Replaces</strong>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-80be-8521-d7e5155070f5" class="numbered-list" start="3"><li><strong>Поиск в реплейсах:</strong><ul id="16f42927-0b72-8099-b0f9-c1462a2abbcb" class="bulleted-list"><li style="list-style-type:disc">Проверяем наличие запроса (например, <strong>W10192966</strong>) в JSON-массиве поля <strong>Replaces</strong> таблицы <strong>Parts_and_Replaces</strong>.</li></ul></li></ol><ol type="1" id="16f42927-0b72-80c3-9183-d92dd1fd42a5" class="numbered-list" start="4"><li><strong>Возврат результата:</strong><ul id="16f42927-0b72-8015-a54c-c4a9e307520f" class="bulleted-list"><li style="list-style-type:disc">Если запрос найден в массиве <strong>Replaces</strong>, считаем, что деталь существует в стоке пользователя.</li></ul><ul id="16f42927-0b72-801b-912b-e42399e4badd" class="bulleted-list"><li style="list-style-type:disc">Если нет — детали в стоке нет.</li></ul></li></ol><p id="16f42927-0b72-80e3-bcb6-c2373f4e11f0" class="">
</p><p id="16f42927-0b72-80e9-bbef-ff2a32d48718" class=""><mark class="highlight-yellow_background"><strong>Универсальное правило поиска деталей</strong></mark></p><p id="16f42927-0b72-8077-97ca-fd526476cc2f" class=""><mark class="highlight-yellow_background">Этот подход применяется для всех операций поиска деталей по любым спискам в системе. Все таблицы, содержащие партномера, имеют поле </mark><mark class="highlight-yellow_background"><strong>Parts_and_Replaces_id</strong></mark><mark class="highlight-yellow_background">, которое связывает их с таблицей </mark><mark class="highlight-yellow_background"><strong>Parts_and_Replaces</strong></mark><mark class="highlight-yellow_background">.</mark></p><p id="16f42927-0b72-8087-a0ef-d9c07e4b08b6" class=""><mark class="highlight-yellow_background">Независимо от значения, записанного в поле </mark><mark class="highlight-yellow_background"><strong>PartNumber</strong></mark><mark class="highlight-yellow_background"> исходной таблицы, поиск выполняется только по полю </mark><mark class="highlight-yellow_background"><strong>Replaces</strong></mark><mark class="highlight-yellow_background"> в таблице </mark><mark class="highlight-yellow_background"><strong>Parts_and_Replaces</strong></mark><mark class="highlight-yellow_background">, связанному через </mark><mark class="highlight-yellow_background"><strong>Parts_and_Replaces_id</strong></mark><mark class="highlight-yellow_background">. Это обеспечивает точность и универсальность поиска, исключая зависимость от конкретного партномера в исходных данных.</mark></p></details></li></ul><ul id="16f42927-0b72-8102-acaa-e5600f9ffd31" class="toggle"><li><details open=""><summary><mark class="highlight-teal_background"><strong>1.5 Универсальные Правила построения  “Списка деталей”</strong></mark></summary><p id="16f42927-0b72-815b-9c1e-cbcb74d2426b" class=""><div class="indented"><ul id="16f42927-0b72-8111-ba79-fde99cd4ef95" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-815b-8135-c3d8ec45dc3a" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2051.png"><img style="width:519.984375px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2051.png"/></a></figure></details></li></ul><p id="16f42927-0b72-81c5-9e79-dae66cd39e17" class="">В данном боте используется единый формат отображения списка деталей.</p><p id="16f42927-0b72-815f-a92e-d4f98544423a" class="">Скрипт формирует список деталей на основе данных из одной из входных таблиц(в зависимости это места в сценарии). Каждая деталь представлена в виде карточки с изображением, названием и дополнительной информацией. Основные данные берутся из таблицы<code>parts_and_replaces</code> (наша база данных по запчастям). При отсутствии связи с этой таблицей или пустых полей используются заглушки: вместо имени — N/A, вместо изображения — стандартная картинка-заглушка.</p><p id="16f42927-0b72-81f0-897a-dcd5f3aea75f" class="">Цель этих правил — обеспечить единый подход для формирования списка деталей на основе входного списка партномеров (Входной таблицы).</p><h3 id="16f42927-0b72-813e-abdc-f85dfd1a6df8" class="">Источники данных</h3><p id="16f42927-0b72-8167-a7c8-cdaf589a41a0" class="">Список деталей формируется из следующих Входных таблиц:</p><p id="16f42927-0b72-813b-8d13-c9cc72b2a9cf" class=""><strong>1. Таблица job_stocks</strong></p><p id="16f42927-0b72-8154-9eba-c9eace984bf7" class="">Выборка деталей для конкретного задания по <code>job_id</code> (см. раздел 1.4.1 Action with parts).<br/>Используем поле <br/><code>user_stock_id</code>, чтобы получить:</p><ul id="16f42927-0b72-8128-8c37-ed32c9c8fb64" class="bulleted-list"><li style="list-style-type:disc">Партномер (<code>part_number</code>)</li></ul><ul id="16f42927-0b72-8112-a5a5-f7eb66d4b93e" class="bulleted-list"><li style="list-style-type:disc">Картинку и название детали через <code>parts_and_replaces_id</code> (из таблицы <code>parts_and_replaces</code>)</li></ul><ul id="16f42927-0b72-81f1-b1f5-e9ad4c7b168d" class="bulleted-list"><li style="list-style-type:disc">Название стока через <code>stock_id</code> (из таблицы <code>stock_creds</code>)</li></ul><ul id="16f42927-0b72-8168-aff3-fc6bf2755f1b" class="bulleted-list"><li style="list-style-type:disc">Статус</li></ul><p id="16f42927-0b72-815a-bd68-cf55e09850eb" class=""><strong>2. Список Common parts</strong></p><p id="16f42927-0b72-819a-8214-de60833774d3" class="">Пока не реализован. Для этого варианта используются заглушки.</p><p id="16f42927-0b72-815d-a5e2-dce91bf465af" class=""><strong>3. Таблица user_stocks</strong></p><p id="16f42927-0b72-8179-82c5-f80c96b2a86f" class="">Используем поле <code>part_number</code> (партномер).<br/>Остальные данные аналогичны таблице <br/><code>job_stocks</code>, но извлекаются по <code>stock_id</code>, а не по <code>job_id</code>.</p><p id="16f42927-0b72-815b-a15d-f78ef7eb1c87" class=""><strong>4. Таблица Stock_Recount</strong></p><p id="16f42927-0b72-8172-ad34-f435cee8b0e5" class="">Используем поле <code>recognized_part_number</code> (партномер).<br/>Остальные данные аналогичны таблице <br/><code>job_stocks</code>, но извлекаются по <code>stock_id</code>.</p><h3 id="16f42927-0b72-81d8-8141-c91a2871f0c3" class="">Формат карточки детали</h3><p id="16f42927-0b72-81c0-9116-fb5d2fc1b671" class="">Каждая деталь в списке представлена в следующем формате:</p><p id="16f42927-0b72-81fe-8a1d-d33259cfe646" class="">Справа {картинка} - слева текстовый блок:</p><ol type="1" id="16f42927-0b72-81cc-8202-e32bb14c431e" class="numbered-list" start="1"><li>Первая строка: {партномер} / {название детали}</li></ol><ol type="1" id="16f42927-0b72-81c1-9981-c0217c21907a" class="numbered-list" start="2"><li>Вторая строка (опционально): {имя стока (stock_name)}</li></ol><ol type="1" id="16f42927-0b72-811a-86e3-f85be99843b2" class="numbered-list" start="3"><li>Третья строка (опционально): {Status}</li></ol><ol type="1" id="16f42927-0b72-8121-b122-c119c5e1fa2d" class="numbered-list" start="4"><li>Четвертая строка (опционально): Comment: {comment}</li></ol><ul id="16f42927-0b72-814a-87c9-f4a5b7dac167" class="toggle"><li><details open=""><summary><strong>Пример карточки:</strong></summary><figure id="16f42927-0b72-8123-9db7-ef8d0fbf2433" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2052.png"><img style="width:498px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2052.png"/></a></figure></details></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="16f42927-0b72-8125-8000-ecd2598f61f8" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">DC31-00187A / Washer Drain Pump
Truck stock
Status: Error
Comment: Used
</code></pre><h3 id="16f42927-0b72-81dd-9a91-c463013e2835" class="">Поля для формирования списка</h3><ul id="16f42927-0b72-8132-bb10-eb955b1813c9" class="bulleted-list"><li style="list-style-type:disc"><strong>{Картинка}</strong>: поле <code>pic</code> из таблицы <code>parts_and_replaces</code></li></ul><ul id="16f42927-0b72-81bd-9693-e348ce111806" class="bulleted-list"><li style="list-style-type:disc"><strong>{Партномер}</strong>: из Входной таблицы</li></ul><ul id="16f42927-0b72-8100-9c82-d3112993efde" class="bulleted-list"><li style="list-style-type:disc"><strong>{Название детали}</strong>: поле <code>part_name</code> из таблицы <code>parts_and_replaces</code></li></ul><ul id="16f42927-0b72-81ec-b5c7-f61d3a73a66d" class="bulleted-list"><li style="list-style-type:disc"><strong>{Имя стока}</strong>: поле <code>stock_name</code> из таблицы <code>stock_creds</code>. Может отсутствовать</li></ul><ul id="16f42927-0b72-8120-bf56-dcf52284d521" class="bulleted-list"><li style="list-style-type:disc"><strong>{Статус}</strong>: преобразованный статус из входных таблиц</li></ul><ul id="16f42927-0b72-8165-8757-e3bd9a01e64b" class="bulleted-list"><li style="list-style-type:disc"><strong>{Комментарий}</strong>: опциональное поле из таблицы <code>user_stocks</code></li></ul><h3 id="16f42927-0b72-81f3-9738-d6ffce0ba0f2" class="">Статусы из входных таблиц</h3><p id="16f42927-0b72-8160-9988-f5ee18bfc4bb" class=""><strong>Parts in Progress, любой из:</strong></p><ul id="16f42927-0b72-8186-8fea-e7db76ceaf94" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-default"><code>0 (New)</code></mark> — Новая запись(спец_запрос).</li></ul><ul id="16f42927-0b72-81ee-8a90-e55b3af47325" class="bulleted-list"><li style="list-style-type:disc">1 (New) — Новая запись</li></ul><ul id="16f42927-0b72-8134-9005-d6840f4cd7a7" class="bulleted-list"><li style="list-style-type:disc">2 (Partnumber_Validated) — Баркод распознан, но поиск в базе не завершен</li></ul><ul id="16f42927-0b72-81fe-98bc-e0de2871e503" class="bulleted-list"><li style="list-style-type:disc">5 (Not Found in Database) — Не найдено в базе данных</li></ul><p id="16f42927-0b72-8198-9073-eb2cfc9421a6" class=""><strong>Parts recognized:</strong></p><ul id="16f42927-0b72-8118-8d50-e4fb0cf42376" class="bulleted-list"><li style="list-style-type:disc">4 (Database Match) — Найдено в базе данных</li></ul><ul id="16f42927-0b72-814a-bf52-fa723ba72137" class="bulleted-list"><li style="list-style-type:disc">6 (Online Match) — Найдено в интернете</li></ul><p id="16f42927-0b72-81b7-bc01-f5dd18907609" class=""><strong>Parts not recognized:</strong></p><ul id="16f42927-0b72-817f-a9e2-f91b4082e962" class="bulleted-list"><li style="list-style-type:disc">7 (Not Found Online) — Не найдено в интернете</li></ul><p id="16f42927-0b72-81df-8af2-c0639bed532f" class=""><strong>Errors: (отображаются красным)</strong></p><ul id="16f42927-0b72-8172-95b4-e198b94e39bd" class="bulleted-list"><li style="list-style-type:disc">3 (Barcode Not Recognized) — Баркод не распознан</li></ul><p id="16f42927-0b72-8168-88c8-d5dc03adccaa" class="">
</p><h3 id="16f42927-0b72-8178-b3bc-ce9cab746703" class="">Клик на блок с деталью </h3><p id="16f42927-0b72-8195-ac04-f9bf6deb97d4" class="">При клике на деталь переходим в <mark class="highlight-red_background"><a href="https://www.notion.so/_Main-16f429270b7280e89dcacea862fc8a1a?pvs=21">&quot;2.3 Страница Детали&quot;.</a></mark></p><h3 id="16f42927-0b72-8141-8e80-e50f0f892799" class="">Дополнительные возможности</h3><p id="16f42927-0b72-81c6-b208-dfebd2b886bb" class="">Редактирование партномеров: в некоторых списках есть возможность изменять партномера входного списка. Для таких списков внизу отображается блок Edit. При нажатии переходим на “1.5.1 Страница Редактирования списка” - выводим тот же список, но теперь по клику на деталь попадаем на экран, где пользователь может ввести партномер и он будет заменен во Входной Таблице (Например в таблицах <code>user_stocks</code> или <code>Stock_Recount</code>).</p><p id="16f42927-0b72-81da-905f-e38297d29659" class="">
</p><ul id="16f42927-0b72-810a-ba32-cf01d2413007" class="toggle"><li><details open=""><summary><strong>1.51 Страница “Редактирования списка”.</strong></summary><ul id="16f42927-0b72-81ec-813d-e7a35d40d731" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-81cc-a0e7-c68430a07bb6" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2053.png"><img style="width:2830px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2053.png"/></a></figure></details></li></ul><p id="16f42927-0b72-816b-b384-e0d25f4c6405" class="">Собираем и отображаем тот же список, но при клике на деталь пользователь переходит на экран “1.5.2 Edit Part”, вместо перехода на “2.3 Страница детали”, как это происходит в стандартном списке.</p></details></li></ul><ul id="16f42927-0b72-8144-940a-d745e8ab6bed" class="toggle"><li><details open=""><summary><strong>1.5.2 Страница “Редактирования детали” </strong></summary><ul id="16f42927-0b72-8190-b206-c9ff9891d988" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Скрин</mark></mark></summary><figure id="16f42927-0b72-8195-8416-dc876f518b31" class="image"><a href="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2054.png"><img style="width:331.9875183105469px" src="%D0%A2%D0%97%20%D0%BD%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC%20%D0%B1%D0%BE%D1%82%D0%B0_Main%2016f429270b7280e89dcacea862fc8a1a/image%2054.png"/></a></figure></details></li></ul><p id="16f42927-0b72-813e-9494-c4234cb10eda" class=""><strong>При клике на деталь на экране 1.51 “Редактирования списка” пользователь попадает на 1.5.2 “Редактирования детали”.</strong></p><p id="16f42927-0b72-8100-9797-fa0be7c6a0bd" class="">Бот отправляет сообщение с информацией о выбранной детали (загруженное фото (если есть), распознанный партномер, фото из БД, название). Бот ожидает ввода нового партномера, после чего заменяет его в Входной таблице (user_stocks или Stock_Recount). Единственная инлайн-кнопка <strong>Delete Part</strong> удаляет запчасть из Входной таблицы.</p><hr id="16f42927-0b72-81be-894e-caf775fabe5f"/><h3 id="16f42927-0b72-812d-a21a-e76c7444f61d" class="">1. Содержание сообщения:</h3><ul id="16f42927-0b72-81c5-ab38-f3ad376c74c6" class="bulleted-list"><li style="list-style-type:disc"><strong>Изображения</strong>:<ul id="16f42927-0b72-81b4-8453-dee85c322894" class="bulleted-list"><li style="list-style-type:circle">Фото, загруженное пользователем: берется из поля <code>photo_path</code> таблицы <strong>Stock_Recount</strong> (если она входная).</li></ul><ul id="16f42927-0b72-817f-b367-f3dcd3fa034a" class="bulleted-list"><li style="list-style-type:circle">Фото из таблицы <strong>Parts_and_Replaces</strong>: используется, если в таблице <strong>Stock_Recount</strong> указана связь с <strong>Parts_and_Replaces</strong> (поле <code>Parts_and_Replaces_id</code> не пустое) и поле <code>pic</code> в <strong>Parts_and_Replaces</strong> заполнено.</li></ul><ul id="16f42927-0b72-818a-80c0-fa4ebd220b58" class="bulleted-list"><li style="list-style-type:circle">Если условия для второго фото не выполняются, отправляется только фото, загруженное пользователем.</li></ul><ul id="16f42927-0b72-81ae-9571-ea277673ec4e" class="bulleted-list"><li style="list-style-type:circle">Если оба условия выполнены, оба фото отправляются в одном сообщении.</li></ul></li></ul><ul id="16f42927-0b72-816f-8a87-ef66207b6698" class="bulleted-list"><li style="list-style-type:disc"><strong>Текстовое сообщение</strong>:<ul id="16f42927-0b72-81a8-a8b0-e718b1e080cc" class="bulleted-list"><li style="list-style-type:circle"><strong>Original part number</strong>: {значение из <code>recognized_part_number</code> в <strong>Stock_Recount</strong> или <code>part_number</code> из <strong>user_stocks</strong>}.</li></ul><ul id="16f42927-0b72-813b-9b7f-e1c5885c6543" class="bulleted-list"><li style="list-style-type:circle"><strong>Part name</strong>: {значение из <code>part_name</code> в <strong>Parts_and_Replaces</strong> (если запись найдена), иначе N/A}.</li></ul><ul id="16f42927-0b72-8188-8522-f2dcd2aa1c4e" class="bulleted-list"><li style="list-style-type:circle"><strong>Please enter a new part number</strong>.</li></ul></li></ul><hr id="16f42927-0b72-81c2-bf3c-c1501dbe1a2d"/><h3 id="16f42927-0b72-8157-ba4a-d2ff305921db" class="">2. Действия пользователя:</h3><ul id="16f42927-0b72-8120-9fc8-c6c07a3c7a18" class="bulleted-list"><li style="list-style-type:disc">Пользователь вводит новый партномер.</li></ul><ul id="16f42927-0b72-81b5-b01a-c2551843473d" class="bulleted-list"><li style="list-style-type:disc"><strong>Проверка ввода партномера</strong>:<ul id="16f42927-0b72-81f2-87f6-c2520d7f33f9" class="bulleted-list"><li style="list-style-type:circle">Если ввод корректен, новый партномер записывается в поле Входной таблицы (на основе которой собирался список).</li></ul><ul id="16f42927-0b72-81bb-9ad2-f1f22cc240f5" class="bulleted-list"><li style="list-style-type:circle">Если проверка успешна — устанавливается статус <strong>2</strong>, если неуспешна — статус <strong>3</strong> (значение записывается в любом случае).</li></ul></li></ul><hr id="16f42927-0b72-819a-a35d-c44934a1f433"/><h3 id="16f42927-0b72-8110-a750-d5b0d9ec67ac" class="">3. Подтверждение после обновления:</h3><p id="16f42927-0b72-81d1-984d-cb8ea56f7636" class="">После успешного изменения партномера пользователь возвращается на предыдущую страницу с листом.</p><p id="16f42927-0b72-81bb-9422-e2e34cb07e34" class="">Бот отправляет подтверждающее сообщение: <strong>&quot;Part number updated successfully.&quot;</strong></p><hr id="16f42927-0b72-817d-86c7-e9d6a3dca81e"/><h3 id="16f42927-0b72-813c-bbbb-ddb0e9cf7b0c" class="">Инлайн-кнопка <strong>Delete Part</strong>:</h3><ul id="16f42927-0b72-81e2-9055-c9cd06790beb" class="bulleted-list"><li style="list-style-type:disc">Удаляет запись из входного списка мгновенно, без подтверждения.</li></ul><ul id="16f42927-0b72-8160-b258-e1a547243e7a" class="bulleted-list"><li style="list-style-type:disc">После удаления пользователь возвращается на предыдущую страницу с обновленным списком.</li></ul></details></li></ul></div></p></details></li></ul><p id="16f42927-0b72-8147-9c6c-f6062a6804c9" class="">
</p><h1 id="16f42927-0b72-81ab-8224-e2ba5c444efc" class="">Обработка ошибок</h1><ul id="16f42927-0b72-81fa-bfa8-f70df3bc720d" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><mark class="highlight-yellow_background">Описание</mark></mark></summary><h3 id="16f42927-0b72-8039-9764-edbd1721bcea" class="">Обработка некорректных запросов</h3><ul id="16f42927-0b72-8013-b7ef-f619c13f8c32" class="bulleted-list"><li style="list-style-type:disc">При вводе пользователем некорректных данных (например, текст длиннее 4000 символов, невалидное изображение или смешанный запрос):<ul id="16f42927-0b72-80dd-bd94-fc612ec0501b" class="bulleted-list"><li style="list-style-type:circle">Бот возвращает сообщение: <strong>&quot;Invalid request. Please try again.&quot;</strong></li></ul><ul id="16f42927-0b72-8016-a0b6-d84dd4fc0c6a" class="bulleted-list"><li style="list-style-type:circle">Пользователь остаётся на текущем экране с текущими инлайн-кнопками.</li></ul><ul id="16f42927-0b72-80f6-8c3a-fc866241aee5" class="bulleted-list"><li style="list-style-type:circle">Ошибка логируется в таблице <code>error_logs</code>.</li></ul></li></ul><hr id="16f42927-0b72-8075-9be7-fc3d0482832e"/><h3 id="16f42927-0b72-8064-aec0-f85c0367e2d3" class="">Тайм-аут обработки запросов</h3><ul id="16f42927-0b72-8003-858a-cb5c2802c477" class="bulleted-list"><li style="list-style-type:disc">Если система не может обработать запрос в течение 2 минут:<ul id="16f42927-0b72-806d-b78b-c3b126b8e52b" class="bulleted-list"><li style="list-style-type:circle">Бот возвращает сообщение: <strong>&quot;An error occurred while processing your request. Please try again later or contact support.&quot;</strong></li></ul><ul id="16f42927-0b72-8040-8acc-cbc3574b3f42" class="bulleted-list"><li style="list-style-type:circle">Ошибка записывается в таблицу <code>error_logs</code> с указанием причины и типа (например, <code>API Error</code>, <code>Timeout</code>).</li></ul></li></ul><hr id="16f42927-0b72-8079-a6ef-fb3eb0024ee1"/><h3 id="16f42927-0b72-80b0-982d-e12d5ab66702" class="">Запись ошибок в таблицу <code>error_logs</code></h3><p id="16f42927-0b72-80f6-b3ef-d00f01df9999" class="">При возникновении ошибки бот создаёт запись в таблице <code>error_logs</code>.</p><p id="16f42927-0b72-8071-bb23-d18b3a981dc0" class=""><strong>Шаги:</strong></p><ol type="1" id="16f42927-0b72-809e-808a-d5c26dac0038" class="numbered-list" start="1"><li><strong>Сбор данных</strong><ul id="16f42927-0b72-807c-9ac9-ec577d7f4301" class="bulleted-list"><li style="list-style-type:disc">Из таблицы <code>current_user_session</code> копируются (если возможно) следующие данные:<ul id="16f42927-0b72-80b6-a3e6-ccb390d713fa" class="bulleted-list"><li style="list-style-type:circle"><strong>screen_name</strong> — Название текущего экрана или модуля.</li></ul><ul id="16f42927-0b72-804e-ac08-d80e83ee291d" class="bulleted-list"><li style="list-style-type:circle"><strong>user_input</strong> — Текст запроса или путь к файлу.</li></ul><ul id="16f42927-0b72-800b-9188-f487c13cbb3a" class="bulleted-list"><li style="list-style-type:circle"><strong>bot_response</strong> — Текст ответа бота.</li></ul><ul id="16f42927-0b72-80af-87b3-c2bdbf791e02" class="bulleted-list"><li style="list-style-type:circle"><strong>buttons</strong> — JSON-строка с текстами и ссылками инлайн-кнопок.</li></ul><ul id="16f42927-0b72-8067-b64c-ffdc87b2d164" class="bulleted-list"><li style="list-style-type:circle"><strong>job_id</strong> — Идентификатор текущей работы.</li></ul></li></ul></li></ol><ol type="1" id="16f42927-0b72-807f-9d6e-dd0208e9b07d" class="numbered-list" start="2"><li><strong>Заполнение обязательных полей</strong><br/>Если данные из <br/><code>current_user_session</code> недоступны, запись создаётся без этих полей. Остальные данные, такие как <code>error_type</code>, <code>details</code> и <code>mestamp</code>, заполняются из текущего контекста.</li></ol><ol type="1" id="16f42927-0b72-80ef-8671-f9a0af324680" class="numbered-list" start="3"><li><strong>Дублирование сообщения об ошибке в телеграмм.</strong><p id="16f42927-0b72-807e-8acf-d768019c1356" class="">Бот дублирует данные, которые должны сохраняются в бд, в Telegram-канал для связи с администратором. Если запись в базу данных невозможна, бот всё равно должен отправить сообщение пользователю в Telegram.</p></li></ol><p id="16f42927-0b72-80d8-baed-ff0b6de74d78" class=""><strong>Структура таблицы </strong><code><strong>error_logs</strong></code><strong>:</strong></p><ul id="16f42927-0b72-8002-9499-dae103c3b937" class="bulleted-list"><li style="list-style-type:disc"><strong>id</strong> — Уникальный идентификатор записи, автоинкремент.</li></ul><ul id="16f42927-0b72-80ce-970f-c8dd1c82adaa" class="bulleted-list"><li style="list-style-type:disc"><strong>user_id</strong> — Идентификатор пользователя, вызвавшего ошибку.</li></ul><ul id="16f42927-0b72-80a1-b89d-db51a72352a1" class="bulleted-list"><li style="list-style-type:disc"><strong>timestamp</strong> — Время возникновения ошибки.</li></ul><ul id="16f42927-0b72-80f1-b5da-f875a01a84cc" class="bulleted-list"><li style="list-style-type:disc"><strong>error_type</strong> — Тип ошибки (например, &quot;DB Error&quot;, &quot;User Input&quot;, &quot;API Error&quot;).</li></ul><ul id="16f42927-0b72-8085-b93d-d6627f33db61" class="bulleted-list"><li style="list-style-type:disc"><strong>details</strong> — Детальная информация об ошибке (например, сообщение исключения или описание проблемы).</li></ul><ul id="16f42927-0b72-8059-93f6-f488fbccd4ab" class="bulleted-list"><li style="list-style-type:disc"><strong>action_taken</strong> — Действие, предпринятое ботом (например, &quot;Retried&quot;, &quot;Prompted correction&quot;).</li></ul><ul id="16f42927-0b72-8097-ae3b-cd2b03262957" class="bulleted-list"><li style="list-style-type:disc"><strong>screen_name</strong> — Название экрана или модуля, где произошла ошибка.</li></ul><ul id="16f42927-0b72-806a-8181-e419b1c1cfb7" class="bulleted-list"><li style="list-style-type:disc"><strong>request_data</strong> — Данные, отправленные пользователем, если применимо (например, текст или файл).</li></ul><ul id="16f42927-0b72-80d4-8b23-c014bba2eaa0" class="bulleted-list"><li style="list-style-type:disc"><strong>user_input</strong> — Текст запроса или путь к файлу (если это изображение).</li></ul><ul id="16f42927-0b72-801a-9e54-c018dc72c90f" class="bulleted-list"><li style="list-style-type:disc"><strong>bot_response</strong> — Текст ответа бота.</li></ul><ul id="16f42927-0b72-8028-80f6-c16d09ab4d80" class="bulleted-list"><li style="list-style-type:disc"><strong>buttons</strong> — JSON-строка с текстами и ссылками инлайн-кнопок.</li></ul><ul id="16f42927-0b72-803e-872b-fd3ce42ffb92" class="bulleted-list"><li style="list-style-type:disc"><strong>job_id</strong> — Идентификатор текущей работы (если применимо).</li></ul><ul id="16f42927-0b72-8095-bddf-c3a611263822" class="bulleted-list"><li style="list-style-type:disc"><strong>mestamp</strong> — Время создания проблемы.</li></ul><ul id="16f42927-0b72-80e6-8499-e62fb7697d26" class="bulleted-list"><li style="list-style-type:disc"><strong>created_at</strong> — Дата и время записи в таблицу.</li></ul><ul id="16f42927-0b72-800f-90f1-efe50c9e1aa8" class="bulleted-list"><li style="list-style-type:disc"><strong>status</strong> — Текущее состояние ошибки (<code>new</code>, <code>resolved</code>, <code>ignored</code>).</li></ul><hr id="16f42927-0b72-80f8-8c71-ce3051074d7b"/><h3 id="16f42927-0b72-80fe-9429-faf676f22b81" class="">Пример записи в таблице <code>error_logs</code></h3><table id="16f42927-0b72-808c-b481-c9e32f712ec5" class="simple-table"><tbody><tr id="16f42927-0b72-802a-b395-ef08b5684d7c"><td id="`G:&gt;" class="">id</td><td id="Kv}r" class="">user_id</td><td id="{oq_" class="">error_type</td><td id="zUWQ" class="">error_message</td><td id="SB\d" class="">details</td><td id="S|VZ" class="">action_taken</td><td id="Zap&lt;" class="">screen_name</td><td id="XbWJ" class="">request_data</td><td id="^:[B" class="">user_input</td><td id="S}&lt;x" class="">bot_response</td><td id="DKEO" class="">buttons</td><td id="vVA[" class="">job_id</td><td id="VcG&gt;" class="">mestamp</td><td id="PgZu" class="">created_at</td><td id="Y=fi" class="">status</td></tr><tr id="16f42927-0b72-806e-89ac-f84a3d8f8455"><td id="`G:&gt;" class="">1</td><td id="Kv}r" class="">101</td><td id="{oq_" class="">API Error</td><td id="zUWQ" class="">&quot;API connection failed.&quot;</td><td id="SB\d" class="">&quot;Timeout error at endpoint.&quot;</td><td id="S|VZ" class="">&quot;Retried&quot;</td><td id="Zap&lt;" class="">Find Model</td><td id="XbWJ" class="">&quot;Model: ABC123&quot;</td><td id="^:[B" class="">&quot;ABC123&quot;</td><td id="S}&lt;x" class="">&quot;Please wait while we process your request.&quot;</td><td id="DKEO" class=""><code>{&quot;Retry&quot;: &quot;/retry&quot;, &quot;Cancel&quot;: &quot;/cancel&quot;}</code></td><td id="vVA[" class="">56789</td><td id="VcG&gt;" class="">2025-01-02 12:30:45</td><td id="PgZu" class="">2025-01-02 12:31:00</td><td id="Y=fi" class="">new</td></tr><tr id="16f42927-0b72-8064-8530-dd8fc5c59563"><td id="`G:&gt;" class="">2</td><td id="Kv}r" class="">102</td><td id="{oq_" class="">User Input</td><td id="zUWQ" class="">&quot;Invalid input provided.&quot;</td><td id="SB\d" class="">&quot;Input exceeds 4000 chars.&quot;</td><td id="S|VZ" class="">&quot;Prompted correction&quot;</td><td id="Zap&lt;" class="">Find Parts</td><td id="XbWJ" class="">&quot;Very long text...&quot;</td><td id="^:[B" class="">&quot;Lorem ipsum&quot;</td><td id="S}&lt;x" class="">&quot;Your input is too long. Please try again.&quot;</td><td id="DKEO" class=""><code>{&quot;Help&quot;: &quot;/help&quot;}</code></td><td id="vVA[" class="">NULL</td><td id="VcG&gt;" class="">2025-01-02 12:32:10</td><td id="PgZu" class="">2025-01-02 12:32:20</td><td id="Y=fi" class="">resolved</td></tr></tbody></table><hr id="16f42927-0b72-805d-aeb3-fd2debdc8097"/><h3 id="16f42927-0b72-8063-86be-fe185f0d70b9" class="">Валидация и дополнительные действия</h3><ul id="16f42927-0b72-800d-ac19-d9726db0c80a" class="bulleted-list"><li style="list-style-type:disc">Если ошибка связана с пользовательским вводом, бот предлагает варианты действий, например, <strong>&quot;Try again&quot;</strong> или <strong>&quot;Contact support&quot;</strong>.</li></ul><ul id="16f42927-0b72-80e3-b717-f0499008ff86" class="bulleted-list"><li style="list-style-type:disc">Если ошибка критическая (например, сбой API) и/или бот не может сохранить запись об ошибке в БД, бот все равно отправит сообщение в телеграмм (п.3).</li></ul><h3 id="16f42927-0b72-808d-9714-f285eb4d2a08" class="">Резервные действия</h3><ul id="16f42927-0b72-8049-b362-ec789bf607a9" class="bulleted-list"><li style="list-style-type:disc">Если обработка ошибки невозможна, бот продолжает работу, минимизируя влияние на пользователя.</li></ul><ul id="16f42927-0b72-80ea-a9c7-fdf92df89479" class="bulleted-list"><li style="list-style-type:disc">Дополнительные данные об ошибке логируются для анализа.</li></ul><p id="16f42927-0b72-81dd-9ec0-ce7c7e6b8341" class="">
</p></details></li></ul><p id="16f42927-0b72-8182-879b-e0b2122bebf1" class="">
</p><p id="16f42927-0b72-8150-979e-f457b6b14b2d" class="">
</p><p id="16f42927-0b72-802f-9c78-d1f7ca4459fc" class="">
</p><p id="16f42927-0b72-804c-adff-e9e11c00182c" class="">
</p><p id="16f42927-0b72-806c-91a7-e26af9345c35" class="">
</p><p id="16f42927-0b72-8066-a1f5-fc711c3168d1" class="">
</p><p id="16f42927-0b72-8046-ab21-d48242761e02" class="">
</p><p id="16f42927-0b72-8010-8eb6-d4294458b1e2" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>